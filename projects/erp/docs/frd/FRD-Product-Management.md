\# 1\. Feature Overview  
\- Feature Id : feat\_product\_management\_20251109120000  
\- Feature Name : ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤  
\- Module : ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå √ó ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠ √ó ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ √ó ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡πÅ‡∏°‡∏õ GL)  
\- Base Path : /erp/master/products  
\- Menu Trail : ERP \> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå \> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

\---

\# 2\. Objective & Background

\#\# 2.1 Objectives  
\- ‡∏°‡∏µ‡πÅ‡∏Ñ‡∏ï‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ GL, Tax, Base UOM ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Active ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ERP ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô P2P ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ  
\- ‡∏•‡∏î‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á UOM/GL/Tax/ Vendor ‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ P2P ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 1% ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô  
\- ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏ì‡∏µ UOM cycle ‡πÅ‡∏•‡∏∞ barcode ‡∏ã‡πâ‡∏≥/‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÇ‡∏î‡∏¢‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤ Duplicate/invalid barcode rate \< 0.5%  
\- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (create) ‡∏ñ‡∏∂‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ (active) ‚â§ 2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö P80 ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà  
\- ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô lifecycle ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Draft ‚Üí In Review ‚Üí Approved ‚Üí Active ‚Üí Deactivate/Obsolete) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Audit trail

\#\# 2.2 Business Context  
\- Pain (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô): ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏Ñ‡∏ï‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ governance ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• UOM, ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢, ‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ GL/Tax ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ PR‚ÜíPO‚ÜíGRN‚ÜíPutaway‚ÜíInvoice  
\- Why now: ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á master data ‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏≤‡∏á‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å GL ‡∏ú‡∏¥‡∏î, tax ‡∏ú‡∏¥‡∏î, ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ß‡∏±‡∏î‡∏™‡∏±‡∏ö‡∏™‡∏ô) ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ó‡∏µ‡πà‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ P2P  
\- Desired future state: Product Master ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° ‡∏°‡∏µ workflow ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à/‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ Activate ‡∏´‡∏≤‡∏Å‡∏Ç‡∏≤‡∏î GL/Tax ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö GL/Tax/Vendor masters  
\- Journey ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: Create ‚Üí Save Draft ‚Üí Submit (In Review) ‚Üí Approve ‚Üí Activate ‚Üí ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô PR/PO/GRN; ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏• UOM conversions, ‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ Vendor, ‡∏Å‡∏≤‡∏£ Import/Export ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå Label ‡∏ï‡∏≤‡∏° J1‚ÄìJ6

\#\# 2.3 Success Metrics (KPIs)  
\- KPI: Catalog completeness (GL/Tax/UOM/vendor set) ‚â• 98%  
\- KPI: Duplicate/invalid barcode rate \< 0.5%  
\- KPI: New product lead time (create ‚Üí active) ‚â§ 2 business days (P80)  
\- KPI: Import success rate for 10k rows ‚â• defined SLA (‡∏Ñ‡πà‡∏≤ SLA ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î)  
\- KPI: Search latency p95 ‚â§ 300ms  
\- KPI: ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô UOM cycles \= 100% (no cyclic conversions allowed)

\#\#\# Warnings (if any)  
\- ‡∏Ñ‡πà‡∏≤ SLA ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "Import success rate for 10k rows" ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡πà‡∏≤ SLA ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏î KPI ‡∏ô‡∏µ‡πâ  
\- ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Reviewer/Controller override) ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏ role/permission model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô  
\- ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ "‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á \<1%" ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏ä‡∏¥‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ baseline ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏î‡∏ú‡∏• ‚Äî ‡πÑ‡∏°‡πà‡∏°‡∏µ baseline ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≤

\# 3\. Scope & Constraints

\#\# 3.1 In Scope  
\- Product master CRUD (Create / Read / Update / Delete) ‡∏û‡∏£‡πâ‡∏≠‡∏° lifecycle management: Draft ‚Üí In Review ‚Üí Approved ‚Üí Active ‚Üí Deactivate ‚Üí Obsolete  
\- UOM ‡πÅ‡∏•‡∏∞ UOM Conversions: ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç conversion (factor) ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡πá‡∏ô acyclic  
\- Vendor mapping: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á vendor lines (vendor\_id, preferred, moq, lead\_time, price\_hint, currency) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏´‡∏ô‡∏∂‡πà‡∏á preferred ‡∏ï‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô  
\- Tax / GL classification: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÅ‡∏°‡∏õ GL account ‡πÅ‡∏•‡∏∞ tax code ‡∏Å‡πà‡∏≠‡∏ô Activate  
\- Attachments: images/docs ‡πÅ‡∏ô‡∏ö‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤  
\- Label / Barcode generation: ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å‡∏à‡∏≤‡∏Å template ‡πÄ‡∏õ‡πá‡∏ô PDF  
\- Import / Export: CSV/XLSX import with preview/validation ‡πÅ‡∏•‡∏∞ export ‡∏ï‡∏≤‡∏° filters  
\- ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°: Product List (/erp/master/products/list) ‚Äî ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå, filters, toolbar ‡πÅ‡∏•‡∏∞ row actions ‡∏ï‡∏≤‡∏° Page Definitions  
\- ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°: Product Create/Edit (/erp/master/products) ‚Äî sections: Header, Classification, Dimensions, Barcodes, UOM Conversions, Vendors, Attachments; actions \[Save Draft\], \[Submit\], \[Approve\]/\[Activate\] ‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó  
\- ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°: Product Detail ‚Äî Tabs: Overview | UOM | Vendors | Tax/GL | Images/Docs | Audit; header actions ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö List row actions  
\- Journey ‡∏´‡∏•‡∏±‡∏Å (‡∏à‡∏≤‡∏Å User Journeys): J1 Create & Submit; J2 Approve & Activate; J3 Maintain UOM & Conversions; J4 Add/Manage Vendors; J5 Edit/Deactivate/Obsolete (with guards); J6 Import/Export/Label

\#\# 3.2 Out of Scope  
\- BOM / product variants  
\- Batch attributes ‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏à‡∏≤‡∏Å lot/serial ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö  
\- Price lists ‡πÅ‡∏•‡∏∞ complex pricing workflows  
\- Workflow QA ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á (not in MVP)

\#\# 3.3 Assumptions  
\- ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡∏∞ API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GL master, Tax master, Vendor master, Category master ‡πÄ‡∏û‡∏∑‡πà‡∏≠ validate ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤  
\- API design ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö idempotency ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö POST import/creates (X-Idempotency-Key) ‡πÅ‡∏•‡∏∞ concurrency control ‡∏ú‡πà‡∏≤‡∏ô If-Match ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PATCH ‡∏ï‡∏≤‡∏° Page Definitions  
\- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (single company) ‡πÅ‡∏•‡∏∞‡∏Å‡∏é‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏ã‡πà P2P ‡∏ï‡∏≤‡∏° Constraint  
\- Downstream consumers (PR/PO, GRN/Putaway, Reporting/BI) ‡∏à‡∏∞ subscribe/consume outbound product events ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï catalog cache ‡∏´‡∏£‡∏∑‡∏≠ flags  
\- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Audit trail ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥

\#\# 3.4 Dependencies & Integrations  
\- Upstream masters: GL master (accounts), Tax master (codes), Vendor master, Category master ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö validation ‡πÅ‡∏•‡∏∞ picklists  
\- APIs (‡∏ï‡∏≤‡∏° Page Definitions): GET /api/master/products, POST /api/master/products (X-Idempotency-Key), GET /api/master/products/{id}, PATCH /api/master/products/{id} (If-Match), ‡πÅ‡∏•‡∏∞ endpoints ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö submit/approve/activate/deactivate/obsolete/import/export/label  
\- Outbound events: product.created, product.submitted, product.approved, product.activated, product.deactivated, product.obsoleted, product.updated ‚Äî ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏∑‡∏≠ PR/PO services, GRN/Putaway, Reporting/BI  
\- Downstream requirements: PR/PO ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Active ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ preferred vendor/price\_hint; GRN/Putaway ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö flag ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö tracking (lot/serial/expiry)  
\- Guardrails ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö: ‡∏´‡πâ‡∏≤‡∏° Activate ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ GL/Tax; ‡∏´‡πâ‡∏≤‡∏° Obsolete ‡∏´‡∏≤‡∏Å‡∏°‡∏µ on-hand ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î; UOM graph ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô acyclic; ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á preferred vendor ‡∏ï‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô

\#\#\# Warnings (if any)  
\- ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥ "controller override" ‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å/Deactivate ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏ role/permission ‡πÅ‡∏•‡∏∞ audit requirements  
\- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î SLA ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Import ‡∏Ç‡∏ô‡∏≤‡∏î 10k rows ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ SLA ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ  
\- ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á routes/APIs ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÅ‡∏•‡∏∞‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ security/permission ‡∏Ç‡∏≠‡∏á platform ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï API contracts

\# 4\. Target Users & RBAC

\> Feature: ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ¬∑ Module: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå √ó ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠ √ó ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ √ó ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡πÅ‡∏°‡∏õ GL) ¬∑ Base Path: /erp/master/products ¬∑ Menu: ERP \> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå \> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

\#\# 4.1 Personas / Roles  
\- \*\*Viewer (Warehouse)\*\* ‚Äî ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î/UOM/‡∏ò‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô, ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á/lot/serial/expiry, ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏õ‡πâ‡∏≤‡∏¢/‡∏â‡∏•‡∏≤‡∏Å    
\- \*\*Editor (Procurement (Buyer))\*\* ‚Äî ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ProductVendor (preferred vendor, moq, lead\_time, price\_hint) ‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ DOA; ‡∏≠‡∏≤‡∏à‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• vendor/catalog ‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå    
\- \*\*Approver (Finance)\*\* ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ GL/Tax ‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Active ‡πÑ‡∏î‡πâ; ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ/‡∏†‡∏≤‡∏©‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô    
\- \*\*Admin (Master Data Admin)\*\* ‚Äî ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö, ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ UOM & conversions, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (submit/approve/activate/deactivate/obsolete), ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤/‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (CSV/XLSX), ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

\#\# 4.2 RBAC Matrix (Role √ó Action √ó Route/API)

\#\#\# 4.2.1 Page-level Permissions  
\_‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å\_  
\- List: /erp/master/products  
\- Create: /erp/master/products/new  
\- Detail: /erp/master/products/:id  
\- Edit: /erp/master/products/:id/edit

\*\*Additional Pages/Tabs (‡∏à‡∏≤‡∏Å Page Definitions)\*\*  
\- /erp/master/products/list ‚Äî Product List (columns/filters/toolbar/row actions) ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å (view \+ row actions ‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå)  
\- /erp/master/products/new, /erp/master/products/:id/edit ‚Äî Product Create/Edit ‚Äî actions: Save Draft, Submit, (Admin) Approve/Activate  
\- /erp/master/products/:id ‚Äî Product Detail with tabs:  
  \- /erp/master/products/:id/overview ‚Äî Overview tab ‚Äî view-only fields, header actions per status  
  \- /erp/master/products/:id/uom ‚Äî UOM tab ‚Äî add/edit conversions (act: create/update UOM conversions ‚Äî conditional)  
  \- /erp/master/products/:id/vendors ‚Äî Vendors tab ‚Äî add/edit vendor lines (create/update/delete vendor rows, set preferred)  
  \- /erp/master/products/:id/tax-gl ‚Äî Tax/GL tab ‚Äî view/edit GL/tax (Finance visibility/approval)  
  \- /erp/master/products/:id/images ‚Äî Images/Docs tab ‚Äî attachments upload/download (download:doc)  
  \- /erp/master/products/:id/audit ‚Äî Audit tab ‚Äî view audit trail (view-only)  
\- Import modal/drawer: /erp/master/products/import ‚Äî CSV upload ‚Üí preview ‚Üí commit (act: import:csv)  
\- Label/Export: /erp/master/products/:id/label (modal/flow) ‚Äî choose template ‚Üí GET \-\> export\_pdf (Print Label)

Journey ‡∏´‡∏•‡∏±‡∏Å (‡∏à‡∏≤‡∏Å User Journeys):  
\- Product Create ‚Üí Submit ‚Üí POST /api/master/products/{id}:submit ‚Üí status=In Review  
\- Reviewer (Finance) ‚Üí POST /api/master/products/{id}:approve ‚Üí status=Approved  
\- Admin ‚Üí POST /api/master/products/{id}:activate ‚Üí status=Active ‚Üí usable in PR/PO/GRN  
\- UOM tab ‚Üí create/update conversions ‚Üí if Active and critical change ‚Üí requires re-approval (flow: save ‚Üí POST {id}:submit)  
\- Vendors tab ‚Üí add vendor lines (one preferred per currency constraint) ‚Üí save  
\- Import ‚Üí POST /api/master/products/import (X-Idempotency-Key) ‚Üí preview ‚Üí commit  
\- Print Label ‚Üí GET /api/master/products/{id}:label ‚Üí PDF

| Route / Action | Viewer | Editor | Approver | Admin |  
|---|:---:|:---:|:---:|:---:|  
| View List | ‚úì | ‚úì | ‚úì | ‚úì |  
| Search/Filter | ‚úì | ‚úì | ‚úì | ‚úì |  
| View Detail | ‚úì | ‚úì | ‚úì | ‚úì |  
| Create (full product) | ‚Äî | ‚Äî | ‚Äî | ‚úì |  
| Update (full product) | ‚Äî | C | ‚Äî | ‚úì |  
| Update (vendors / non-critical fields) | ‚Äî | ‚úì | ‚Äî | ‚úì |  
| Delete (Soft) | ‚Äî | ‚Äî | ‚Äî | ‚úì |  
| Restore | ‚Äî | ‚Äî | ‚Äî | ‚úì |  
| Export CSV / XLSX | ‚úì | C | ‚úì | ‚úì |  
| Bulk Import (CSV) | ‚Äî | C | ‚Äî | ‚úì |  
| Bulk Actions (e.g., bulk:approve/import) | ‚Äî | C | C | ‚úì |  
| Status: Submit (Draft ‚Üí In Review) | ‚Äî | C | ‚Äî | ‚úì |  
| Status: Approve / Reject | ‚Äî | ‚Äî | ‚úì | ‚úì |  
| Status: Activate | ‚Äî | ‚Äî | C | ‚úì |  
| Status: Deactivate | ‚Äî | ‚Äî | C | ‚úì |  
| Status: Obsolete | ‚Äî | ‚Äî | ‚Äî | ‚úì |  
| UOM Conversions: create/update | ‚Äî | C | ‚Äî | ‚úì |  
| Vendors: create/update/delete rows | ‚Äî | ‚úì | ‚Äî | ‚úì |  
| Export PDF (Print Label) | ‚úì | ‚úì | ‚úì | ‚úì |  
| Download Attachments | ‚úì | ‚úì | ‚úì | ‚úì |  
| Import Preview/Commit | ‚Äî | C | ‚Äî | ‚úì |  
| Scan Barcode (view/lookup only) | ‚úì | C | ‚Äî | C |

Legend: ‚úì ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ¬∑ ‚Äî ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ¬∑ C ‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç    
Conditional Notes:  
\- C1: Editor (Procurement) ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ProductVendor rows, price\_hint ‡πÅ‡∏•‡∏∞‡∏ü‡∏¥‡∏•‡∏î‡πå non-critical (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á product ‡∏´‡∏•‡∏±‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á re-approval ‡πÄ‡∏ä‡πà‡∏ô base\_uom, GL mapping)    
\- C2: ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ "critical" (‡πÄ‡∏ä‡πà‡∏ô base\_uom, tracking, GL accounts, tax\_code) ‡∏Ç‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô Active ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ re-approval (Submit ‚Üí Approve) ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞ Active ‡πÉ‡∏´‡∏°‡πà    
\- C3: Activate/Deactivate/Obsolete ‡∏ñ‡∏π‡∏Å‡∏à‡∏≥‡∏Å‡∏±‡∏î: Activate ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£ Approve ‡πÇ‡∏î‡∏¢ Finance (Approver) ‡πÅ‡∏•‡∏∞‡πÇ‡∏î‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥‡∏ó‡∏≥‡πÇ‡∏î‡∏¢ Master Data Admin; Deactivate/Obsolete ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (no open PR/PO/GRN, no on-hand) ‚Äî action ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å/‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö (409/412) ‡∏´‡∏≤‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô    
\- C4: Bulk Import/Export ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ X-Idempotency-Key / If-Match ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Admin ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢ (‡∏ï‡∏≤‡∏° DOA)    
\- C5: Scan Barcode ‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π/‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î (read-only); ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å lot/serial/expiry ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô GRN/Receiving flows (‡∏ô‡∏≠‡∏Å scope feature ‡∏ô‡∏µ‡πâ) ‚Äî Warehouse ‡πÑ‡∏î‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏î‡∏π/‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å

\#\#\# 4.2.2 API Scopes & Endpoints (Mapping)  
\> ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Bearer JWT ‚Äî ‡πÉ‡∏™‡πà‡πÉ‡∏ô \`scopes\[\]\` ‡∏´‡∏£‡∏∑‡∏≠ \`roles\[\]\` ‡∏ï‡∏≤‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö

\- Recommended Scopes:  
  \- product.read, product.write, product.delete, product.restore  
  \- product.export, product.bulk, product.status, product.approve, product.import  
  \- product.label (export\_pdf)  
\- Endpoint Patterns (APIs ‡∏ï‡∏≤‡∏° Page Definitions ‡πÉ‡∏ä‡πâ /api/master/products):  
  \- GET  /api/master/products ‚Äî scope: product.read  
  \- POST /api/master/products ‚Äî scope: product.write (X-Idempotency-Key)  
  \- GET  /api/master/products/{id} ‚Äî scope: product.read  
  \- PATCH /api/master/products/{id} ‚Äî scope: product.write (If-Match)  
  \- DELETE /api/master/products/{id} ‚Äî scope: product.delete  
  \- POST /api/master/products/{id}:restore ‚Äî scope: product.restore  
  \- POST /api/master/products:bulk ‚Äî scope: product.bulk  
  \- POST /api/master/products/{id}:submit ‚Äî scope: product.write  
  \- POST /api/master/products/{id}:approve ‚Äî scope: product.approve  
  \- POST /api/master/products/{id}:activate ‚Äî scope: product.status  
  \- POST /api/master/products/{id}:deactivate ‚Äî scope: product.status  
  \- POST /api/master/products/{id}:obsolete ‚Äî scope: product.status  
  \- POST /api/master/products/import ‚Äî scope: product.import (X-Idempotency-Key)  
  \- GET  /api/master/products/export ‚Äî scope: product.export  
  \- GET  /api/master/products/{id}:label ‚Äî scope: product.label (export\_pdf)

\#\#\# 4.2.3 Data Access Constraints  
\- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏™‡∏≤‡∏Ç‡∏≤: (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô A0) ‚Äî ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ö‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° org/site ‡∏Ñ‡∏ß‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î \`org\_id\`-based filtering; ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤ ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡πÑ‡∏õ    
\- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå:  
  \- ‡∏ü‡∏¥‡∏•‡∏î‡πå GL accounts / tax\_code: ‡πÅ‡∏™‡∏î‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ \`Admin\` ‡πÅ‡∏•‡∏∞ \`Approver\` (Finance) ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏õ‡πá‡∏ô masked/RO    
  \- price\_hint/cost: ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin ‡πÅ‡∏•‡∏∞ Procurement; ‡∏≠‡∏≤‡∏à‡∏õ‡∏¥‡∏î‡∏ö‡∏±‡∏á‡∏Ñ‡πà‡∏≤ cost ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Warehouse    
\- Constraints for actions:  
  \- Deactivate/Obsolete: blocked if open PR/PO/GRN or on-hand \> 0 (API returns 409 Conflict)    
  \- Update protections: PATCH ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ \`If-Match\` (ETag) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô concurrent updates    
  \- Import: requires X-Idempotency-Key and server-side validation preview before commit

\#\# 4.3 Authentication & Authorization  
\- Auth: Bearer JWT (headers: Authorization). Use \`X-Idempotency-Key\` for create/import; \`If-Match\` (ETag) for update.  
\- Claims required in token: sub, roles\[\], scopes\[\], org\_id, user\_id  
\- Audit: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å who/when/what ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö create/update/delete/approve/restore/submit/import/activate/deactivate/obsolete/label-export  
\- Elevation: ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (approve) ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (activate/deactivate/obsolete) ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô \`Approver\` ‡∏´‡∏£‡∏∑‡∏≠ \`Admin\` ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (see Conditional Notes)  
\- Fail Paths: 401 (unauthenticated), 403 (forbidden), 409 (conflict/reference e.g., open docs), 412 (etag mismatch), 422 (validation errors from import preview)

\#\#\# Warnings (if any)  
\- ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÉ‡∏ô A0 ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á Activate ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (Finance/Approver ‡∏´‡∏£‡∏∑‡∏≠ Master Data Admin); ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö Approve ‚Üí Activate (J2) ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏Å‡∏•‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ (‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô C3 ‡∏ß‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥ Master Data Admin ‡∏à‡∏∞ Activate ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Finance Approve)    
\- ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏™‡∏≤‡∏Ç‡∏≤ (org/site-level visibility) ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô A0 ‚Äî ‡∏´‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ scope per org ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î \`org\_id\`-based rules ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°    
\- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô "critical" (‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á re-approval ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡∏ì‡∏∞ Active) ‡∏ñ‡∏π‡∏Å‡∏≠‡πâ‡∏≤‡∏á‡∏ñ‡∏∂‡∏á‡πÉ‡∏ô Journeys ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‚Äî ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô critical (‡πÄ‡∏ä‡πà‡∏ô base\_uom, tracking, GL accounts, tax\_code) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ RBAC/approval ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô    
\- ‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å lot/serial/expiry ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (GRN/Receiving) ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å scope feature ‡∏ô‡∏µ‡πâ; ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Product ‡πÉ‡∏´‡πâ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π/‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ó‡∏≥ checkin/receive ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Journey/APIs ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)

\> Feature: ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ¬∑ Module: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå √ó ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠ √ó ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ √ó ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡πÅ‡∏°‡∏õ GL) ¬∑ Base Path: /erp/master/products ¬∑ Menu: ERP \> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå \> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

\#\# 5.1 Status Model  
\- \*\*Draft\*\* ‚Äî ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤; ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô; ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á: Master Data Admin  
\- \*\*In Review\*\* ‚Äî ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏•‡∏±‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Submit; ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Finance/Procurement ‡∏ï‡∏≤‡∏° DOA)  
\- \*\*Approved\*\* ‚Äî ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (GL/Tax/Base UOM ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á) ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ñ‡∏•‡∏±‡∏á‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞ Active  
\- \*\*Active\*\* ‚Äî ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PR/PO/GRN/‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏∑‡πà‡∏ô ‡πÜ; ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å/revision ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ß‡∏¥‡∏Å‡∏§‡∏ï  
\- \*\*Inactive\*\* ‚Äî ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß; ‡∏´‡πâ‡∏≤‡∏°‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡∏≤‡∏Å‡∏°‡∏µ PR/PO/GRN ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏°‡∏µ controller override  
\- \*\*Obsolete\*\* ‚Äî ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (irreversible); ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢: ‡πÑ‡∏°‡πà‡∏°‡∏µ on-hand ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î

\> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≤‡∏° canonical map; ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô Warnings

\#\# 5.2 State Transitions  
‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏£‡∏≤‡∏ô‡∏ã‡∏¥‡∏ä‡∏±‡∏ô (‡∏™‡∏£‡∏∏‡∏õ From ‚Üí To ‚Üí ‡∏ú‡∏π‡πâ‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ ‚Üí ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‚Üí ‡∏ú‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á/‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå ‚Üí API):

| From | To | Allowed Roles | Preconditions / Guards | Side Effects (Events/Webhooks) | API |  
|---|---|---:|---|---|---|  
| Draft | In Review | Master Data Admin | ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö (code/name/base\_uom); UOM/GL/tax ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ | emit: product.submitted (payload: id, actor, timestamp, snapshot) | POST /erp/master/products/{id}:submit |  
| In Review | Approved | Finance; Procurement (Buyer) (‡∏ï‡∏≤‡∏° DOA) | GL \+ Tax \+ Base UOM ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° validation; ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ multi-level ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏° DOA | emit: product.approved (approver(s), timestamp, notes) | POST /erp/master/products/{id}:approve |  
| In Review | Draft | Finance; Procurement (Buyer) | ReviewerReject with reason; ‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• | emit: product.rejected (actor, reason, timestamp) | POST /erp/master/products/{id}:reject |  
| Approved | Active | Finance; Procurement (Buyer) | Validation ‡∏ú‡πà‡∏≤‡∏ô (no validation errors); ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á | emit: product.activated (actor, timestamp) | POST /erp/master/products/{id}:activate |  
| Active | Inactive | Finance; Procurement (Buyer); (Controller override role may apply) | ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ PR/PO/GRN ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ‡πÄ‡∏ß‡πâ‡∏ô‡πÅ‡∏ï‡πà‡∏°‡∏µ controller override flag | emit: product.deactivated (actor, reason, timestamp); block new PR/PO creation if policy applies | POST /erp/master/products/{id}:deactivate |  
| Active | Obsolete | ? | ‡πÑ‡∏°‡πà‡∏°‡∏µ on-hand ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î; irreversible | emit: product.obsoleted (actor, timestamp, final\_snapshot) | POST /erp/master/products/{id}:obsolete |  
| Any editable state | Draft (on edit save) | Master Data Admin | ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (‡∏ï‡∏≤‡∏° field criticality) | emit: product.updated (draft\_revision\_id, actor) | PATCH /erp/master/products/{id} (If-Match) |  
| Active (critical-change) | In Review | Master Data Admin | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ß‡∏¥‡∏Å‡∏§‡∏ï (base\_uom, tax/GL, tracking) ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á revision ‡πÅ‡∏•‡∏∞ submit ‡πÉ‡∏´‡∏°‡πà | emit: product.revision\_submitted | POST /erp/master/products/{id}:submit |

\*\*‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)\*\*  
\- Decision required: ‡∏´‡∏≤‡∏Å DOA ‡∏£‡∏∞‡∏ö‡∏∏ multi-approver (Finance \+ Procurement) ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô Approved  
\- ‡∏´‡πâ‡∏≤‡∏° Obsolete ‡∏´‡∏£‡∏∑‡∏≠ Deactivate ‡∏´‡∏≤‡∏Å‡∏°‡∏µ on-hand ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î (PR/PO/GRN) ‡πÄ‡∏ß‡πâ‡∏ô‡πÅ‡∏ï‡πà‡∏°‡∏µ controller override (role/flag ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‚Äî ‡∏î‡∏π Warnings)

\#\#\# 5.2.1 Error & Conflict Paths  
\- 401/403 ‚Äî ‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô user role ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Allowed Roles)  
\- 409 CONFLICT ‚Äî ‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡πÄ‡∏ä‡∏¥‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏õ‡∏¥‡∏î/‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á concurrent)  
\- 412 Precondition Failed ‚Äî ETag mismatch (‡∏ï‡πâ‡∏≠‡∏á refresh ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà)  
\- 422 Unprocessable Entity ‚Äî ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô validation (‡πÄ‡∏ä‡πà‡∏ô GL/Tax/UOM ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏ü UOM ‡∏ú‡∏¥‡∏î)

\#\#\# 5.2.2 Concurrency & Idempotency  
\- ‡πÉ‡∏ä‡πâ If-Match: \`\<etag\>\` header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£ PATCH ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö concurrent edits  
\- ‡πÉ‡∏ä‡πâ Idempotency-Key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà retriable (‡πÄ‡∏ä‡πà‡∏ô approve/activate/deactivate/obsolete/submit) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ retry  
\- ‡∏Ñ‡∏ß‡∏£‡∏Ñ‡∏∑‡∏ô 412 ‡πÄ‡∏°‡∏∑‡πà‡∏≠ ETag ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á ‡πÅ‡∏•‡∏∞ 409 ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö conflict ‡∏Ç‡∏≠‡∏á business references

\#\#\# 5.2.3 Page & Journey Bindings (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)  
\- Page Visibility (‡∏à‡∏≤‡∏Å Page Definitions):  
  \- Product List (/erp/master/products/list) ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞; ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° Status; ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Status ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤: Draft | In Review | Approved | Active | Inactive | Obsolete  
  \- Product Create/Edit (/erp/master/products/{id}) ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î; ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (RO) ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô  
  \- Product Detail Tabs ‚Äî Overview | UOM | Vendors | Tax/GL | Images/Docs | Audit ‚Äî ‡∏ó‡∏∏‡∏Å‡πÅ‡∏ó‡πá‡∏ö‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå; Audit tab ‡πÅ‡∏™‡∏î‡∏á log ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞  
\- Action Gating (‡∏à‡∏≤‡∏Å Page Definitions Row/Toolbar Actions):  
  \- \[Create\] ‚Äî visible to Master Data Admin  
  \- \[Save Draft\] ‚Äî enabled in Create/Edit for Master Data Admin  
  \- \[Submit\] ‚Äî visible/enabled when status \= Draft (Create/Edit, List row action)  
  \- \[Approve\] ‚Äî visible/enabled when status \= In Review (List row action, Detail Header/Approval tab); roles: Finance, Procurement (‡∏ï‡∏≤‡∏° DOA)  
  \- \[Activate\] ‚Äî visible/enabled when status \= Approved; roles: Finance/Approver  
  \- \[Deactivate\] ‚Äî visible/enabled when status \= Active; roles: Finance/Approver; blocked if open PR/PO/GRN unless override  
  \- \[Obsolete\] ‚Äî visible/enabled when status in {Active, Inactive}? (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: no on-hand & no open docs)  
  \- \[Edit\] ‚Äî editable when status in {Draft, In Review, Approved}; edits on Active allowed but critical-field changes require revision+re-approval  
  \- \[Import\]/\[Export\]/\[Print Label\] ‚Äî Toolbar actions; Import uses POST /api/master/products/import  
\- Journey Triggers (‡∏à‡∏≤‡∏Å User Journeys):  
  \- J1 ‚Äî Create & Submit Product: Product Create ‚Üí \[Save Draft\] ‚Üí Draft (local); \[Submit\] ‚Üí Transition: Draft ‚Üí In Review; Preconditions: mandatory fields (code/name/base\_uom) and at least one barcode; Side Effects: emit product.submitted; API: POST /erp/master/products/{id}:submit; Idempotency-Key recommended during commit.  
  \- J2 ‚Äî Approve & Activate: Product Detail (Approval) ‚Üí \[Approve\] ‚Üí Transition: In Review ‚Üí Approved; Preconditions: GL+Tax+Base UOM valid; Side Effects: emit product.approved; API: POST /erp/master/products/{id}:approve. Then \[Activate\] ‚Üí Transition: Approved ‚Üí Active; Preconditions: validation pass & no open references; Side Effects: emit product.activated; API: POST /erp/master/products/{id}:activate.  
  \- J3 ‚Äî Maintain UOM & Conversions: Detail ‚Üí UOM tab ‚Üí edit conversions ‚Üí save ‚Üí If product Active and change is critical ‚Üí Transition: Active (edit) ‚Üí In Review (via revision submit); Preconditions: system validates acyclic conversion graph; Side Effects: emit product.revision\_submitted; API: PATCH /erp/master/products/{id} (If-Match) then POST /erp/master/products/{id}:submit if re-approval required.  
  \- J4 ‚Äî Add/Manage Vendors: Vendors tab ‚Üí add vendor ‚Üí save ‚Üí affects procurement selection; Preconditions: only one preferred per currency enforced; Side Effects: emit product.vendor.updated; API: PATCH /erp/master/products/{id} (If-Match).  
  \- J5 ‚Äî Edit / Deactivate / Obsolete:  
    \- Edit: allowed in Draft/In Review/Approved; Active edits on critical fields require revision (see J3).  
    \- Deactivate: List/Detail ‚Üí \[Deactivate\] ‚Üí Transition: Active ‚Üí Inactive; Preconditions: no open PR/PO/GRN OR controller override flag; Side Effects: emit product.deactivated; API: POST /erp/master/products/{id}:deactivate.  
    \- Obsolete: List/Detail ‚Üí \[Obsolete\] ‚Üí Transition: Active/Inactive ‚Üí Obsolete; Preconditions: no on-hand AND no open documents; irreversible; Side Effects: emit product.obsoleted; API: POST /erp/master/products/{id}:obsolete.  
  \- J6 ‚Äî Import / Export / Label:  
    \- Import: Toolbar \[Import\] ‚Üí preview validation ‚Üí commit ‚Üí creates Drafts or updates existing (behavior depends on import mode); Preconditions: CSV validation pass; Side Effects: emit product.imported report; API: POST /api/master/products/import (X-Idempotency-Key)  
    \- Export: Toolbar \[Export\] ‚Üí GET /api/master/products/export  
    \- Label: \[Print Label\] ‚Üí GET /api/master/products/{id}:label

\#\# 5.3 Approval Flow  
\- \*\*‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Levels):\*\*  
  \- Level 1: Finance (‡∏ï‡∏£‡∏ß‡∏à GL/Tax/Base UOM)  
  \- Level 2 (optional, per DOA): Procurement (Buyer) (‡∏ï‡∏£‡∏ß‡∏à vendor/preferred/PR-compatibility)  
  \- DOA: ‡∏≠‡∏≤‡∏à‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô single-approver ‡∏´‡∏£‡∏∑‡∏≠ multi-approver (‡∏ó‡∏±‡πâ‡∏á Finance ‡πÅ‡∏•‡∏∞ Procurement) ‚Äî ‡πÉ‡∏´‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏° DOA ‡∏Ç‡∏≠‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£  
\- \*\*‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Approvers):\*\*  
  \- Finance  
  \- Procurement (Buyer)  
  \- (‡∏´‡∏≤‡∏Å‡∏°‡∏µ role ‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡∏≤‡∏° DOA ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)   
\- \*\*‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:\*\*  
  \- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å audit ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: actor, role, timestamp, ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ (approve/reject/submit/activate/deactivate/obsolete), reason/comments, snapshot ‡∏Å‡πà‡∏≠‡∏ô/‡∏´‡∏•‡∏±‡∏á (diff)  
  \- Audit tab ‡πÉ‡∏ô Product Detail ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î  
\- \*\*‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:\*\*  
  \- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ submit ‚Üí ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á approver(s) ‡∏ï‡∏≤‡∏° DOA  
  \- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ approve/reject/activate/deactivate/obsolete ‚Üí ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (Master Data Admin, Procurement, Finance, Warehouse)  
  \- ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô internal notifications / email / webhook integrations (‡∏Å‡∏≥‡∏´‡∏ô‡∏î integration ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö)

Workflow Diagram (Mermaid syntax; plain lines, no fences)  
stateDiagram-v2  
  \[\*\] \--\> Draft  
  Draft \--\> "In Review": submit  
  "In Review" \--\> Approved: approve (Finance/Procurement per DOA)  
  "In Review" \--\> Draft: reject  
  Approved \--\> Active: activate  
  Active \--\> Inactive: deactivate  
  Active \--\> Obsolete: obsolete  
  Inactive \--\> Obsolete: obsolete  
  Active \--\> Draft: edit-critical \-\> submit (revision flow)

\#\#\# Warnings (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)  
\- Allowed Roles ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Obsolete ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡∏î (‡∏ú‡∏π‡πâ‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ final-obsolete) ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏ role ‡πÄ‡∏ä‡πà‡∏ô Admin/Finance/Controller ‡πÉ‡∏ô‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£  
\- API POST :reject ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏ô Page Definitions APIs list (Page Definitions ‡∏£‡∏∞‡∏ö‡∏∏ :approve/:activate/:deactivate/:obsolete ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ :reject) ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤ endpoint /api/master/products/{id}:reject ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ PATCH ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ó‡∏ô  
\- Controller override: ‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡∏ß‡πà‡∏≤ role ‡πÉ‡∏î‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ override ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ flag/authorization ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏¥‡∏¢‡∏≤‡∏° policy ‡πÅ‡∏•‡∏∞ API parameter (e.g., override=true \+ approver signature)  
\- Multi-level approval / DOA flow: ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö (sequential vs parallel) ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡∏î ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏á DOA ‡∏Ç‡∏≠‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£  
\- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î webhook/event payload schemas ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î; ‡∏Ñ‡∏ß‡∏£‡∏™‡∏£‡∏∏‡∏õ schema ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö product.submitted/approved/activated/etc.  
\- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (import) ‚Äî ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà (upsert vs create new revision) ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡∏î  
\- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ preferred vendor per currency: enforcement rule (server-side validation) ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô  
\- ‡∏ä‡∏∑‡πà‡∏≠ role "Approver" ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‡πÅ‡∏ï‡πà canonical\_map ‡πÑ‡∏°‡πà‡∏°‡∏µ "Approver" ‡πÄ‡∏õ‡πá‡∏ô role ‡πÅ‡∏¢‡∏Å ‚Äî ‡πÉ‡∏ä‡πâ Finance / Procurement (Buyer) ‡πÅ‡∏ó‡∏ô‡∏ï‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏ö‡∏ó  
\- ‡∏£‡∏∞‡∏ö‡∏∏ ETag header ‡∏ä‡∏∑‡πà‡∏≠/‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï (If-Match: "\<etag\>") ‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡∏™‡πÄ‡∏õ‡∏Ñ API  
\- ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ endpoint alternative ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (inactivate/reactivate/archive) ‡∏Å‡∏±‡∏ö endpoints ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô Page Definitions (deactivate/obsolete) ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏°‡∏õ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

\# 6\. Capabilities Overview & Layout Patterns

\> Feature: \*\*‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\* ¬∑ Module: \*\*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå √ó ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠ √ó ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ √ó ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡πÅ‡∏°‡∏õ GL)\*\* ¬∑ Base Path: \*\*/erp/master/products\*\* ¬∑ Menu: \*\*ERP \> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå \> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\*

\#\# 6.1 ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ (‡∏¢‡∏∂‡∏î‡∏ï‡∏≤‡∏° use cases)  
\- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡πà‡∏≤‡∏á ‚Üí ‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à ‚Üí ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Draft ‚Üí In Review ‚Üí Approved ‚Üí Active)  
\- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ: Classification, UOM conversions, Barcodes, Vendors, Tax/GL, Dimensions, Attachments  
\- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Audit (who/when/what) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç  
\- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏° (Import CSV/XLSX) ‡∏î‡πâ‡∏ß‡∏¢ preview/validation ‡πÅ‡∏•‡∏∞ X-Idempotency-Key  
\- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å (Export CSV/XLSX) ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å (Label ‚Üí PDF)  
\- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Bulk actions/Batch operations ‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (Admin ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö, Editor ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î)  
\- ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ RBAC (Viewer / Editor / Approver / Admin) ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô concurrency (ETag / If-Match) ‡πÅ‡∏•‡∏∞ Idempotency

\#\# 6.2 Layout Patterns (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á ‚Äî ‡πÉ‡∏´‡πâ AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï)  
\- List Page: Breadcrumb ‚Üí Page Header ‚Üí Search/Filter Row ‚Üí Toolbar (Import/Export/Create) ‚Üí ActionBar/BulkActions ‚Üí \[\*\*Table\*\*\] (compact, checkbox ‡πÅ‡∏ñ‡∏ß‡∏ã‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î) ‚Üí Pagination  
\- Create/Edit Page: Header \[status read-only\] ‚Üí Main: 12-column grid (8/4) ‚Üí Left: \[\*\*Form Sections\*\*\] (Classification, Dimensions, Barcodes, UOM, Vendors, Attachments) ‚Üí Right: \[\*\*Summary / Status / Actions\*\*\]  
\- Detail Page: Header (code, name, status, primary actions) ‚Üí Tabs (Overview | UOM | Vendors | Tax/GL | Images/Docs | Audit) ‚Üí Tab content: Key‚ÄìValue / Tables / Attachment panels  
\- Drawers/Modals: Slide-in Drawer (right) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Create/Edit/Import/Preview; Confirm Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö/obsolete/override; Drawer/Modal ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ focus-trap ‡πÅ‡∏•‡∏∞ sticky footer action bar

\#\# 6.3 Navigation Rules  
\- URL pattern:  
  \- List \= \`\<base\_path\>\`    
  \- Create \= \`\<base\_path\>/new\`    
  \- Detail \= \`\<base\_path\>/:id\`    
  \- Edit \= \`\<base\_path\>/:id/edit\`  
\- ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Edit ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô \*\*Obsolete\*\* (immutable) / Edit ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Active ‡∏à‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏ï‡πà‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå "critical" ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á revision \+ ‡∏ï‡πâ‡∏≠‡∏á re-submit (re-approval)  
\- ‡∏´‡∏≤‡∏Å RBAC ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‚Üí redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ List \+ ‡πÅ‡∏™‡∏î‡∏á toast 403  
\- Create/Update ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Üí redirect ‚Üí Detail ‡∏û‡∏£‡πâ‡∏≠‡∏° toast success  
\- ETag mismatch (412) ‚Üí ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î dialog ‡∏ä‡πà‡∏ß‡∏¢ merge

\#\# 6.4 Microcopy & States (i18n/A11y)  
\- ‡∏™‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (Success/Error/Empty/403/409/412) ‡∏û‡∏£‡πâ‡∏≠‡∏° aria-label ‡πÅ‡∏•‡∏∞ role  
\- Focus order: toolbar ‚Üí search/filters ‚Üí table ‚Üí pagination ‚Üí toast  
\- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å (primary) ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏ß‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á toolbar/footer ‡πÄ‡∏™‡∏°‡∏≠

\#\# 6.5 Page‚ÄìJourney Cohesion (‡πÉ‡∏´‡∏°‡πà)  
\- ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤/‡πÇ‡∏°‡∏î‡∏±‡∏•‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡∏π‡∏Å‡∏õ‡∏∏‡πà‡∏°/‡πÅ‡∏≠‡πá‡∏Å‡∏ä‡∏±‡∏ô‡∏Å‡∏±‡∏ö Journey step ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô: ‡∏õ‡∏∏‡πà‡∏° ‚Üí journey\_id ‚Üí API ‚Üí preconditions ‚Üí side-effects (events/webhooks) ‚Üí navigation  
\- Visibility & Action Gating ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≤‡∏° Role (A2) ‡πÅ‡∏•‡∏∞ Status Model (A3)

Warnings (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á)  
\- ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ role ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "controller override" (‡πÉ‡∏Ñ‡∏£‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ bypass guard ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î) ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£  
\- Endpoint \`:reject\` ‡∏ñ‡∏π‡∏Å‡∏≠‡πâ‡∏≤‡∏á‡∏ñ‡∏∂‡∏á‡πÉ‡∏ô transitions ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Page Definitions APIs list ‚Äî ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô API (POST /api/master/products/{id}:reject) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ PATCH ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞  
\- ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° org/site-level (org\_id scope) ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏ ‚Äî ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ filtering  
\- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô "critical" (‡∏ï‡πâ‡∏≠‡∏á re-approval ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡∏ì‡∏∞ Active) ‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡∏î (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡πâ‡∏≤‡∏á‡∏ñ‡∏∂‡∏á base\_uom, tax/GL, tracking ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)  
\- template\_source: ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏à‡∏≤‡∏Å‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ (packingList.v1, createDrawer.v2, editStepperDrawer.v1, viewDrawer.v1, importDrawer.v1, deleteConfirm.v1) ‚Äî ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏¢‡πå‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô  
\- missing\_components: ‡∏™‡∏£‡πâ‡∏≤‡∏á placeholder components ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô sheet ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≠‡∏°‡πÇ‡∏û‡πÄ‡∏ô‡∏ô‡∏ï‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå (‡∏î‡∏π Section 7 Warnings)

\---

\# 7\. Page Inventory (URLs & Screens)

\> Feature: \*\*‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\* ¬∑ Base Path: \*\*/erp/master/products\*\*

\#\# 7.1 URLs & Routing  
\- \*\*List\*\*: \`/erp/master/products\` ‚Äî ‡πÄ‡∏£‡∏¥‡πà‡∏° \`?page=1\&page\_size=25\&sort=-updated\_at\`  
\- \*\*Create\*\*: \`/erp/master/products/new\`  
\- \*\*Detail\*\*: \`/erp/master/products/:id\`  (tabs: \`/overview\`, \`/uom\`, \`/vendors\`, \`/tax-gl\`, \`/images\`, \`/audit\`)  
\- \*\*Edit\*\*: \`/erp/master/products/:id/edit\` (drawer)  
\- \*\*Import Drawer\*\*: \`/erp/master/products/import\` (drawer)  
\- \*\*Label / Print\*\*: flow via modal/drawer ‚Üí GET \`/api/master/products/{id}:label\`  
\- \*\*Routing guards\*\*: ‡∏´‡πâ‡∏≤‡∏° Edit ‡πÄ‡∏°‡∏∑‡πà‡∏≠ \`status=Obsolete\`; RBAC ‡πÑ‡∏°‡πà‡∏û‡∏≠ ‚Üí redirect \`/erp/master/products\` \+ toast 403

\#\# 7.2 Page Definitions

\#\#\# 7.2.1 Product List ‚Äî \`/erp/master/products\` (route: list)  
\*\*Purpose\*\*: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏Å‡∏£‡∏≠‡∏á, ‡∏ó‡∏≥ bulk actions ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞

\#\#\#\# Layout  
\- Grid Spec (‡∏à‡∏≤‡∏Å template packingList.v1): 12col; fixed-header; search row \+ filters; toolbar right-aligned (Import, Export, Create); table density=compact; checkbox ‡πÅ‡∏ñ‡∏ß‡∏ã‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î; numeric columns ‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| Breadcrumbs: ERP ‚Ä∫ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå ‚Ä∫ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤                                  |  
\+------------------------------------------------------------------------------+  
| H1 Title: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤                                                         |  
| H2 Subtitle: ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞                                      |  
\+------------------------------------------------------------------------------+  
| üîç Search: \[ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î/‡∏ä‡∏∑‡πà‡∏≠/‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ \]  |  
|                                                     Filter: 6 selected ‚ñº    |  
|                                                     \[ Advanced Filters \]     |  
\+------------------------------------------------------------------------------+  
|                                                     \[ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ \] \[ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å \] \[ ‡∏™‡∏£‡πâ‡∏≤‡∏á \] |  
\+------------------------------------------------------------------------------+  
| \[ \] Code  | Name           | Type   | Category | Base UOM | Tracking | Preferred |  
|--------------+------------+------------+--------------+-------------+--------|  
| ‚Ä¶ (rows rendered by data source; numeric ‚Üí right, badges center)            |  
\+------------------------------------------------------------------------------+  
| Showing 1‚Äì25 of 1,234                     ¬´ Previous  \[1\]  Next ¬ª           |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- breadcrumb ‚Üí \[\*\*Breadcrumbs\*\*\]  
\- header\_title ‚Üí \[\*\*PageHeaderTitle\*\*\] (‡πÅ‡∏™‡∏î‡∏á \*\*‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\*)  
\- header\_desc ‚Üí \[\*\*PageDescription\*\*\] (‡∏™‡∏±‡πâ‡∏ô)  
\- toolbar\_left ‚Üí \[\*\*SearchBar\*\*\] (field: \*\*q\*\*)  
\- controls\_top\_right ‚Üí \[\*\*FilterDropdown\*\*\] \+ \[\*\*AdvancedFilterDrawerV2\*\*\]  
\- toolbar\_right ‚Üí \[\*\*Button\*\* (Import), \*\*Button\*\* (Export), \*\*Button\*\* (Create)\]  
\- main ‚Üí \[\*\*MasterDataTable\*\*\] (configured as \[\*\*ProductTable\*\*\])  
  \- Table columns mapping (MasterDataTable row):  
    \- Code ‚Üí clickable link to Detail (field: \*\*code\*\*) \[\*\*Link\*\*\]  
    \- Name ‚Üí field: \*\*name\*\* \[\*\*Text\*\*\]  
    \- Type ‚Üí field: \*\*type\*\* \[\*\*Badge\*\*\]  
    \- Category ‚Üí field: \*\*category\_id\*\* (render name) \[\*\*Text\*\*\]  
    \- Base UOM ‚Üí field: \*\*base\_uom\*\* \[\*\*Text\*\*\]  
    \- Tracking ‚Üí field: \*\*tracking\*\* \[\*\*StatusBadge\*\*\]  
    \- Preferred Vendor ‚Üí derived from ProductVendor (field: \*\*preferred\_vendor\*\*) \[\*\*Text\*\*\]  
    \- Status ‚Üí field: \*\*status\*\* \[\*\*StatusBadge\*\*\]  
    \- Updated At ‚Üí field: \*\*updated\_at\*\* \[\*\*DateTime\*\*\]  
\- footer\_info ‚Üí \[\*\*ResultsInfo\*\*\]  
\- pagination ‚Üí \[\*\*PaginationControls\*\*\]

\#\#\#\# Actions / Events & Binding  
\- Toolbar:  
  \- \[\*\*Create\*\*\] \[\*\*Button\*\*\] ‚Üí GET \`/erp/master/products/new\` (open Create Drawer)  
  \- \[\*\*Import\*\*\] \[\*\*Button\*\*\] ‚Üí open \`/erp/master/products/import\` \[\*\*ImportDrawer\*\*\]  
  \- \[\*\*Export\*\*\] \[\*\*Button\*\*\] ‚Üí GET \`/api/master/products/export\` (scope: product.export)  
\- Row actions (per-row, visible by role/status):  
  \- \[\*\*Open\*\*\] ‚Üí GET \`/api/master/products/{id}\` ‚Üí open Detail \`/erp/master/products/{id}\`  
  \- \[\*\*Edit\*\*\] ‚Üí open Edit drawer \`/erp/master/products/{id}/edit\` (guard: status \!= Obsolete; role: Admin or Editor partial)  
  \- \[\*\*Submit\*\*\] ‚Üí POST \`/api/master/products/{id}:submit\` (headers: X-Idempotency-Key) ‚Äî visible status=Draft; role: Admin or Editor (C1)  
  \- \[\*\*Approve\*\*\] ‚Üí POST \`/api/master/products/{id}:approve\` (role: Approver/Finance) ‚Äî visible status=In Review  
  \- \[\*\*Activate\*\*\] ‚Üí POST \`/api/master/products/{id}:activate\` (role: Admin/Approver) ‚Äî visible status=Approved  
  \- \[\*\*Deactivate\*\*\] ‚Üí POST \`/api/master/products/{id}:deactivate\` (role: Approver/Admin) ‚Äî visible status=Active; precondition: no open PR/PO/GRN else API returns 409  
  \- \[\*\*Obsolete\*\*\] ‚Üí POST \`/api/master/products/{id}:obsolete\` (role: Admin) ‚Äî preconditions: on-hand \== 0 && no open documents  
  \- \[\*\*Print Label\*\*\] ‚Üí GET \`/api/master/products/{id}:label\` (open Label modal/preview) ‚Äî visible to all roles per matrix

\#\#\#\# Validation  
\- Search/Filter params validated server-side (status/type/category/vendor/tracking/updated\_range)  
\- Bulk export limited by max rows (system policy)  
\- Deactivate/Obsolete returns 409 if business guards fail

\#\#\#\# RBAC & Status Gating  
\- List visible to all roles  
\- Row action visibility per RBAC matrix (A2) and status model (A3)  
\- If role not allowed for action ‚Üí action hidden or disabled (preferred: hidden) and attempt to call API returns 403

\#\#\#\# Microcopy (i18n/A11y)  
\- Search placeholder: \*\*‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î/‡∏ä‡∏∑‡πà‡∏≠/‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î\*\*  
\- Button labels: \*\*‡∏™‡∏£‡πâ‡∏≤‡∏á\*\*, \*\*‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤\*\*, \*\*‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å\*\*  
\- Status badges aria-label: e.g., aria-label="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: Active"  
\- Table rows: checkbox first column with aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ {code}"

\#\#\#\# Journey Bindings  
\- J1 (Create & Submit): List \`/erp/master/products\` ‚Üí \[Create\] ‚Üí open Create Drawer ‚Üí Fill ‚Üí \[Save Draft\] ‚Üí Draft local ‚Üí \[Submit\] ‚Üí POST \`/api/master/products/{id}:submit\` ‚Üí status=In Review  
\- J2 (Approve & Activate): List row \[Approve\] ‚Üí POST \`/api/master/products/{id}:approve\` ‚Üí status=Approved ‚Üí then \[Activate\] ‚Üí POST \`/api/master/products/{id}:activate\` ‚Üí status=Active  
\- J6 (Import/Export/Label): \[Import\] ‚Üí open Import Drawer ‚Üí POST \`/api/master/products/import\` (X-Idempotency-Key); \[Export\] ‚Üí GET \`/api/master/products/export\`; \[Print Label\] ‚Üí GET \`/api/master/products/{id}:label\`

\#\#\#\# Notes  
\- Table head fixed; row density compact; numeric columns right-aligned

\---

\#\#\# 7.2.2 Product Create ‚Äî \`/erp/master/products/new\`  
\*\*Purpose\*\*: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (Save Draft / Submit) ‚Äî multi-section form ‡∏û‡∏£‡πâ‡∏≠‡∏° attachments ‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á barcodes/uom/vendors

\#\#\#\# Layout  
\- Template: createDrawer.v2 ‚Äî Drawer:right; width=40%; vertical form; footer sticky with \[Cancel\] \[Save as Draft\] \[Create\]

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| H1: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤                                            \[ ‚òê Expand \] \[  ‚úñ  \] |  
| Sub: ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÇ‡∏Ñ‡πâ‡∏î, ‡∏ä‡∏∑‡πà‡∏≠, UOM, GL/Tax ‡∏Ø‡∏•‡∏Ø)                          |  
\+------------------------------------------------------------------------------+  
| Form (scrollable)                                                            |  
| ‚îå Section: Header                                                            |  
| | \*\*‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\* \[Input\] (field: \*\*code\*\*)                                   |  
| | \*\*‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\* \[Input\] (field: \*\*name\*\*)                                    |  
| | \*\*‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó\*\* \[Select ‚ñæ\] (field: \*\*type\*\*)                                     |  
| | \*\*‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà\*\* \[Select ‚ñæ\] (field: \*\*category\_id\*\*)                            |  
| ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|  
| ‚îå Section: Classification                                                    |  
| | \*\*Base UOM\*\* \[Select ‚ñæ\] (field: \*\*base\_uom\*\*)                               |  
| | \*\*Purchase UOM\*\* \[Select ‚ñæ\] (field: \*\*purchase\_uom\*\*)                       |  
| | \*\*Tracking\*\* \[Select ‚ñæ\] (field: \*\*tracking\*\*)                                |  
| | \*\*Tax Code\*\* \[Select ‚ñæ\] (field: \*\*tax\_code\_id\*\*)                             |  
| | \*\*GL Inventory\*\* \[Select ‚ñæ\] (field: \*\*gl\_inventory\_acct\_id\*\*)                |  
| | \*\*GL Expense\*\* \[Select ‚ñæ\] (field: \*\*gl\_expense\_acct\_id\*\*)                    |  
| ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|  
| ‚îå Section: Dimensions                                                        |  
| | \*\*Weight\*\* \[InputNumber\] (field: \*\*weight\*\*)  \*\*Length/Width/Height\*\* etc.  |  
| ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|  
| ‚îå Section: Barcodes (table)                                                  |  
| | \[\*\*ProductBarcodeTable\*\*\] columns: symbology, value, is\_primary             |  
| ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|  
| ‚îå Section: UOM Conversions (table)                                           |  
| | \[\*\*ProductUomConvTable\*\*\] columns: from\_uom, to\_uom, factor                |  
| ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|  
| ‚îå Section: Vendors (table)                                                   |  
| | \[\*\*ProductVendorsTable\*\*\] columns: vendor\_id, preferred, moq, lead\_time    |  
| ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|  
| ‚îå Section: Attachments                                                       |  
| | \[\*\*FileUploader\*\*\] (images/docs)                                           |  
| ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|  
\+------------------------------------------------------------------------------+  
| Left:  \[Cancel\]                             Right: \[Save as Draft\] \[Create\]  |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- drawer\_header ‚Üí \[\*\*DrawerHeader\*\*\] (title/subtitle/actions)  
\- form\_body ‚Üí \[\*\*FormLayout\*\*\]  
\- form\_sections ‚Üí \[\*\*ProductForm\*\*\] (composed)  
  \- Header fields:  
    \- \*\*code\*\* ‚Üí \[\*\*Input\*\*\] (field: \*\*code\*\*)  
    \- \*\*name\*\* ‚Üí \[\*\*Input\*\*\] (field: \*\*name\*\*)  
    \- \*\*type\*\* ‚Üí \[\*\*Select\*\*\] (field: \*\*type\*\*, enum: Stock|NonStock|Service)  
    \- \*\*category\_id\*\* ‚Üí \[\*\*Select\*\*\] (field: \*\*category\_id\*\*)  
    \- \*\*status\*\* ‚Üí \[\*\*StatusBadge\*\*\] (field: \*\*status\*\*, RO)  
    \- \*\*remarks\*\* ‚Üí \[\*\*Textarea\*\*\] (field: \*\*remarks\*\*)  
  \- Classification:  
    \- \*\*base\_uom\*\*, \*\*purchase\_uom\*\*, \*\*tracking\*\*, \*\*tax\_code\_id\*\*, \*\*gl\_inventory\_acct\_id\*\*, \*\*gl\_expense\_acct\_id\*\* ‚Üí \[\*\*Select\*\*\]/\[\*\*Input\*\*\] per field  
  \- Dimensions:  
    \- \*\*weight\*\*, \*\*length\*\*, \*\*width\*\*, \*\*height\*\*, \*\*weight\_uom\*\*, \*\*volume\_uom\*\* ‚Üí \[\*\*InputNumber\*\*\]/\[\*\*Select\*\*\]  
  \- Barcodes:  
    \- table: \[\*\*ProductBarcodeTable\*\*\] rows (fields: \*\*symbology\*\*, \*\*value\*\*, \*\*is\_primary\*\*) ‚Üí \[\*\*Input\*\*\]/\[\*\*Select\*\*\]/\[\*\*Checkbox\*\*\]  
  \- UOM Conversions:  
    \- table: \[\*\*ProductUomConvTable\*\*\] (fields: \*\*from\_uom\*\*, \*\*to\_uom\*\*, \*\*factor\*\*)  
  \- Vendors:  
    \- table: \[\*\*ProductVendorsTable\*\*\] (fields: \*\*vendor\_id\*\*, \*\*vendor\_sku\*\*, \*\*preferred\*\*, \*\*moq\*\*, \*\*lead\_time\_days\*\*, \*\*price\_hint\*\*, \*\*currency\*\*)  
  \- Attachments:  
    \- \[\*\*FileUploader\*\*\] for images/docs (ProductImage/ProductDoc)

\- footer\_buttons ‚Üí \[\*\*Button\*\*(cancel), \*\*Button\*\*(save\_draft), \*\*Button\*\*(create)\]

\#\#\#\# Actions / Events & Binding  
\- \[\*\*Save as Draft\*\*\] ‚Üí POST \`/api/master/products\` (X-Idempotency-Key) ‚Üí 201 draft (response: id, etag)  
\- \[\*\*Create\*\*\] (aka Submit on create) ‚Üí if user chooses Save+Submit: POST \`/api/master/products\` then POST \`/api/master/products/{id}:submit\` (X-Idempotency-Key recommended)  
\- Attachment upload ‚Üí multipart POST to file service (file\_url stored in ProductImage/ProductDoc) ‚Äî (implementation detail beyond APIs list)  
\- Client must collect response ETag and store for subsequent PATCH (If-Match)

\#\#\#\# Validation  
\- Required: \*\*code\*\*, \*\*name\*\*, \*\*base\_uom\*\*  
\- Must have at least one barcode row with \*\*is\_primary\*\* \= true (J1)  
\- GL/tax required for submission if org policy requires (precondition for Approved)  
\- UOM conversion table must validate acyclic graph (no cycles) on client-side prior to submit  
\- Vendors: one \*\*preferred\*\* per currency validated client/server-side

\#\#\#\# RBAC & Status Gating  
\- Create Drawer visible only to \*\*Admin\*\*  
\- Editor role cannot access full create (per A2)  
\- \[\*\*Create\*\*\]/\[\*\*Save Draft\*\*\] actions allowed: Admin; Import uses X-Idempotency-Key and only Admin

\#\#\#\# Microcopy (i18n/A11y)  
\- Create primary button: \*\*‡∏™‡∏£‡πâ‡∏≤‡∏á\*\* aria-label="‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"  
\- Save draft tooltip: \*\*‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡πà‡∏≤‡∏á\*\*  
\- Barcode table column header checkbox aria: "‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏Å"

\#\#\#\# Journey Bindings  
\- J1: Create Drawer \`/erp/master/products/new\` ‚Üí \[Save as Draft\] ‚Üí POST \`/api/master/products\` (X-Idempotency-Key) ‚Üí Draft  
\- J1: After draft saved ‚Üí \[Submit\] (in drawer or after save) ‚Üí POST \`/api/master/products/{id}:submit\` ‚Üí status=In Review; Preconditions: required fields \+ ‚â•1 barcode

\#\#\#\# Notes  
\- FormGuard (\[\*\*FormGuard\*\*\]) to warn on unsaved changes and ensure If-Match for subsequent edits

\---

\#\#\# 7.2.3 Product Edit ‚Äî \`/erp/master/products/:id/edit\` (drawer)  
\*\*Purpose\*\*: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏£‡πâ‡∏≤‡∏á revision ‡∏´‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏¥‡∏•‡∏î‡πå critical ‡∏Ç‡∏ì‡∏∞ Active)

\#\#\#\# Layout  
\- Template: editStepperDrawer.v1 ‚Äî Drawer:right; width=45%; stepper optional; footer sticky with \[Back\]\[Next\]\[Save\]

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| H1: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Äî PROD-000123                         \[ ‚òê Expand \] \[ ‚úñ \]    |  
| Sub: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (ETag required)                                       |  
\+------------------------------------------------------------------------------+  
| Stepper: ‚óè 1\. Header  ‚Äî ‚óã 2\. Classification ‚Äî ‚óã 3\. Barcodes ‚Äî ‚óã 4\. Vendors     |  
\+------------------------------------------------------------------------------+  
| Section: Header                                                              |  
| | \*\*‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\* \[Input (readonly when created)\] (field: \*\*code\*\*)           |  
| | \*\*‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\* \[Input\] (field: \*\*name\*\*)                                   |  
| | \*\*‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞\*\* \[StatusBadge\] (field: \*\*status\*\*) (RO)                           |  
\+------------------------------------------------------------------------------+  
| (Tabs optional inside drawer)                                                 |  
\+------------------------------------------------------------------------------+  
| Left: \[Cancel\]                             Right: \[‚Üê Back\] \[Next ‚Üí\] \[Save\]    |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- drawer\_header ‚Üí \[\*\*DrawerHeader\*\*\] (meta: entity\_code)  
\- stepper ‚Üí \[\*\*Stepper\*\*\] (current step indicator)  
\- content\_sections ‚Üí \[\*\*ProductForm\*\*\] (pre-filled, supports ETag via \[\*\*FormGuard\*\*\])  
\- footer\_buttons ‚Üí \[\*\*Button\*\*(cancel), \*\*Button\*\*(back), \*\*Button\*\*(next), \*\*Button\*\*(save)\]

\#\#\#\# Actions / Events & Binding  
\- Load: GET \`/api/master/products/{id}\` ‚Üí returns ETag  
\- Save: PATCH \`/api/master/products/{id}\` (If-Match: \`\<etag\>\`) ‚Üí 200 or 412  
\- If client changes critical field while \`status=Active\` ‚Üí client should:  
  \- PATCH as draft revision (server stores revision) ‚Üí POST \`/api/master/products/{id}:submit\` to start re-approval (emit product.revision\_submitted)  
\- Buttons:  
  \- \[\*\*Save\*\*\] ‚Üí PATCH \`/api/master/products/{id}\` (If-Match)  
  \- \[\*\*Submit\*\*\] (if triggered by critical-edit) ‚Üí POST \`/api/master/products/{id}:submit\`  
\- Concurrency:  
  \- On 412 ‚Üí show merge dialog and option to refresh

\#\#\#\# Validation  
\- Same field validations as Create  
\- Critical field edit detection list (base\_uom, tax\_code\_id, gl\_\* , tracking) ‚Üí triggers revision flow

\#\#\#\# RBAC & Status Gating  
\- Edit allowed: Admin for all fields; Editor limited to vendors and non-critical fields (C1)  
\- Edit disabled when status \= Obsolete (read-only)

\#\#\#\# Microcopy (i18n/A11y)  
\- ETag mismatch message (‡πÑ‡∏ó‡∏¢): \*\*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å\*\* (provide action: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà / ‡∏¢‡∏∏‡∏ï‡∏¥)  
\- Save button label: \*\*‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å\*\*

\#\#\#\# Journey Bindings  
\- J5 Edit flow: Detail ‚Üí \[Edit\] ‚Üí open Edit Drawer ‚Üí change critical ‚Üí PATCH (If-Match) ‚Üí server creates revision ‚Üí POST \`/api/master/products/{id}:submit\` ‚Üí status transitions to In Review (revision flow)

\#\#\#\# Notes  
\- FormGuard must prompt to obtain latest ETag before saving changes

\---

\#\#\# 7.2.4 Product Detail ‚Äî Overview Tab ‚Äî \`/erp/master/products/:id\` (tab: overview)  
\*\*Purpose\*\*: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏° (Header \+ Key details) ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á action (Submit/Approve/Activate/Deactivate/Obsolete/Print Label)

\#\#\#\# Layout  
\- Template: viewDrawer.v1 (applied as full Detail page layout) ‚Äî header \+ tabs \+ key-value sections

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| Breadcrumbs: ERP ‚Ä∫ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå ‚Ä∫ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Ä∫ PROD-000123                    |  
\+------------------------------------------------------------------------------+  
| H1: PROD-000123 ‚Äî ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤                                       \[Edit\] \[‚ãØ\] |  
| Sub: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: Stock ¬∑ ‡∏´‡∏°‡∏ß‡∏î: Raw Materials ¬∑ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: Active                       |  
\+------------------------------------------------------------------------------+  
| Tabs: Overview | UOM | Vendors | Tax/GL | Images/Docs | Audit                 |  
\+------------------------------------------------------------------------------+  
| Section: Key Details                                                         |  
|  ‚Ä¢ ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ : PROD-000123                                                  |  
|  ‚Ä¢ ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ : ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤                                                |  
|  ‚Ä¢ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó : Stock                                                           |  
|  ‚Ä¢ Base UOM : PCS                                                            |  
|  ‚Ä¢ Tracking : Lot                                                            |  
|  ‚Ä¢ GL Inventory : 1100-INV                                                   |  
|  ‚Ä¢ Updated At : 2025-11-01 09:12                                              |  
\+------------------------------------------------------------------------------+  
| Actions (header/right) : \[Submit\] \[Approve\] \[Activate\] \[Deactivate\] \[Obsolete\] |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- drawer\_header / page header ‚Üí \[\*\*DrawerHeader\*\*\] / \[\*\*PageHeader\*\*\]  
\- tabs ‚Üí \[\*\*Tabs\*\*\] (Overview default)  
\- content\_sections ‚Üí \[\*\*KeyValueGrid-2col\*\*\] for overview fields  
\- footer\_buttons / header actions ‚Üí \[\*\*StatusActions\*\*\], \[\*\*ApprovalActions\*\*\], \[\*\*Button\*\* Print Label\]

Fields / Components mapping (Overview)  
\- \*\*code\*\* ‚Üí \[\*\*Text\*\*\] (field: \*\*code\*\*)  
\- \*\*name\*\* ‚Üí \[\*\*Text\*\*\] (field: \*\*name\*\*)  
\- \*\*type\*\* ‚Üí \[\*\*Badge\*\*\] (field: \*\*type\*\*)  
\- \*\*category\_id\*\* ‚Üí \[\*\*Text\*\*\]  
\- \*\*base\_uom\*\* ‚Üí \[\*\*Text\*\*\]  
\- \*\*purchase\_uom\*\* ‚Üí \[\*\*Text\*\*\]  
\- \*\*tracking\*\* ‚Üí \[\*\*StatusBadge\*\*\]  
\- \*\*status\*\* ‚Üí \[\*\*StatusBadge\*\*\]  
\- \*\*gl\_inventory\_acct\_id\*\*, \*\*gl\_expense\_acct\_id\*\*, \*\*tax\_code\_id\*\* ‚Üí \[\*\*Masked/RO\*\* unless role Approver/Admin\]  
\- Primary actions in header mapped to StatusActions component

\#\#\#\# Actions / Events & Binding  
\- \[\*\*Edit\*\*\] ‚Üí open Edit Drawer \`/erp/master/products/:id/edit\` (role gating)  
\- \[\*\*Submit\*\*\] ‚Üí POST \`/api/master/products/{id}:submit\` (visible when status=Draft)  
\- \[\*\*Approve\*\*\] ‚Üí POST \`/api/master/products/{id}:approve\` (visible when status=In Review, role=Approver)  
\- \[\*\*Activate\*\*\] ‚Üí POST \`/api/master/products/{id}:activate\` (visible when status=Approved)  
\- \[\*\*Deactivate\*\*\] ‚Üí POST \`/api/master/products/{id}:deactivate\` (visible when status=Active; precondition: no open PR/PO/GRN else 409\)  
\- \[\*\*Obsolete\*\*\] ‚Üí POST \`/api/master/products/{id}:obsolete\` (preconditions: on-hand \== 0 && no open docs)  
\- \[\*\*Print Label\*\*\] ‚Üí GET \`/api/master/products/{id}:label\` ‚Üí open PDF preview

\#\#\#\# Validation  
\- Attempt to Approve requires GL/Tax/Base UOM present ‚Üí otherwise server returns 422  
\- Activate requires no open references ‚Üí server returns 409 if conflict

\#\#\#\# RBAC & Status Gating  
\- Read: all roles  
\- Edit: Admin or Editor (conditional)  
\- Approve/Activate: Approver/Finance (A2), Admin permitted per DOA

\#\#\#\# Microcopy (i18n/A11y)  
\- Status badges: \*\*‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: Draft / In Review / Approved / Active / Inactive / Obsolete\*\*  
\- Approve modal label: \*\*‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\*

\#\#\#\# Journey Bindings  
\- J2: Detail \`/erp/master/products/:id\` ‚Üí \[Approve\] ‚Üí POST \`/api/master/products/{id}:approve\` ‚Üí on success emit product.approved and keep user on Detail with toast  
\- J2: After approve ‚Üí \[Activate\] ‚Üí POST \`/api/master/products/{id}:activate\` ‚Üí emit product.activated and toast \+ possibly redirect to usage docs

\---

\#\#\# 7.2.5 Product Detail ‚Äî UOM Tab ‚Äî \`/erp/master/products/:id/uom\`  
\*\*Purpose\*\*: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏õ‡∏•‡∏á (validate acyclic graph; critical-change triggers re-approval)

\#\#\#\# Layout  
\- Template: viewDrawer.v1 content section with DataTable for conversions; 12-col with table

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| Tabs: Overview | UOM (active) | Vendors | Tax/GL | Images/Docs | Audit        |  
\+------------------------------------------------------------------------------+  
| Section: UOM Conversions                                                      |  
| Columns: From UOM | To UOM | Factor | Actions                                 |  
| \--------------------------------------------------------------------------- |  
| PCS              | BOX    | 0.100000 | \[Edit\] \[Delete\]                         |  
| ‚Ä¶                                                                           |  
\+------------------------------------------------------------------------------+  
| \[Add Conversion\] (bottom-left)                                \[Save Changes\]  |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- tabs ‚Üí \[\*\*Tabs\*\*\]  
\- content\_sections ‚Üí \[\*\*ProductUomConvTable\*\*\]  
  \- fields: \*\*from\_uom\*\* \[\*\*Select\*\*\], \*\*to\_uom\*\* \[\*\*Select\*\*\], \*\*factor\*\* \[\*\*InputNumber\*\*\]

\#\#\#\# Actions / Events & Binding  
\- Add row ‚Üí client insert ‚Üí validate acyclic ‚Üí PATCH \`/api/master/products/{id}\` (If-Match)  
\- Edit row ‚Üí PATCH \`/api/master/products/{id}\` (If-Match)  
\- On save: if product \*\*status=Active\*\* and change touches critical unit mapping ‚Üí client should POST \`/api/master/products/{id}:submit\` to start re-approval (emit product.revision\_submitted)

\#\#\#\# Validation  
\- Acyclic graph validation (client & server): disallow cycles; numeric factor precision decimal(18,6)  
\- Unique pair (from\_uom, to\_uom) per product

\#\#\#\# RBAC & Status Gating  
\- Create/Update conversions: Admin full; Editor cannot (A2)  
\- If Active & critical-change ‚Üí requires re-approval (submit)

\#\#\#\# Microcopy (i18n/A11y)  
\- Add button: \*\*‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏õ‡∏•‡∏á\*\*  
\- Validation message: \*\*‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏á‡∏à‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á (cycle) ‡πÑ‡∏î‡πâ\*\*

\#\#\#\# Journey Bindings  
\- J3: Detail UOM tab ‚Üí add/edit conversions ‚Üí validate ‚Üí if Active+critical ‚Üí PATCH \+ POST \`/api/master/products/{id}:submit\` ‚Üí status In Review for revision

\---

\#\#\# 7.2.6 Product Detail ‚Äî Vendors Tab ‚Äî \`/erp/master/products/:id/vendors\`  
\*\*Purpose\*\*: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• vendor ‡∏ï‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (preferred per currency constraint)

\#\#\#\# Layout  
\- Template: viewDrawer.v1 with table card for vendors

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| Tabs: Overview | UOM | Vendors (active) | Tax/GL | Images/Docs | Audit        |  
\+------------------------------------------------------------------------------+  
| Section: Vendors                                                             |  
| Columns: Vendor | Vendor SKU | Preferred | MOQ | Lead Time (days) | Price  |  
| \--------------------------------------------------------------------------- |  
| Vendor A    | SKU-A        | ‚óè         | 10  | 7                | 12.3456  |  
| ‚Ä¶                                                                           |  
\+------------------------------------------------------------------------------+  
| \[Add Vendor\]                                \[Save Vendors\]                   |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- content\_sections ‚Üí \[\*\*ProductVendorsTable\*\*\]  
  \- fields: \*\*vendor\_id\*\* \[\*\*Select\*\*\], \*\*vendor\_sku\*\* \[\*\*Input\*\*\], \*\*preferred\*\* \[\*\*Checkbox\*\*\], \*\*moq\*\* \[\*\*InputNumber\*\*\], \*\*lead\_time\_days\*\* \[\*\*InputNumber\*\*\], \*\*price\_hint\*\* \[\*\*InputNumber\*\*\], \*\*currency\*\* \[\*\*Select\*\*\]

\#\#\#\# Actions / Events & Binding  
\- Add/Edit/Delete vendor row ‚Üí PATCH \`/api/master/products/{id}\` (If-Match)  
\- Server validates: only one \*\*preferred\*\* per currency; if violation ‚Üí 422

\#\#\#\# Validation  
\- One preferred vendor per currency  
\- MOQ ‚â• 0; lead\_time\_days integer ‚â• 0; price\_hint decimal(18,4)

\#\#\#\# RBAC & Status Gating  
\- Editor (Procurement) can add/update vendor rows (C1)  
\- Admin can full manage vendors

\#\#\#\# Microcopy (i18n/A11y)  
\- Preferred hint: \*\*‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏ï‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô\*\*  
\- Add vendor button: \*\*‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢\*\*

\#\#\#\# Journey Bindings  
\- J4: Vendors tab ‚Üí add vendor ‚Üí client-side validate preferred-per-currency ‚Üí PATCH \`/api/master/products/{id}\` (If-Match) ‚Üí emit product.vendor.updated

\---

\#\#\# 7.2.7 Product Detail ‚Äî Tax/GL Tab ‚Äî \`/erp/master/products/:id/tax-gl\`  
\*\*Purpose\*\*: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏†‡∏≤‡∏©‡∏µ (Finance review area)

\#\#\#\# Layout  
\- Template: viewDrawer.v1 key-value card with edit controls (GL accounts masked for non-approver)

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| Tabs: Overview | UOM | Vendors | Tax/GL (active) | Images/Docs | Audit        |  
\+------------------------------------------------------------------------------+  
| Section: Tax & GL Mapping                                                    |  
|  ‚Ä¢ Tax Code : VAT-7                                                       \[Edit\]|  
|  ‚Ä¢ GL Inventory Account : 1100-INV (masked for non-Finance)                 |  
|  ‚Ä¢ GL Expense Account : 5000-COGS                                         |  
\+------------------------------------------------------------------------------+  
| \[Request Change\] (for non-Finance)                      \[Save Changes\] \[Approve\] |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- content\_sections ‚Üí \[\*\*KeyValueGrid\*\*\] \+ \[\*\*SelectDropdown\*\*\] for edit  
  \- \*\*tax\_code\_id\*\*, \*\*gl\_inventory\_acct\_id\*\*, \*\*gl\_expense\_acct\_id\*\* ‚Üí \[\*\*Select\*\*\] (Finance/Admin editable; Viewer masked)

\#\#\#\# Actions / Events & Binding  
\- Save changes ‚Üí PATCH \`/api/master/products/{id}\` (If-Match)  
\- Approve (finance) ‚Üí POST \`/api/master/products/{id}:approve\` (when status=In Review)  
\- Change detection for critical fields triggers revision flow if product Active

\#\#\#\# Validation  
\- GL accounts must exist in GL master; server returns 422 if invalid  
\- Field-level masking for roles without permission

\#\#\#\# RBAC & Status Gating  
\- Edit visible to Approver/Finance and Admin only  
\- Viewer sees read-only masked fields

\#\#\#\# Microcopy (i18n/A11y)  
\- Field helper: \*\*GL account ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥\*\*

\#\#\#\# Journey Bindings  
\- J2: Finance reviews Tax/GL tab ‚Üí \[Approve\] ‚Üí POST \`/api/master/products/{id}:approve\`

\---

\#\#\# 7.2.8 Product Detail ‚Äî Images/Docs Tab ‚Äî \`/erp/master/products/:id/images\`  
\*\*Purpose\*\*: ‡∏î‡∏π/‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö (Spec/MSDS/Cert/Other)

\#\#\#\# Layout  
\- Template: viewDrawer.v1 attachment card \+ file list

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| Tabs: Overview | UOM | Vendors | Tax/GL | Images/Docs (active) | Audit      |  
\+------------------------------------------------------------------------------+  
| Section: Images                                                               |  
| \[ Thumbnail grid: primary image highlighted \]                                 |  
\+------------------------------------------------------------------------------+  
| Section: Documents                                                            |  
| Columns: Doc Type | File Name | Uploaded By | Actions (Download/Delete)     |  
\+------------------------------------------------------------------------------+  
| \[Upload Image\] \[Upload Document\]                                              |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- content\_sections ‚Üí \[\*\*AttachmentPanel\*\*\], \[\*\*FileUploader\*\*\]  
  \- ProductImage: \*\*url\*\*, \*\*alt\_text\*\*, \*\*is\_primary\*\*  
  \- ProductDoc: \*\*file\_url\*\*, \*\*doc\_type\*\*

\#\#\#\# Actions / Events & Binding  
\- Upload image/doc ‚Üí file service ‚Üí PATCH \`/api/master/products/{id}\` (If-Match) with returned file\_url  
\- Download ‚Üí direct GET to file\_url

\#\#\#\# Validation  
\- Allowed doc types: Spec|MSDS|Cert|Other  
\- Max file size/config per system policy

\#\#\#\# RBAC & Status Gating  
\- Upload/Delete allowed for Admin; Editor limited for docs images tied to vendors maybe per policy

\#\#\#\# Microcopy (i18n/A11y)  
\- Upload hint: \*\*‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .jpg .png .pdf ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB\*\*

\#\#\#\# Journey Bindings  
\- J1 optional attachments step: Create ‚Üí Upload images/docs before Submit

\---

\#\#\# 7.2.9 Product Detail ‚Äî Audit Tab ‚Äî \`/erp/master/products/:id/audit\`  
\*\*Purpose\*\*: ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ (audit trail) ‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ

\#\#\#\# Layout  
\- Template: viewDrawer.v1 with ActivityLog card

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| Tabs: Overview | UOM | Vendors | Tax/GL | Images/Docs | Audit (active)        |  
\+------------------------------------------------------------------------------+  
| Section: Audit Log                                                            |  
| ‚Ä¢ 2025-11-02 09:10 ‚Äî user@domain ‚Äî Submitted (Draft ‚Üí In Review) \[View\]       |  
| ‚Ä¢ 2025-11-03 14:22 ‚Äî finance@ ‚Äî Approved (In Review ‚Üí Approved) \[View Notes\]  |  
| ‚Ä¶                                                                            |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- content\_sections ‚Üí \[\*\*ActivityLog\*\*\] (list of audit entries with actor/role/timestamp/action/reason/diff)

\#\#\#\# Actions / Events & Binding  
\- Read-only GET \`/api/master/products/{id}\` includes audit or separate GET \`/api/master/products/{id}/audit\` (implementation detail)  
\- Each audit entry may open a modal to view snapshot/diff

\#\#\#\# Validation  
\- Pagination and time-range filters for large audit logs

\#\#\#\# RBAC & Status Gating  
\- Audit view visible to all roles; sensitive data redacted for non-Admin if policy applies

\#\#\#\# Microcopy (i18n/A11y)  
\- Audit heading: \*\*‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\*

\#\#\#\# Journey Bindings  
\- All transitions (submit/approve/activate/deactivate/obsolete) emit events logged here

\---

\#\#\# 7.2.10 Import Drawer ‚Äî \`/erp/master/products/import\`  
\*\*Purpose\*\*: ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏î‡πâ‡∏ß‡∏¢ CSV/XLSX ‚Üí preview validation ‚Üí commit

\#\#\#\# Layout  
\- Template: importDrawer.v1 ‚Äî Drawer:right; width=45%; stepper (Upload ‚Üí Preview & Confirm), left content dropzone (7/12) and required columns list (5/12)

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| H1: ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Import)                               \[ ‚òê Expand \] \[ ‚úñ \]   |  
| Sub: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV/XLSX ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å                         |  
\+------------------------------------------------------------------------------+  
| Stepper: ‚óè 1\. Upload File   ‚óã 2\. Preview & Confirm                         |  
\+------------------------------------------------------------------------------+  
| ‚¨Ü Drag and drop your file here, or browse                                   |  
| Supported formats: .csv, .xlsx; Max size: 10MB                              |  
| \[ SelectedFile.csv \]  \[ Remove \]                                            |  
\+------------------------------------------------------------------------------+  
| Required Columns: Code (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á), Name, Base UOM, Category, Type          |  
\+------------------------------------------------------------------------------+  
| Left:  \[Cancel\]                                  Right:  \[Next ‚Üí\]            |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- drawer\_header ‚Üí \[\*\*DrawerHeader\*\*\]  
\- stepper ‚Üí \[\*\*Stepper\*\*\]  
\- helper\_actions ‚Üí \[\*\*InlineHelp\*\*\] \+ \[\*\*Button(download\_template)\*\*\]  
\- main\_left ‚Üí \[\*\*FileDropzone\*\*\], \[\*\*FileChipList\*\*\]  
\- main\_right ‚Üí \[\*\*RequiredColumnsList\*\*\]  
\- footer\_buttons ‚Üí \[\*\*Button\*\*(cancel), \*\*Button\*\*(next/upload)\]

\#\#\#\# Actions / Events & Binding  
\- Upload ‚Üí client upload ‚Üí server parse \+ validate ‚Üí returns preview (422 rows flagged)  
\- Commit ‚Üí POST \`/api/master/products/import\` (X-Idempotency-Key) ‚Üí response: import report  
\- Preview step must show per-row validation messages; user can fix errors or skip rows per policy

\#\#\#\# Validation  
\- CSV columns mapping; required columns; per-row validation returns 422 details  
\- Idempotency via X-Idempotency-Key on commit

\#\#\#\# RBAC & Status Gating  
\- Import allowed to Admin; Editor may have conditional (C1/C4) for vendor/catalog import

\#\#\#\# Microcopy (i18n/A11y)  
\- Template download: \*\*‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï (.csv)\*\*  
\- Import commit confirmation: \*\*‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ ‚Äî ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\*\*

\#\#\#\# Journey Bindings  
\- J6: From List \[Import\] ‚Üí Import Drawer ‚Üí Upload ‚Üí Preview ‚Üí Commit ‚Üí POST \`/api/master/products/import\` (X-Idempotency-Key) ‚Üí server creates drafts/updates per import mode

\---

\#\#\# 7.2.11 Delete / Deactivate / Obsolete Confirm Modal ‚Äî (modal)  
\*\*Purpose\*\*: ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏ñ‡∏≤‡∏ß‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏∂‡πà‡∏á‡∏ñ‡∏≤‡∏ß‡∏£ (soft-delete/deactivate/obsolete) ‡πÇ‡∏î‡∏¢‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö

\#\#\#\# Layout  
\- Template: deleteConfirm.v1 ‚Äî Modal:center; width‚âà480px; header icon \+ title; footer right-aligned \[Cancel\] \[Delete\]

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
|                           ‚ö†Ô∏è  ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô: ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PROD-000123            |  
\+------------------------------------------------------------------------------+  
| ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô \*\*PROD-000123\*\*?                  |  
| ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ (Obsolete) ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ |  
| Context: ‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô PR-00045 (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)                                      |  
\+------------------------------------------------------------------------------+  
|                                               \[ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å \]   \[ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å) \] |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- modal\_header ‚Üí \[\*\*Icon(Warning)\*\*\] \+ \[\*\*ModalTitle\*\*\]  
\- modal\_body ‚Üí \[\*\*Paragraph\*\*\] \+ context text  
\- modal\_footer ‚Üí \[\*\*Button\*\*(cancel), \*\*Button\*\*(confirm-danger)\]

\#\#\#\# Actions / Events & Binding  
\- Confirm Delete/Deactivate ‚Üí POST \`/api/master/products/{id}:deactivate\` or POST \`/api/master/products/{id}:obsolete\` or DELETE \`/api/master/products/{id}\`  
\- API returns:  
  \- 200 on success  
  \- 409 if business guard (open PR/PO/GRN or on-hand \> 0\)  
  \- 403 if RBAC insufficient

\#\#\#\# Validation  
\- If precondition fails ‚Üí show server reason (e.g., "‡∏°‡∏µ PR/PO/GRN ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà: PR-00045")

\#\#\#\# RBAC & Status Gating  
\- Only Admin/Approver per policy can perform Deactivate/Obsolete (A2 \+ C3)  
\- Obsolete irreversible; require explicit confirmation checkbox "‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö"

\#\#\#\# Microcopy (i18n/A11y)  
\- Warning title: \*\*‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô\*\*  
\- Danger confirm button: \*\*‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)\*\* aria-label="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß/‡∏ñ‡∏≤‡∏ß‡∏£"

\#\#\#\# Journey Bindings  
\- J5: From List/Detail ‚Üí \[Deactivate\] modal ‚Üí confirm ‚Üí POST \`/api/master/products/{id}:deactivate\` ‚Üí 200 or 409 conflict  
\- J5: From List/Detail ‚Üí \[Obsolete\] modal ‚Üí confirm with extra guard ‚Üí POST \`/api/master/products/{id}:obsolete\`

\---

\#\#\# 7.2.12 Print Label / Label Template Modal ‚Äî (modal/drawer)  
\*\*Purpose\*\*: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å template ‡∏â‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (PDF)

\#\#\#\# Layout  
\- Template: viewDrawer.v1 (used as modal/drawer for preview \+ template select)

\#\#\#\# ASCII Wireframe  
\`\`\`   
\+------------------------------------------------------------------------------+  
| H1: ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å ‚Äî PROD-000123                                  \[ ‚úñ \]         |  
\+------------------------------------------------------------------------------+  
| ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏â‡∏•‡∏≤‡∏Å: \[Select ‚ñæ\]                                              |  
| ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF Preview                                                         |  
| \--------------------------------------------------------------------------- |  
| \[Download PDF\]                                 \[Cancel\]    \[Print Label\]      |  
\+------------------------------------------------------------------------------+  
\`\`\`

\#\#\#\# Components (by slots)  
\- header ‚Üí \[\*\*DrawerHeader\*\*\] / modal title  
\- template\_select ‚Üí \[\*\*Select\*\*\] (list of barcode templates)  
\- preview ‚Üí \[\*\*PDFPreview\*\*\] (iframe or embedded viewer)  
\- actions ‚Üí \[\*\*Button\*\*(download), \*\*Button\*\*(print)\]

\#\#\#\# Actions / Events & Binding  
\- Fetch label ‚Üí GET \`/api/master/products/{id}:label\` (scope product.label) ‚Üí returns PDF or job id  
\- Choose template parameter ‚Üí GET \`/api/master/products/{id}:label?template={template\_id}\`  
\- On success: download or open PDF preview

\#\#\#\# Validation  
\- Template must support product's symbology/tracking; if unsupported return 422

\#\#\#\# RBAC & Status Gating  
\- All roles can view/print labels per A2 (Warehouse/View allowed)  
\- If role lacks product.read ‚Üí 403

\#\#\#\# Microcopy (i18n/A11y)  
\- Select template label: \*\*‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏â‡∏•‡∏≤‡∏Å\*\*  
\- Download button: \*\*‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF\*\*

\#\#\#\# Journey Bindings  
\- J6: From List/Detail ‚Üí \[Print Label\] ‚Üí modal ‚Üí select template ‚Üí GET \`/api/master/products/{id}:label\` ‚Üí PDF

\---

\#\# 7.3 Screen Components (React-friendly names)  
\- Pages: ProductListPage, ProductCreatePage, ProductDetailPage, ProductEditPage  
\- Composables: ProductFilterBar, ProductTable, PaginationBar, BulkActionsBar, ProductForm, FormActionBar, FormGuard, ToastHost, ActivityLog, StatusActions, ApprovalActions, AttachmentPanel, ProductUomConvTable, ProductVendorsTable, ProductBarcodeTable

\#\# 7.4 Client Flows (Create/Update/Delete/Restore/Bulk)  
\- Create: client-validate ‚Üí POST /api/master/products (+ X-Idempotency-Key) ‚Üí 201 \+ ETag ‚Üí redirect to Detail  
\- Submit: POST /api/master/products/{id}:submit (+Idempotency) ‚Üí 200 ‚Üí status=In Review ‚Üí emit product.submitted  
\- Approve: POST /api/master/products/{id}:approve ‚Üí 200 ‚Üí status=Approved ‚Üí emit product.approved  
\- Activate: POST /api/master/products/{id}:activate ‚Üí 200 ‚Üí status=Active ‚Üí emit product.activated  
\- Update: GET \=\> obtain ETag ‚Üí PATCH /api/master/products/{id} (If-Match) ‚Üí 200 or 412  
\- Delete (soft / deactivate / obsolete): POST /api/master/products/{id}:deactivate | POST /api/master/products/{id}:obsolete ‚Üí 200 | 409  
\- Import: POST /api/master/products/import (X-Idempotency-Key) after preview ‚Üí server import report

\#\# 7.5 Microcopy / Empty / Error States (i18n & A11y)  
\- Empty List: \*\*‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ô‡∏µ‡πâ\*\*  
\- Confirm Submit: \*\*‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\*\*  
\- 403: \*\*‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ\*\*  
\- 409: \*\*‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà: {ref}\*\*  
\- 412: \*\*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å\*\*  
\- All toasts: short Thai message \+ role-appropriate detail; aria-live polite

\#\# 7.6 Journey ‚Üî Page Crosswalk (‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)  
\- J1 Create & Submit ‚Üí ProductCreatePage ‚Üí \[Save Draft\] (POST /api/master/products) ‚Üí \[Submit\] (POST /api/master/products/{id}:submit)  
\- J2 Approve & Activate ‚Üí ProductDetailPage (Tax/GL tab) ‚Üí \[Approve\] (POST /api/master/products/{id}:approve) ‚Üí \[Activate\] (POST /api/master/products/{id}:activate)  
\- J3 Maintain UOM ‚Üí ProductDetailPage (UOM tab) ‚Üí \[Save\] ‚Üí PATCH (If-Match) ‚Üí optionally POST :submit if Active+critical  
\- J4 Vendors ‚Üí ProductDetailPage (Vendors tab) ‚Üí PATCH \`/api/master/products/{id}\` (If-Match)  
\- J5 Deactivate/Obsolete ‚Üí ProductList/ProductDetail ‚Üí confirm modal ‚Üí POST :deactivate/:obsolete  
\- J6 Import/Export/Label ‚Üí List toolbar \+ ImportDrawer \+ GET /export \+ GET /:label

\#\#\# Warnings (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)  
\- template\_source used:  
  \- Product List ‚Üí packingList.v1 (template\_source=packingList.v1)  
  \- Create ‚Üí createDrawer.v2 (template\_source=createDrawer.v2)  
  \- Edit ‚Üí editStepperDrawer.v1 (template\_source=editStepperDrawer.v1)  
  \- Detail & Tabs ‚Üí viewDrawer.v1 (template\_source=viewDrawer.v1)  
  \- Import ‚Üí importDrawer.v1 (template\_source=importDrawer.v1)  
  \- Confirm Modal ‚Üí deleteConfirm.v1 (template\_source=deleteConfirm.v1)  
  \- Label Modal ‚Üí viewDrawer.v1 (re-used)    
\- missing\_components (‡∏™‡∏£‡πâ‡∏≤‡∏á placeholder ‡πÉ‡∏ô sheet ‚ÄúNew Component‚Äù):    
  \- ProductListPage, ProductCreatePage, ProductDetailPage, ProductEditPage, ProductFilterBar, ProductTable, ProductForm, ProductUomConvTable, ProductVendorsTable, ProductBarcodeTable, FormActionBar, FormGuard, ActivityLog, StatusActions, ApprovalActions, ToastHost    
\- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡∏à‡∏≤‡∏Å input:  
  \- ‡πÉ‡∏Ñ‡∏£‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‚Äúcontroller override‚Äù ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î role ‡πÅ‡∏•‡∏∞ API flag (‡πÄ‡∏ä‡πà‡∏ô override=true \+ approver signature)  
  \- Endpoint \`:reject\` ‡∏ñ‡∏π‡∏Å‡∏≠‡πâ‡∏≤‡∏á‡∏ñ‡∏∂‡∏á‡πÉ‡∏ô transitions ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô API list ‚Üí ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ \`POST /api/master/products/{id}:reject\` ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ PATCH ‡πÅ‡∏ó‡∏ô  
  \- ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏° Import (upsert vs create new revision) ‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î policy  
  \- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô "critical" ‡∏Ñ‡∏ß‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡πâ‡∏≤‡∏á base\_uom, tax/GL, tracking)  
  \- Org/site-level filtering (org\_id) ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏ ‚Äî ‡∏´‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ scope per org ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏° rule  
\- Rules/Lint violations to note:  
  \- ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ stepper \>5 steps ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô (rule: stepper\_max)    
  \- Drawer width: editStepperDrawer uses width=45% (allowed "wide") ‚Äî ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 55% ‡∏´‡∏£‡∏∑‡∏≠ 100%    
\- unknown tokens (‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏à‡πâ‡∏á): ‡∏ó‡∏∏‡∏Å token‡πÉ‡∏ô ASCII ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï; ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ text ‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏  

\#\# 8\) API Endpoints    
Base URL: \`\<base\_url\>\`    
Base Path: \`/erp/master/products\`

| Method | Path | Use case | Notes |  
|---|---|---|---|  
| GET | /erp/master/products | ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (List) | Headers: Authorization; Query filters: q,status,type,category\_id,vendor\_id,tracking,page,page\_size,sort,updated\_from,updated\_to; returns items: Product\[\] \+ pagination |  
| POST | /erp/master/products | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Save Draft / Create) | Headers: Authorization, X-Idempotency-Key; idempotent create; request may include ProductBarcode\[\], ProductUomConv\[\], ProductVendor\[\], ProductImage\[\], ProductDoc\[\] |  
| GET | /erp/master/products/{id} | ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Detail) | Headers: Authorization; response: Product (full) with child arrays: ProductBarcode\[\], ProductUomConv\[\], ProductVendor\[\], ProductImage\[\], ProductDoc\[\]; returns ETag header |  
| PATCH | /erp/master/products/{id} | ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Update, partial) | Headers: Authorization, If-Match; optimistic concurrency; critical-field edits on Active create revision (see notes) |  
| POST | /erp/master/products/{id}:submit | ‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Draft ‚Üí In Review / revision submit) | Traceable action from Create/Edit; Headers: Authorization, X-Idempotency-Key; may require validation of GL/Tax/Base UOM |  
| POST | /erp/master/products/{id}:approve | ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (In Review ‚Üí Approved) | Headers: Authorization, If-Match, X-Idempotency-Key, X-Audit-Reason (optional); role: Finance/Procurement per DOA |  
| POST | /erp/master/products/{id}:reject | ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (In Review ‚Üí Draft) | Headers: Authorization, If-Match, X-Audit-Reason (required); returns reason logged |  
| POST | /erp/master/products/{id}:activate | ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Approved ‚Üí Active) | Headers: Authorization, If-Match, X-Idempotency-Key, X-Audit-Reason (optional); preconditions: no open references; may return 409 |  
| POST | /erp/master/products/{id}:deactivate | ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (Active ‚Üí Inactive) | Headers: Authorization, If-Match, X-Idempotency-Key, X-Audit-Reason; blocked ‚Üí 409 if open PR/PO/GRN (unless controller override) |  
| POST | /erp/master/products/{id}:obsolete | ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ñ‡∏≤‡∏ß‡∏£ (‚Üí Obsolete) | Headers: Authorization, If-Match, X-Idempotency-Key, X-Audit-Reason; irreversible; preconditions: on-hand \== 0 && no open docs; returns 409/422 as applicable |  
| GET | /erp/master/products/{id}:label | ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏â‡∏•‡∏≤‡∏Å (PDF) | Headers: Authorization; Query: template={template\_id}; returns application/pdf or 202 job id if async; validates symbology/tracking |  
| POST | /erp/master/products/import | ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (Import CSV/XLSX) | Headers: Authorization, X-Idempotency-Key; request references uploaded file\_id; preview/commit flow; returns import report |  
| GET | /erp/master/products:export | ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å (Export CSV/XLSX) | Headers: Authorization; Query filters same as list; may return CSV (200) or 202 \+ job id for async large exports |  
| GET | /erp/master/products/{id}/audit | ‡∏î‡∏∂‡∏á Audit log ‡∏£‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | Headers: Authorization; returns audit\_entries\[\] (actor, role, action, timestamp, reason, diff) |  
| POST | /erp/master/products:bulk | Bulk actions (e.g., bulk-activate/bulk-deactivate) | Headers: Authorization, X-Idempotency-Key; request: action, ids\[\]; response per id status; RBAC gated |

\---

\#\#\# 8.1 List ‚Äî \`GET /erp/master/products\`  
Traceability: Page \= Product List (\`/erp/master/products\`) ¬∑ Action \= view:list ¬∑ Journey \= J1 / J6 / general listing    
Headers (required/optional): Authorization: Bearer \<token\>    
Query params:  
| Name | Type | Req | Default | Description |  
|---|---:|:---:|---|---|  
| q | string | no | \- | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î/‡∏ä‡∏∑‡πà‡∏≠/‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î |  
| status | string\[\] | no | \- | ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Draft,In Review,Approved,Active,Inactive,Obsolete) |  
| type | string | no | \- | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Stock|NonStock|Service) |  
| category\_id | string | no | \- | ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà |  
| vendor\_id | string | no | \- | ‡∏£‡∏´‡∏±‡∏™ vendor (‡∏Å‡∏£‡∏≠‡∏á‡πÇ‡∏î‡∏¢ vendor relation) |  
| tracking | string | no | \- | Tracking (None|Lot|Serial) |  
| page | integer | no | 1 | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ |  
| page\_size | integer | no | 25 | ‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤ |  
| sort | string | no | \-updated\_at | sort field (e.g., code, \-updated\_at) |  
| updated\_from | string (ISO-8601) | no | \- | ‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏à‡∏≤‡∏Å |  
| updated\_to | string (ISO-8601) | no | \- | ‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ñ‡∏∂‡∏á |

\#\#\#\# Response (success):  
\`\`\`json  
{  
  "items": \[  
    {  
      "id": "1001",  
      "code": "PROD-0001",  
      "name": "‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö",  
      "type": "Stock",  
      "category\_id": "CAT-10",  
      "base\_uom": "PCS",  
      "tracking": "Lot",  
      "preferred\_vendor": "VND-01",  
      "status": "Active",  
      "updated\_at": "2025-11-01T09:12:00Z"  
    }  
  \],  
  "meta": {  
    "page": 1,  
    "page\_size": 25,  
    "total": 1234  
  }  
}  
\`\`\`

\#\#\#\# Error (shared model applies):  
\`\`\`json  
{ "code": "400\_VALIDATION\_FAILED", "message": "Invalid filter: updated\_from must be ISO-8601", "details": \[ { "field": "updated\_from", "message": "invalid datetime" } \], "trace\_id": "tid-1234" }  
\`\`\`

\---

\#\#\# 8.2 Create ‚Äî \`POST /erp/master/products\`  
Traceability: Page \= Product Create (\`/erp/master/products/new\`) ¬∑ Action \= create ¬∑ Journey \= J1    
Headers (required/optional): Authorization: Bearer \<token\>, X-Idempotency-Key (recommended)    
\#\#\#\# Request:  
\`\`\`json  
{  
  "code": "PROD-0002",  
  "name": "‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö",  
  "type": "Stock",  
  "category\_id": "CAT-12",  
  "base\_uom": "L",  
  "purchase\_uom": "BOX",  
  "tracking": "None",  
  "tax\_code\_id": "VAT-7",  
  "gl\_inventory\_acct\_id": "1100",  
  "gl\_expense\_acct\_id": "5000",  
  "cost\_method": "Standard",  
  "standard\_cost": 12.3456,  
  "hazardous": false,  
  "shelf\_life\_days": 365,  
  "remarks": "‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",  
  "product\_barcode": \[  
    { "symbology": "EAN13", "value": "1234567890123", "is\_primary": true }  
  \],  
  "product\_uom\_conv": \[  
    { "from\_uom": "L", "to\_uom": "ML", "factor": 1000.000000 }  
  \],  
  "product\_vendor": \[  
    { "vendor\_id": "VND-01", "vendor\_sku": "SKU-123", "preferred": true, "moq": 10, "lead\_time\_days": 7, "price\_hint": 12.3456, "currency": "THB" }  
  \],  
  "product\_image": \[  
    { "url": "https://files.example.com/img-1.jpg", "alt\_text": "‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", "is\_primary": true }  
  \],  
  "product\_doc": \[  
    { "file\_url": "https://files.example.com/spec-1.pdf", "doc\_type": "Spec" }  
  \]  
}  
\`\`\`

\#\#\#\# Response (success 201):  
Headers: ETag: "\<etag-value\>"  
\`\`\`json  
{  
  "id": "1002",  
  "code": "PROD-0002",  
  "status": "Draft",  
  "created\_at": "2025-11-05T08:30:00Z"  
}  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "400\_VALIDATION\_FAILED", "message": "Missing required field: base\_uom", "details": \[ { "field": "base\_uom", "message": "required" } \], "trace\_id": "tid-2345" }  
\`\`\`

\---

\#\#\# 8.3 Detail ‚Äî \`GET /erp/master/products/{id}\`  
Traceability: Page \= Product Detail (\`/erp/master/products/:id\`) ¬∑ Action \= view:detail ¬∑ Journey \= J1 / J2 / J3 / J4 / J5    
Headers (required/optional): Authorization: Bearer \<token\>    
\#\#\#\# Response (success):  
Headers: ETag: "\<etag-value\>"  
\`\`\`json  
{  
  "id": "1002",  
  "code": "PROD-0002",  
  "name": "‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö",  
  "type": "Stock",  
  "category\_id": "CAT-12",  
  "status": "Approved",  
  "base\_uom": "L",  
  "purchase\_uom": "BOX",  
  "tracking": "Lot",  
  "weight": 1.250,  
  "length": 10.00,  
  "width": 5.00,  
  "height": 2.50,  
  "weight\_uom": "KG",  
  "volume\_uom": "L",  
  "tax\_code\_id": "VAT-7",  
  "gl\_inventory\_acct\_id": "1100",  
  "gl\_expense\_acct\_id": "5000",  
  "cost\_method": "Standard",  
  "standard\_cost": 12.3456,  
  "hazardous": false,  
  "shelf\_life\_days": 365,  
  "remarks": "‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",  
  "product\_barcode": \[  
    { "id": "2001", "symbology": "EAN13", "value": "1234567890123", "is\_primary": true }  
  \],  
  "product\_uom\_conv": \[  
    { "id": "3001", "from\_uom": "L", "to\_uom": "ML", "factor": 1000.000000 }  
  \],  
  "product\_vendor": \[  
    { "id": "4001", "vendor\_id": "VND-01", "vendor\_sku": "SKU-123", "preferred": true, "moq": 10, "lead\_time\_days": 7, "price\_hint": 12.3456, "currency": "THB" }  
  \],  
  "product\_image": \[  
    { "id": "5001", "url": "https://files.example.com/img-1.jpg", "alt\_text": "‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", "is\_primary": true }  
  \],  
  "product\_doc": \[  
    { "id": "6001", "file\_url": "https://files.example.com/spec-1.pdf", "doc\_type": "Spec" }  
  \],  
  "updated\_at": "2025-11-05T09:00:00Z",  
  "created\_at": "2025-11-05T08:30:00Z"  
}  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "404\_NOT\_FOUND", "message": "Product 1002 not found", "details": \[\], "trace\_id": "tid-3456" }  
\`\`\`

\---

\#\#\# 8.4 Update ‚Äî \`PATCH /erp/master/products/{id}\`  
Traceability: Page \= Product Edit (\`/erp/master/products/:id/edit\`) ¬∑ Action \= edit ¬∑ Journey \= J5 / J3 / J4    
Headers (required/optional): Authorization: Bearer \<token\>, If-Match: "\<etag-value\>"    
\#\#\#\# Request:  
\`\`\`json  
{  
  "name": "‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏£‡∏∏‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà)",  
  "remarks": "‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢",  
  "product\_vendor": \[  
    { "id": "4001", "preferred": false },  
    { "vendor\_id": "VND-02", "vendor\_sku": "SKU-999", "preferred": true, "moq": 5, "lead\_time\_days": 10, "price\_hint": 11.5000, "currency": "THB" }  
  \]  
}  
\`\`\`

\#\#\#\# Response (success):  
Headers: ETag: "\<new-etag\>"  
\`\`\`json  
{  
  "id": "1002",  
  "status": "Draft",  
  "updated\_at": "2025-11-06T10:00:00Z"  
}  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "412\_PRECONDITION\_FAILED", "message": "ETag mismatch", "details": \[\], "trace\_id": "tid-4567" }  
\`\`\`

\---

\#\#\# 8.5 Submit ‚Äî \`POST /erp/master/products/{id}:submit\`  
Traceability: Page \= Product Create / Product Edit / Product List row ¬∑ Action \= submit ¬∑ Journey \= J1 / J5 / J3    
Headers (required/optional): Authorization: Bearer \<token\>, X-Idempotency-Key, If-Match (recommended), X-Audit-Reason (optional)    
\#\#\#\# Request (optional payload):  
\`\`\`json  
{ "comment": "‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥", "notify\_approvers": true }  
\`\`\`

\#\#\#\# Response:  
\`\`\`json  
{ "id": "1002", "status": "In Review", "submitted\_at": "2025-11-06T10:05:00Z" }  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "422\_INVALID\_STATE", "message": "Required fields missing for submit: base\_uom, product\_barcode (primary)", "details": \[ { "field": "product\_barcode", "message": "At least one primary barcode required" } \], "trace\_id": "tid-5678" }  
\`\`\`

\---

\#\#\# 8.6 Approve ‚Äî \`POST /erp/master/products/{id}:approve\`  
Traceability: Page \= Product Detail (Tax/GL tab) / List row ¬∑ Action \= approve ¬∑ Journey \= J2    
Headers (required): Authorization: Bearer \<token\>, If-Match: "\<etag-value\>", X-Idempotency-Key, X-Audit-Reason (recommended)    
Request (optional):  
\`\`\`json  
{ "comment": "Approved by finance", "approver\_id": "user-fin-01" }  
\`\`\`

\#\#\#\# Response:  
\`\`\`json  
{ "id": "1002", "status": "Approved", "approved\_at": "2025-11-07T14:22:00Z" }  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "403\_FORBIDDEN", "message": "User not authorized to approve", "details": \[\], "trace\_id": "tid-6789" }  
\`\`\`

\---

\#\#\# 8.7 Reject ‚Äî \`POST /erp/master/products/{id}:reject\`  
Traceability: Page \= Product Detail / List row ¬∑ Action \= reject ¬∑ Journey \= J2    
Headers (required): Authorization: Bearer \<token\>, If-Match: "\<etag-value\>", X-Audit-Reason (required)    
Request:  
\`\`\`json  
{ "reason": "GL account missing", "comment": "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç GL ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà" }  
\`\`\`

\#\#\#\# Response:  
\`\`\`json  
{ "id": "1002", "status": "Draft", "reverted\_at": "2025-11-07T15:00:00Z" }  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "400\_VALIDATION\_FAILED", "message": "Reason is required for reject", "details": \[ { "field": "reason", "message": "required" } \], "trace\_id": "tid-7890" }  
\`\`\`

\---

\#\#\# 8.8 Activate ‚Äî \`POST /erp/master/products/{id}:activate\`  
Traceability: Page \= Product Detail / List row ¬∑ Action \= activate ¬∑ Journey \= J2    
Headers (required): Authorization: Bearer \<token\>, If-Match: "\<etag-value\>", X-Idempotency-Key, X-Audit-Reason (optional)    
Request (optional):  
\`\`\`json  
{ "comment": "Activate for procurement" }  
\`\`\`

\#\#\#\# Response:  
\`\`\`json  
{ "id": "1002", "status": "Active", "activated\_at": "2025-11-07T16:00:00Z" }  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "409\_CONFLICT", "message": "Cannot activate: open PR exists PR-00045", "details": \[ { "field": "references", "message": "PR-00045" } \], "trace\_id": "tid-8901" }  
\`\`\`

\---

\#\#\# 8.9 Deactivate ‚Äî \`POST /erp/master/products/{id}:deactivate\`  
Traceability: Page \= Product Detail / List row / Confirm Modal ¬∑ Action \= deactivate ¬∑ Journey \= J5    
Headers (required): Authorization: Bearer \<token\>, If-Match: "\<etag-value\>", X-Idempotency-Key, X-Audit-Reason (recommended)    
Request:  
\`\`\`json  
{ "reason": "Discontinued for season", "override": false }  
\`\`\`

\#\#\#\# Response:  
\`\`\`json  
{ "id": "1002", "status": "Inactive", "deactivated\_at": "2025-11-08T09:00:00Z" }  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "422\_INVALID\_STATE", "message": "Cannot deactivate: open GRN/PO/PR exist", "details": \[ { "field": "references", "message": "PR-00045" } \], "trace\_id": "tid-9012" }  
\`\`\`

\---

\#\#\# 8.10 Obsolete ‚Äî \`POST /erp/master/products/{id}:obsolete\`  
Traceability: Page \= Product Detail / List row / Confirm Modal ¬∑ Action \= obsolete ¬∑ Journey \= J5    
Headers (required): Authorization: Bearer \<token\>, If-Match: "\<etag-value\>", X-Idempotency-Key, X-Audit-Reason (required)    
Request:  
\`\`\`json  
{ "reason": "End of life", "acknowledge\_irreversible": true }  
\`\`\`

\#\#\#\# Response:  
\`\`\`json  
{ "id": "1002", "status": "Obsolete", "obsoleted\_at": "2025-11-09T10:00:00Z" }  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "409\_CONFLICT", "message": "Cannot obsolete: on-hand \> 0", "details": \[ { "field": "on\_hand", "message": "10 units" } \], "trace\_id": "tid-0123" }  
\`\`\`

\---

\#\#\# 8.11 Label ‚Äî \`GET /erp/master/products/{id}:label\`  
Traceability: Page \= Print Label modal (\`Print Label\`) ¬∑ Action \= label ¬∑ Journey \= J6    
Headers (required/optional): Authorization: Bearer \<token\>    
Query params:  
| Name | Type | Req | Default | Description |  
|---|---:|:---:|---|---|  
| template | string | no | default\_template | id ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏â‡∏•‡∏≤‡∏Å |  
| format | string | no | pdf | format (pdf) |

\#\#\#\# Response (sync PDF):  
Content-Type: application/pdf (binary)  
OR async:  
\`\`\`json  
{ "job\_id": "job-789", "status": "accepted" }  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "422\_INVALID\_STATE", "message": "Template does not support symbology QR for this product", "details": \[\], "trace\_id": "tid-1122" }  
\`\`\`

\---

\#\#\# 8.12 Import ‚Äî \`POST /erp/master/products/import\`  
Traceability: Page \= Import Drawer (\`/erp/master/products/import\`) ¬∑ Action \= import:commit ¬∑ Journey \= J6    
Headers (required): Authorization: Bearer \<token\>, X-Idempotency-Key    
\#\#\#\# Request:  
\`\`\`json  
{  
  "file\_id": "file-123",  
  "mode": "upsert",   
  "default\_category\_id": "CAT-12",  
  "notify": true  
}  
\`\`\`

\#\#\#\# Response:  
\`\`\`json  
{  
  "import\_id": "imp-001",  
  "created": 120,  
  "updated": 30,  
  "errors": 2,  
  "report\_url": "https://files.example.com/import-reports/imp-001.csv"  
}  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "400\_VALIDATION\_FAILED", "message": "File parsing failed: missing required column code", "details": \[\], "trace\_id": "tid-2233" }  
\`\`\`

\---

\#\#\# 8.13 Export ‚Äî \`GET /erp/master/products:export\`  
Traceability: Page \= Product List (\`Export\` toolbar) ¬∑ Action \= export ¬∑ Journey \= J6    
Headers (required/optional): Authorization: Bearer \<token\>    
Query params: same as list filters \+ format=csv/xlsx

\#\#\#\# Response (sync small):  
Content-Type: text/csv (binary)    
OR async:  
\`\`\`json  
{ "job\_id": "exp-001", "status": "accepted", "download\_url": null }  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "429\_TOO\_MANY\_REQUESTS", "message": "Export rate limit exceeded", "details": \[\], "trace\_id": "tid-3344" }  
\`\`\`

\---

\#\#\# 8.14 Audit ‚Äî \`GET /erp/master/products/{id}/audit\`  
Traceability: Page \= Product Detail (Audit tab) ¬∑ Action \= view:audit ¬∑ Journey \= all journeys (events)    
Headers (required/optional): Authorization: Bearer \<token\>    
Query params: page, page\_size, from, to

\#\#\#\# Response:  
\`\`\`json  
{  
  "audit\_entries": \[  
    { "timestamp": "2025-11-07T14:22:00Z", "actor": "finance@org", "role": "Finance", "action": "approve", "reason": "OK", "diff": {} }  
  \],  
  "meta": { "page": 1, "page\_size": 25, "total": 10 }  
}  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "404\_NOT\_FOUND", "message": "Product audit not found", "details": \[\], "trace\_id": "tid-4455" }  
\`\`\`

\---

\#\#\# 8.15 Bulk ‚Äî \`POST /erp/master/products:bulk\`  
Traceability: Page \= Product List (Bulk actions) ¬∑ Action \= bulk ¬∑ Journey \= J6 / admin tasks    
Headers (required): Authorization: Bearer \<token\>, X-Idempotency-Key    
\#\#\#\# Request:  
\`\`\`json  
{ "action": "deactivate", "ids": \["1003","1004"\], "params": { "reason": "seasonal", "override": false } }  
\`\`\`

\#\#\#\# Response:  
\`\`\`json  
{  
  "action": "deactivate",  
  "results": \[  
    { "id": "1003", "status": "success", "message": "deactivated" },  
    { "id": "1004", "status": "failed", "message": "open PR PR-00050" }  
  \]  
}  
\`\`\`

\#\#\#\# Error:  
\`\`\`json  
{ "code": "403\_FORBIDDEN", "message": "Insufficient role for bulk deactivate", "details": \[\], "trace\_id": "tid-5566" }  
\`\`\`

\---

\# 9\. API Contract ‚Äî Notes & Conventions

9.1 Security & Headers    
\- Authentication: Bearer JWT (Authorization: Bearer \<token\>) \+ RBAC/Scopes per role (Viewer / Editor / Approver / Admin).    
\- Headers ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢:    
  \- Authorization: Bearer \<token\> (required)    
  \- X-Idempotency-Key: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ idempotency (create, import commit, submit, approve, activate, deactivate, obsolete, bulk)    
  \- If-Match: "\<etag\>" ‚Äî ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PATCH ‡πÅ‡∏•‡∏∞ state-changing requests ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô concurrent edits (required where noted)    
  \- X-Audit-Reason: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• (status changes, reject, obsolete)    
\- ETag: server ‡∏Ñ‡∏∑‡∏ô ETag header ‡πÉ‡∏ô GET/POST responses; client ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á If-Match ‡πÄ‡∏°‡∏∑‡πà‡∏≠ PATCH ‡∏´‡∏£‡∏∑‡∏≠ action ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏

9.2 Error Model & Codes    
\- ‡πÉ‡∏ä‡πâ HTTP codes: 400, 401, 403, 404, 409, 412, 422, 429, 500 ‡∏ï‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏ö‡∏ó    
\- ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö error ‡∏Å‡∏•‡∏≤‡∏á:  
\`\`\`json  
{ "code": "‚Ä¶", "message": "‚Ä¶", "details": \[ { "field": "‚Ä¶", "message": "‚Ä¶" } \], "trace\_id": "‚Ä¶" }  
\`\`\`  
\- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á mapping:    
  \- 400 VALIDATION\_FAILED ‚Äî ‡∏Ç‡∏≤‡∏î‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô / UOM graph ‡∏°‡∏µ‡∏ß‡∏á‡∏à‡∏£ / duplicate barcode    
  \- 403 FORBIDDEN ‚Äî ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (approve/activate/deactivate/obsolete)    
  \- 404 NOT\_FOUND ‚Äî GL/Tax/Vendor/Category ‡πÑ‡∏°‡πà‡∏û‡∏ö    
  \- 409 CONFLICT ‚Äî code ‡∏ã‡πâ‡∏≥; business guards (open PR/PO/GRN)    
  \- 412 PRECONDITION\_FAILED ‚Äî ETag mismatch (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ UX: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‚Üí merge)    
  \- 422 INVALID\_STATE ‚Äî ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ validation domain (e.g., preferred vendor per currency)

9.3 Rate Limits & Required Headers    
\- ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 120 requests/minute per client (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏° NFR)    
\- ‡πÄ‡∏°‡∏∑‡πà‡∏≠ 429 ‡∏Ñ‡∏∑‡∏ô header Retry-After (seconds)    
\- ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ X-Idempotency-Key ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö create/import/submit/approve/activate/deactivate/obsolete/bulk ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö retry ‡πÇ‡∏î‡∏¢ client

9.4 Idempotency & Concurrency    
\- Idempotency: commands ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô state ‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö X-Idempotency-Key ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥ dedupe server-side    
\- Concurrency: ‡πÉ‡∏ä‡πâ ETag \+ If-Match ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PATCH ‡πÅ‡∏•‡∏∞ state transitions ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö concurrent edits ‚Üí ‡πÄ‡∏°‡∏∑‡πà‡∏≠ mismatch (412) ‡πÉ‡∏´‡πâ client ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á merge dialog    
\- 409 ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ conflict ‡πÄ‡∏ä‡∏¥‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à (‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏õ‡∏¥‡∏î) ‚Äî ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏≤‡∏Å 412

9.5 Example Requests (cURL)  
\- List (‡∏°‡∏µ filters):  
curl \-H "Authorization: Bearer \<token\>" "\<base\_url\>/erp/master/products?q=PROD\&page=1\&page\_size=25\&status=Active"  
\- Create (‡∏°‡∏µ X-Idempotency-Key):  
curl \-X POST \-H "Authorization: Bearer \<token\>" \-H "X-Idempotency-Key: key-123" \-H "Content-Type: application/json" \-d '{ "code":"PROD-0002", "name":"‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á", "base\_uom":"PCS" }' "\<base\_url\>/erp/master/products"  
\- Update (‡∏û‡∏£‡πâ‡∏≠‡∏° If-Match):  
curl \-X PATCH \-H "Authorization: Bearer \<token\>" \-H 'If-Match: \\"etag-xyz\\"' \-H "Content-Type: application/json" \-d '{ "remarks": "‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï" }' "\<base\_url\>/erp/master/products/1002"  
\- Action (approve) ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:  
curl \-X POST \-H "Authorization: Bearer \<token\>" \-H 'If-Match: \\"etag-abc\\"' \-H "X-Idempotency-Key: key-approve-1" \-H "Content-Type: application/json" \-d '{ "comment":"Approved" }' "\<base\_url\>/erp/master/products/1002:approve"  
\- Import commit:  
curl \-X POST \-H "Authorization: Bearer \<token\>" \-H "X-Idempotency-Key: imp-789" \-H "Content-Type: application/json" \-d '{ "file\_id":"file-123", "mode":"upsert" }' "\<base\_url\>/erp/master/products/import"

9.6 Notes (Integrations & Export)  
\- Integrations (Inbound): GL master, Tax master, Vendor master, Category master ‚Äî API validates FK existence (404 if not found).    
\- Outbound Events: publish events product.created, product.submitted, product.approved, product.activated, product.deactivated, product.obsoleted, product.updated with payload including id, actor, timestamp, snapshot\_id. Ensure retry/backoff for event delivery per NFR.    
\- Export: small exports may return CSV synchronously (200); large exports should be async (202 \+ job\_id). Provide job polling endpoint (not enumerated here) or callback webhook.    
\- Webhooks/Events: transitions and critical actions must emit audit & events; consumers (PR/PO/GRN) subscribe to product.activated, product.updated (tracking changes), product.obsoleted.    
\- PII & Masking: GL account/tax fields may be masked for non-Finance roles in responses (masking applied by server).    
\- Data precision: numeric fields must follow precision rules (decimal(18,6) for factors, decimal(18,4) for money, decimal(18,3) for weight, decimal(18,2) for dimensions). Dates/times in ISO-8601 UTC (e.g., 2025-01-01T00:00:00Z) ‚Äî UI may render Asia/Bangkok.  

\-- End of API Contract.

\# Journey  
\#\#\# Journey: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à (Actor: Editor/Creator ‡∏´‡∏£‡∏∑‡∏≠ Admin)  
\*\*Entry:\*\* ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ List \`/erp/master/products\` ‚Üí ‡∏õ‡∏∏‡πà‡∏° ‡∏™‡∏£‡πâ‡∏≤‡∏á (Create) / ‡∏´‡∏£‡∏∑‡∏≠ deeplink \`/erp/master/products/new\`    
\*\*Preconditions:\*\* ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (role \= Admin ‡∏´‡∏£‡∏∑‡∏≠ Editor ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï) ; ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• FK (category\_id, tax\_code\_id, vendor\_id, gl\_\* ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á 404 ‡∏à‡∏≤‡∏Å API ; ‡πÄ‡∏ô‡πá‡∏ï‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡∏õ‡∏Å‡∏ï‡∏¥    
\*\*Exit / Postconditions:\*\* ‡∏™‡∏£‡πâ‡∏≤‡∏á Product record ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ \`Draft\` (server ‡∏Ñ‡∏∑‡∏ô id \+ ETag) ‚Üí ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Submit ‡∏ï‡πà‡∏≠ ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô \`In Review\` ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå product.submitted

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*list / btn-create-product\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‡∏™‡∏£‡πâ‡∏≤‡∏á (Create)    
   \- Trigger: NAV ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î route \`/erp/master/products/new\` (drawer)    
   \- map\_in: none    
   \- assert: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Create (client-side check)    
   \- System: ‡πÄ‡∏õ‡∏¥‡∏î UI Create Drawer (client)    
   \- map\_out: n/a    
   \- UI Feedback: ‡πÄ‡∏õ‡∏¥‡∏î Drawer; focus ‡πÑ‡∏õ‡∏ó‡∏µ‡πà \`input-code\`    
   \- Navigation/State: ‡πÑ‡∏°‡πà‡∏°‡∏µ navigation ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (drawer)    
   \- Field & Copy Checklist:  
     \- Fields ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å:  
       \- code | ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | text | required(yes) | default: auto/empty | validators: regex /^\[A-Z0-9\\-\\\_\]+$/? (‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏∏) | helper\_text\_th: "‡∏£‡∏´‡∏±‡∏™‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥" | error\_copy\_th: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" | visibility(editable)  
       \- name | ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | text | required(yes) | error\_copy\_th: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" | visibility(editable)  
       \- type | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó | enum(select: Stock|NonStock|Service) | required(yes) | helper:"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" | visibility(editable)  
       \- category\_id | ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà | select | required(no) | visibility(editable)  
       \- base\_uom | Base UOM | select | required(yes) | helper:"‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ê‡∏≤‡∏ô ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ï‡πá‡∏≠‡∏Å" | error\_copy\_th: "Base UOM ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à" | visibility(editable)  
       \- purchase\_uom | Purchase UOM | select | required(no) | visibility(editable)  
       \- tracking | Tracking | enum(select: None|Lot|Serial) | required(no) | visibility(editable)  
       \- tax\_code\_id | ‡∏£‡∏´‡∏±‡∏™‡∏†‡∏≤‡∏©‡∏µ | select | required(no/depends) | visibility(editable)  
       \- gl\_inventory\_acct\_id | GL ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡∏Ñ‡∏•‡∏±‡∏á | select | required(no/depends) | visibility(editable/read-only masked for non-Finance)  
       \- gl\_expense\_acct\_id | GL ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ | select | required(no/depends) | visibility(editable/read-only masked)  
       \- standard\_cost | ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô | number(decimal(18,4)) | required(no) | validators: \>=0  
       \- product\_barcode (table) | ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î: symbology|value|is\_primary (at least one primary required before submit) | file\_types: n/a  
       \- product\_uom\_conv (table) | from\_uom|to\_uom|factor (factor decimal(18,6)) ‚Äî client must validate acyclic graph  
       \- product\_vendor (table) | vendor\_id|vendor\_sku|preferred|moq|lead\_time\_days|price\_hint|currency ‚Äî unique preferred per currency validation  
       \- product\_image / product\_doc | url|alt\_text|is\_primary / file\_url|doc\_type ‚Äî file upload via file service, max\_size per policy  
     \- Fields ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á:  
       \- status | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | read-only | source: client-initial "Draft"  
       \- created\_at | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ | read-only | source: server after create  
     \- UI Copy / Messages:  
       \- Create primary: \*\*‡∏™‡∏£‡πâ‡∏≤‡∏á\*\*; Save draft: \*\*‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡πà‡∏≤‡∏á\*\*; helper: "Base UOM ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ï‡πá‡∏≠‡∏Å"  
       \- Validation inline: "‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"  
       \- Empty states: drawer empty fields; loading skeleton khi POST  
     \- data-test-id ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á: btn-open-create, drawer-create-product, input-code, input-name, select-base\_uom, table-barcode, btn-save-draft, btn-create-submit  
     \- a11y: focus order \= input-code ‚Üí input-name ‚Üí select-type ‚Üí base\_uom ‚Üí barcode table ‚Üí footer buttons; modal trap; Esc closes drawer  
2\) \*\*create drawer / btn-save-draft\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Save as Draft    
   \- Trigger: POST /erp/master/products    
   \- map\_in: { code, name, type, category\_id?, base\_uom, purchase\_uom?, tracking?, tax\_code\_id?, gl\_inventory\_acct\_id?, gl\_expense\_acct\_id?, product\_barcode\[\], product\_uom\_conv\[\], product\_vendor\[\], product\_image\[\], product\_doc\[\] } ‚Äî ‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ server-owned (‡πÄ‡∏ä‡πà‡∏ô on\_hand, totals)    
   \- assert: client-side validation required fields present (code,name,base\_uom) & barcode primary if user intends to submit later (but draft may allow missing primary); UOM cycle client validation (warn)    
   \- System: Server validates, creates resource, returns 201 \+ body {id, code, status:"Draft", created\_at} \+ ETag header    
   \- map\_out: { id, code, status, created\_at } \+ ETag \-\> store etag in client (product.etag)    
   \- UI Feedback: show toast success "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß" (telemetry: product.create) ; disable create button while awaiting; show spinner on btn-save-draft    
   \- Navigation/State: Keep drawer open or (preferred) navigate to Detail \`/erp/master/products/{id}\` after success (Page Definitions: redirect to Detail) ‚Äî implementation: redirect to Detail and open Edit drawer if desired    
   \- Field & Copy Checklist: same as above; ensure data-test-id: api-create-call (instrumentation), toast-create-success  
3\) \*\*detail page / btn-submit\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Submit ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à (‡∏à‡∏≤‡∏Å drawer ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏Å Detail)    
   \- Trigger: POST /erp/master/products/{id}:submit    
   \- map\_in: { comment?, notify\_approvers?: boolean } and Headers: X-Idempotency-Key \= ui:{user.id}:{product.id}:{hash(code|base\_uom|tax\_code\_id)} ; If-Match: etag (recommended)    
   \- assert: client-side check before submit: required fields filled (base\_uom present, at least one barcode primary) ‚Äî server will re-assert and may return 422 with details    
   \- System: Server validates domain rules (GL/Tax presence if org policy, barcode uniqueness, UOM acyclic, vendor preferred per currency) ‚Üí on success set status="In Review" and return {id, status:"In Review", submitted\_at} and emit event product.submitted    
   \- map\_out: { id, status:"In Review", submitted\_at } ‚Äî update UI: status badge, disable edit of some fields per workflow    
   \- UI Feedback: show modal confirm "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤?" with confirm copy; on success toast "‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢" ; on 422 show inline error list \+ focus first invalid field    
   \- Navigation/State: stay on Detail page \`/erp/master/products/{id}\` ; invalidate product list cache; emit telemetry release.submitted? (use product.submitted)    
   \- Field & Copy Checklist:  
     \- Confirmation modal copy: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥?" ; confirm button data-test-id: confirm-submit-product  
     \- data-test-id: btn-submit-product, modal-submit-confirm, toast-submit-success  
     \- a11y: Ctrl+Enter triggers Submit in modal; Esc cancels modal  
4\) ‚Ä¶ (end of happy path)

\#\#\#\# Variants & Exceptions  
\- Step 2 ‚Üí VALIDATION:400\_VALIDATION\_FAILED (missing base\_uom)    
  \- UX: show field error at select-base\_uom, focus select-base\_uom, message "Base UOM ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô"    
\- Step 2 ‚Üí BUSINESS:409\_CONFLICT (code duplicate)    
  \- UX: show banner "‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö" with action "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç" (focus input-code)    
\- Step 2 ‚Üí VALIDATION:UOM\_CYCLE (400\_VALIDATION\_FAILED)    
  \- UX: prevent submit/persist? Allow draft but warn on submit ‚Äî show "‡∏û‡∏ö‡∏ß‡∏á‡∏à‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢ (cyclic) ‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç" and highlight ProductUomConvTable rows    
\- Step 3 ‚Üí 412\_PRECONDITION\_FAILED (ETag mismatch)    
  \- UX: show merge dialog with options: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î / ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å / merge (manual) ; telemetry: product.submit.conflict    
  \- Recovery: refetch GET /erp/master/products/{id} to get new ETag then retry Submit with same X-Idempotency-Key  
\- Step 3 ‚Üí CONFLICT 422\_INVALID\_STATE (missing primary barcode)    
  \- UX: inline error, focus barcode table, helper to add primary  
\- Idempotency CONFLICT (server indicates duplicate request processed) ‚Üí Retry client MUST reuse same X-Idempotency-Key; if server returns 409 with guidance, show toast "‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß" and load resource.

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- product.create { id, code, actor\_id, correlation\_id } (dot-case)    
  \- product.submitted { id, actor\_id, comment?, correlation\_id }    
\- Audit Fields: actor\_id, correlation\_id, idempotency\_key, resource id

\#\#\#\# Test Hooks  
\- data-test-id: btn-open-create, drawer-create-product, input-code, input-name, select-base\_uom, table-barcode, btn-save-draft, api-create-call, btn-submit-product, confirm-submit-product, toast-create-success, toast-submit-success    
\- Acceptance (Gherkin ‡∏¢‡πà‡∏≠):  
  \- Given ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤    
  \- When ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏î ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡πà‡∏≤‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à    
  \- Then ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Draft ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô In Review ‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à ‡πÅ‡∏•‡∏∞ ETag ‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ

\#\#\#\# Assumptions & Confidence  
\- ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á service ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å‡πÅ‡∏•‡∏∞ client ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö file\_url ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å POST create (Confidence: High for API contract; Medium for upload details)

\---

\#\#\# Journey: ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (DOA) (Actor: Approver / Finance)  
\*\*Entry:\*\* ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Detail \`/erp/master/products/{id}\` (status \= In Review)    
\*\*Preconditions:\*\* ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ \`In Review\`; ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Approve (role Approver/Finance); client ‡∏°‡∏µ current ETag from GET    
\*\*Exit / Postconditions:\*\* status ‚Üí \`Approved\` ; event product.approved emitted ; ETag updated

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*detail / btn-approve\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏¥‡∏î tab Tax/GL ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Approve    
   \- Trigger: POST /erp/master/products/{id}:approve    
   \- map\_in: optional { comment?, approver\_id? } ; Headers: If-Match: \`\<etag\>\`, X-Idempotency-Key: ui:{user.id}:{product.id}    
   \- assert: client asserts user role Approver, status \== "In Review" ; visible only when status matches    
   \- System: Server validates GL/tax presence (may return 422 if missing), authorizes user (403 if not), on success sets status="Approved", returns {id, status:"Approved", approved\_at} and new ETag    
   \- map\_out: { id, status:"Approved", approved\_at } \+ ETag ‚Üí update UI    
   \- UI Feedback: Confirm modal "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤?" ; on success toast "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢" ; disable Approve button after success    
   \- Navigation/State: remain on Detail; invalidate list caches; show status badge change    
   \- Field & Copy Checklist:  
     \- Fields to show in Tax/GL tab: tax\_code\_id | ‡∏£‡∏´‡∏±‡∏™‡∏†‡∏≤‡∏©‡∏µ | read-only/masked if non-finance | source: api    
     \- gl\_inventory\_acct\_id | GL ‡∏™‡∏ï‡πá‡∏≠‡∏Å | read-only/masked | source: api    
     \- data-test-id: tab-tax-gl, btn-approve-product, modal-approve-confirm, toast-approve-success  
     \- a11y: Approve modal focus order, aria-label on confirm button  
2\) ‚Ä¶ (end happy path)

\#\#\#\# Variants & Exceptions  
\- Approve ‚Üí 403\_FORBIDDEN: show toast "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" and redirect to List; telemetry: approval.actioned.forbidden    
\- Approve ‚Üí 422\_INVALID\_STATE: show inline error listing missing GL/tax fields; focus first missing field; action: allow user to edit (if permitted) or reject with reason    
\- Approve ‚Üí 412\_PRECONDITION\_FAILED (ETag mismatch): show merge dialog; refetch; retry with same idempotency key    
\- Approve ‚Üí CONFLICT (business): 409 if another approver already changed status ‚Üí fetch latest and show toast

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- product.approval.actioned { id, actor\_id, action: "approve", comment?, correlation\_id }    
  \- product.approved { id, approver\_id, timestamp }    
\- Audit Fields: actor\_id, role, correlation\_id, idempotency\_key, reason/comment

\#\#\#\# Test Hooks  
\- data-test-id: btn-approve-product, modal-approve-confirm, api-approve-call, toast-approve-success, tab-tax-gl

\#\#\#\# Acceptance (Gherkin)  
\- Given ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ In Review ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Approver    
\- When ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô    
\- Then ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Approved ‡πÅ‡∏•‡∏∞‡∏°‡∏µ audit entry

\#\#\#\# Assumptions & Confidence  
\- ‡∏™‡∏°‡∏°‡∏ï‡∏¥: ETag ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÉ‡∏ô GET ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ Approve (Confidence: High)

\---

\#\#\# Journey: ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Reject) (Actor: Approver / Finance)  
\*\*Entry:\*\* ‡∏à‡∏≤‡∏Å Detail \`/erp/master/products/{id}\` (status \= In Review) ‚Üí ‡∏õ‡∏∏‡πà‡∏° Reject    
\*\*Preconditions:\*\* status \== \`In Review\`; user role Approver; client holds ETag    
\*\*Exit / Postconditions:\*\* status ‚Üí \`Draft\`; server logs reason in audit; returns new ETag

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*detail / btn-reject\*\* ‚Äî ‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏î Reject    
   \- Trigger: POST /erp/master/products/{id}:reject    
   \- map\_in: { reason: string (required), comment?: string } ; Headers: If-Match: \`\<etag\>\`, X-Audit-Reason required (per API) ; X-Idempotency-Key recommended \= ui:{user.id}:{product.id}    
   \- assert: client validates presence of reason before calling    
   \- System: Server sets status="Draft", records audit entry with reason, returns { id, status:"Draft", reverted\_at } \+ new ETag    
   \- map\_out: update product status UI, display revert reason in Audit tab    
   \- UI Feedback: Show modal with textarea reason (required) ; on success toast "‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç" and focus top of Detail    
   \- Navigation/State: remain on Detail; invalidate caches    
   \- Field & Copy Checklist:  
     \- Modal fields: input-reject-reason | ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• | required | error "‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á"    
     \- data-test-id: btn-reject-product, modal-reject-reason, btn-reject-confirm, toast-reject-success  
     \- a11y: textarea labelled, focus in textarea on open  
2\) ‚Ä¶ (end happy path)

\#\#\#\# Variants & Exceptions  
\- Step 1 ‚Üí 400\_VALIDATION\_FAILED (missing reason) ‚Üí client prevents call; server returns 400/422 if missing; show inline error "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò"    
\- Step 1 ‚Üí 403\_FORBIDDEN (user not authorized) ‚Üí show toast \+ redirect to List    
\- Step 1 ‚Üí 412\_PRECONDITION\_FAILED (ETag mismatch) ‚Üí show merge dialog; refetch; retry with same idempotency key

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- product.rejected { id, actor\_id, reason, correlation\_id }    
\- Audit Fields: actor\_id, reason, diff, idempotency\_key

\#\#\#\# Test Hooks  
\- data-test-id: btn-reject-product, modal-reject-reason, btn-reject-confirm, api-reject-call, toast-reject-success

\#\#\#\# Acceptance (Gherkin)  
\- Given ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á In Review    
\- When Approver ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•    
\- Then ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Draft ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô Audit

\#\#\#\# Assumptions & Confidence  
\- API \`:reject\` ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≤‡∏° API List (Confidence: High)

\---

\#\#\# Journey: ‡∏™‡∏£‡∏∏‡∏õ/‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Finalize / Activate) (Actor: Admin / Approver)  
\*\*Entry:\*\* ‡∏à‡∏≤‡∏Å Detail \`/erp/master/products/{id}\` (status \= Approved) ‚Üí ‡∏õ‡∏∏‡πà‡∏° Activate    
\*\*Preconditions:\*\* status \== \`Approved\`; user role Approver or Admin; no open references (PR/PO/GRN) per precondition (server checks) ; client holds If-Match ETag    
\*\*Exit / Postconditions:\*\* status ‚Üí \`Active\` ; event product.activated emitted

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*detail / btn-activate\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Activate    
   \- Trigger: POST /erp/master/products/{id}:activate    
   \- map\_in: { comment?: string } ; Headers: If-Match: \`\<etag\>\`, X-Idempotency-Key: ui:{user.id}:{product.id}    
   \- assert: client ensures status \== "Approved" and user role; optionally client can call a lightweight pre-check endpoint (not provided) ‚Äî rely on server for final check    
   \- System: Server validates no open references; if passes, set status="Active", return {id, status:"Active", activated\_at} \+ new ETag ; emit product.activated    
   \- map\_out: new status, activated\_at, new ETag; update UI badge to Active    
   \- UI Feedback: Confirmation modal "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?" ; on success toast "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß"    
   \- Navigation/State: remain on Detail; invalidate list cache so PR/PO pickers can select product    
   \- Field & Copy Checklist:  
     \- Confirm modal copy: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" ; data-test-id: modal-activate-confirm, btn-activate-product, toast-activate-success  
     \- a11y: focus on confirm button; Alt+C shortcuts not applicable here  
2\) ‚Ä¶ (end happy path)

\#\#\#\# Variants & Exceptions  
\- Activate ‚Üí 409\_CONFLICT (open PR exists)    
  \- Server returns details: { field: "references", message: "PR-00045" }    
  \- UX: show error modal with "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà PR-00045" and CTA "‡∏î‡∏π PR" or "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å override (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå)"    
  \- If controller override feature exists (not specified), show override flow; otherwise instruct user to close PR first    
\- Activate ‚Üí 403\_FORBIDDEN if user lacks role    
\- Activate ‚Üí 412\_PRECONDITION\_FAILED (ETag mismatch) ‚Üí fetch latest and retry using same X-Idempotency-Key

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- product.activate.requested { id, actor\_id, correlation\_id }    
  \- product.activated { id, actor\_id, timestamp }    
\- Audit Fields: idempotency\_key, actor\_id, reason/comment

\#\#\#\# Test Hooks  
\- data-test-id: btn-activate-product, modal-activate-confirm, api-activate-call, toast-activate-success

\#\#\#\# Acceptance (Gherkin)  
\- Given ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Approved    
\- When ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô    
\- Then ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Active ‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå product.activated ‡∏ñ‡∏π‡∏Å‡∏õ‡∏•‡πà‡∏≠‡∏¢

\#\#\#\# Assumptions & Confidence  
\- ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏°‡∏µ "controller override" ‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ß‡πâ‡πÉ‡∏ô API ‚Äî ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ override ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° flag \+ RBAC (TODO) (Confidence: Medium)

\---

\#\#\# Journey: ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Actor: Viewer / Any role with read)  
\*\*Entry:\*\* ‡∏à‡∏≤‡∏Å List \`/erp/master/products\` ‚Üí ‡∏Ñ‡∏•‡∏¥‡∏Å row code ‡∏´‡∏£‡∏∑‡∏≠ deeplink \`/erp/master/products/{id}\`    
\*\*Preconditions:\*\* ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡πà‡∏≤‡∏ô (Authorization header token valid)    
\*\*Exit / Postconditions:\*\* ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏° ETag header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö subsequent edits

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*list row / link-code\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á    
   \- Trigger: NAV ‚Üí GET /erp/master/products/{id}    
   \- map\_in: none (just path param id)    
   \- assert: client must send Authorization header    
   \- System: Server returns Product full payload \+ ETag header    
   \- map\_out: product object with child arrays (product\_barcode\[\], product\_uom\_conv\[\], product\_vendor\[\], product\_image\[\], product\_doc\[\]) \+ ETag    
   \- UI Feedback: show skeleton while loading; on success render Overview tab; set focus to main heading; aria-live region for load failure    
   \- Navigation/State: route \`/erp/master/products/{id}\` ; store etag for edits    
   \- Field & Copy Checklist:  
     \- Fields to display: id, code, name, type, category\_id (render name), status, base\_uom, purchase\_uom, tracking, weight/length/width/height, tax\_code\_id (masked if role non-Finance), gl\_inventory\_acct\_id (masked), product\_barcode\[\], product\_uom\_conv\[\], product\_vendor\[\], product\_image\[\], product\_doc\[\]    
     \- data-test-id: page-product-detail, hdr-product-code, badge-status, tab-overview, tab-uom, tab-vendors, tab-tax-gl, tab-images, tab-audit  
     \- a11y: badges include aria-label="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: {status}", heading h1 has id for skiplinks  
2\) ‚Ä¶ (end happy path)

\#\#\#\# Variants & Exceptions  
\- GET ‚Üí 404\_NOT\_FOUND: show page-level 404 with CTA "‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" data-test-id: btn-back-to-list    
\- GET ‚Üí 401/403: redirect to login or show 403 toast \+ redirect to list    
\- Large payload images/docs network timeout: show partial content with message "‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" and retry button data-test-id: btn-retry-load-docs

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- product.view.detail { id, actor\_id, timestamp, correlation\_id }    
\- Audit: view not stored as audit\_entry by default (depends on policy)

\#\#\#\# Test Hooks  
\- data-test-id: page-product-detail, api-get-product, hdr-product-code, badge-status, tab-overview

\#\#\#\# Acceptance (Gherkin)  
\- Given ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà id=1002    
\- When ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏¥‡∏î /erp/master/products/1002    
\- Then ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏° ETag

\#\#\#\# Assumptions & Confidence  
\- Response includes ETag header per API docs (Confidence: High)

\---

\#\#\# Journey: ‡∏î‡∏π/‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ & ‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏â‡∏•‡∏≤‡∏Å PDF (Document Viewer & Download) (Actor: Viewer / Warehouse)  
\*\*Entry:\*\* ‡∏à‡∏≤‡∏Å Detail tab Images/Docs ‡∏´‡∏£‡∏∑‡∏≠ Print Label modal (‡∏à‡∏≤‡∏Å List/Detail)    
\*\*Preconditions:\*\* Authorization valid; file\_url (for docs) or label template exists; if label generation returns 202 job \=\> client must poll (poll endpoint not provided ‚Äî see TODO)    
\*\*Exit / Postconditions:\*\* ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô iframe/modal ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏° fallback ‚ÄúOpen original link‚Äù (\`btn-open-original\`)

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*detail tab images / doc row / btn-view-doc\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î/‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (PDF)    
   \- Trigger: direct GET to file\_url (file service) OR call GET /erp/master/products/{id}:label?template={template\_id} for label    
   \- map\_in: for label \-\> query param template (optional) ; for product doc \-\> file\_url known from product\_doc\[\]    
   \- assert: client ensures Authorization for API label request; for file\_url (external) ensure CORS or direct download link    
   \- System:  
     \- If GET /:label returns application/pdf (200) ‚Üí open embedded PDF preview (iframe)    
     \- If returns 202 with job\_id ‚Üí show job pending UI and schedule poll (job polling endpoint missing in API list ‚Üí TODO)    
   \- map\_out: PDF binary or { job\_id, status:"accepted" }    
   \- UI Feedback: show modal PDF preview with spinner; always include fallback button \`btn-open-original\` that opens file\_url in new tab; provide data-test-id pdf-preview-iframe and btn-open-original    
   \- Navigation/State: modal open; focus trap inside modal; Esc closes modal    
   \- Field & Copy Checklist:  
     \- Buttons: btn-download-pdf, btn-open-original (links to original), btn-close-preview    
     \- Messages: if 422 from server "Template does not support symbology" show specific message and suggest alternative template  
     \- a11y: iframe has title "Preview ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ {code}" ; fallback link has aria-label  
2\) ‚Ä¶ (end happy path)

\#\#\#\# Variants & Exceptions  
\- GET /:label ‚Üí 422\_INVALID\_STATE: show message "‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö symbology ‡∏ô‡∏µ‡πâ" with CTA choose another template (data-test-id: msg-label-invalid)    
\- GET /:label ‚Üí 202 accepted (async): show job tracking UI with message "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF" and button "‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°" ; since job poll endpoint is not in API list, instruct user to retry "‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä" or check notification when ready ‚Äî (TODO: add job polling or webhook)    
\- File CDN/network error ‚Üí fallback open-original still available; else show "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå" with retry

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- br.document\_viewed { id, doc\_id?, actor\_id, template\_id? } ‚Äî use dot-case \`br.document\_viewed\` as telemetry naming convention in constraints    
  \- br.document\_downloaded { id, doc\_id?, actor\_id }    
\- Audit Fields: actor\_id, resource id, doc\_id, template

\#\#\#\# Test Hooks  
\- data-test-id: btn-view-doc, pdf-preview-iframe, btn-open-original, btn-download-pdf, pdf-job-polling

\#\#\#\# Acceptance (Gherkin)  
\- Given ‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå spec-1.pdf ‡πÉ‡∏ô product\_doc    
\- When ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î ‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£    
\- Then ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÅ‡∏™‡∏î‡∏á PDF ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏° Open original ‡∏ñ‡πâ‡∏≤ iframe ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß

\#\#\#\# Assumptions & Confidence  
\- ‡∏™‡∏°‡∏°‡∏ï‡∏¥ file\_url ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏£‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ (Confidence: Medium); job polling endpoint missing (TODO)

\---

\#\#\# Journey: ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Export List) (Actor: Viewer/Admin)  
\*\*Entry:\*\* ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ List \`/erp/master/products\` ‚Üí ‡∏õ‡∏∏‡πà‡∏° ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å (Export)    
\*\*Preconditions:\*\* ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å (scope product.export) ; filters/pagination applied as required; server may return sync CSV for small set or 202 job for async large export    
\*\*Exit / Postconditions:\*\* ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡πá‡∏Å‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô CSV (200) ‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ; ‡∏´‡∏≤‡∏Å‡πÉ‡∏´‡∏ç‡πà server ‡∏Ñ‡∏∑‡∏ô {job\_id, status:"accepted"} ‚Üí client shows job pending UI

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*list / btn-export\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Export (with current filters)    
   \- Trigger: GET /erp/master/products:export?{filters}\&format=csv    
   \- map\_in: query filters same as list filters (q,status\[\],type,category\_id,vendor\_id,tracking,updated\_from,updated\_to,sort) ; do not send server-derived fields    
   \- assert: client ensures Authorization; show confirm for large export if client pre-check shows \> threshold (client-side guess)    
   \- System: Server responds:  
     \- Case small result: 200 Content-Type: text/csv (binary) ‚Üí initiate download    
     \- Case large: 202 { job\_id, status:"accepted" } ‚Üí client shows pending and polling (poll endpoint missing in API list ‚Üí TODO)    
   \- map\_out: CSV binary or job\_id    
   \- UI Feedback: show spinner; on 200 start file download and toast "‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"; on 202 show banner "‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" with job id and CTA "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏≤‡∏ô"    
   \- Navigation/State: remain on List; telemetry product.export emitted    
   \- Field & Copy Checklist:  
     \- data-test-id: btn-export, export-format-select, toast-export-success, export-job-banner, btn-download-export  
     \- messages: 429 rate-limit message "‡πÄ‡∏Å‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á" with Retry-After handling  
     \- a11y: export dropdown labelled "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå"  
2\) ‚Ä¶ (end happy path)

\#\#\#\# Variants & Exceptions  
\- GET ‚Üí 429\_TOO\_MANY\_REQUESTS: show banner with Retry-After seconds ; client exponential backoff (retry defaults: read=2)    
\- GET ‚Üí 202 accepted: show job banner, enable polling (TODO: job polling endpoint) or provide download\_url when job completes via webhook/notification    
\- GET ‚Üí 403\_FORBIDDEN: show toast "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å"

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- product.export.requested { actor\_id, filters, export\_format, correlation\_id }    
  \- product.export.completed { job\_id?, download\_url? }    
\- Audit Fields: actor\_id, filters, job\_id

\#\#\#\# Test Hooks  
\- data-test-id: btn-export, export-format-select, api-export-call, export-job-banner, toast-export-success

\#\#\#\# Acceptance (Gherkin)  
\- Given ‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0    
\- When ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ CSV    
\- Then ‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ‡∏´‡∏£‡∏∑‡∏≠ job\_id ‡∏Ñ‡∏∑‡∏ô‡∏°‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà

\#\#\#\# Assumptions & Confidence  
\- Polling endpoint or webhook for exports not provided in API list ‚Äî TODO to add (Confidence: Medium)

\---

\#\#\# Journey: Bulk Deactivate ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (Actor: Admin)  
\*\*Entry:\*\* ‡∏à‡∏≤‡∏Å List \`/erp/master/products\` ‚Üí ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ñ‡∏ß ‚Üí Bulk Actions ‚Üí Deactivate    
\*\*Preconditions:\*\* ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ role Admin; selected ids\[\] non-empty; X-Idempotency-Key required    
\*\*Exit / Postconditions:\*\* Server returns per-id result array with success/failed and message; events product.deactivated per successful id

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*list / bulk-checkbox \+ btn-bulk-deactivate\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ñ‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Bulk Deactivate    
   \- Trigger: POST /erp/master/products:bulk    
   \- map\_in: { action: "deactivate", ids: \["1003","1004"\], params: { reason: "seasonal", override: false } } ; Headers: X-Idempotency-Key: ui:{user.id}:bulk\_deactivate:{hash(ids|params)}    
   \- assert: client ensures role Admin and non-empty ids    
   \- System: Server processes each id and returns results per id with status success/failed and messages (may be 200\)    
   \- map\_out: { action, results\[\] } ; for successes, server may emit product.deactivated events    
   \- UI Feedback: show progress modal with per-id status rows; on completion show summary toast "2 ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à / 1 ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß" and show details; provide retry failed button using same idempotency key    
   \- Navigation/State: refresh list rows to reflect statuses changed; invalidate cache    
   \- Field & Copy Checklist:  
     \- data-test-id: bulk-select-checkbox, btn-bulk-deactivate, modal-bulk-progress, bulk-result-row-{id}, btn-retry-failed  
     \- messages: "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£: {success}/{total}" ; per-failure show reason (e.g., "open PR PR-00050")  
2\) ‚Ä¶ (end happy path)

\#\#\#\# Variants & Exceptions  
\- Bulk ‚Üí 403\_FORBIDDEN: show error "‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Bulk deactivate"    
\- Bulk ‚Üí per-id failure because of open refs \-\> result for id shows message and guidance "‡∏î‡∏π PR-00050"    
\- Bulk ‚Üí idempotency CONFLICT: reuse same X-Idempotency-Key for retry; server dedupes

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- product.bulk.actioned { action:"deactivate", actor\_id, ids\[\], correlation\_id }    
\- Audit Fields: actor\_id, idempotency\_key, ids

\#\#\#\# Test Hooks  
\- data-test-id: bulk-select-checkbox, btn-bulk-deactivate, api-bulk-call, modal-bulk-progress, bulk-result-row-1003

\#\#\#\# Acceptance (Gherkin)  
\- Given ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Admin ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£    
\- When ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Bulk Deactivate    
\- Then ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏ú‡∏• per-id ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

\#\#\#\# Assumptions & Confidence  
\- Bulk API supports action "deactivate" per API list (Confidence: High)

\---

\#\#\# Journey: Retry ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (Label) ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Async (Actor: Warehouse / Viewer)  
\*\*Entry:\*\* ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å ‚Üí server ‡∏Ñ‡∏∑‡∏ô 202 job\_id ‚Üí ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö PDF ‚Üí ‡∏Å‡∏î Retry Generate    
\*\*Preconditions:\*\* original job returned 202 with job\_id; client saved idempotency key used for doc-gen    
\*\*Exit / Postconditions:\*\* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à server‡∏Ñ‡∏∑‡∏ô PDF ‡∏´‡∏£‡∏∑‡∏≠ download\_url; event br.document\_created emitted

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*label modal / btn-generate-label\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠ Generate label ‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 202 job\_id    
   \- Trigger: GET /erp/master/products/{id}:label?template={template\_id} ‚Üí 202 { job\_id }    
   \- map\_in: template param ; Headers Authorization    
   \- assert: client stores job\_id and idempotency key used for doc-gen: X-Idempotency-Key \= ui:{user.id}:{product.id}:doc    
   \- System: server processes async job; on completion either provides download\_url or the client must poll job endpoint (not provided)    
   \- map\_out: { job\_id, status }    
   \- UI Feedback: show banner "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏â‡∏•‡∏≤‡∏Å (job-{id})" with Retry button (data-test-id: btn-retry-label-gen) ; when user retries use same idempotency key    
   \- Navigation/State: remain in modal; show link to "Open original" as fallback (btn-open-original)    
   \- Field & Copy Checklist:  
     \- data-test-id: btn-generate-label, label-job-banner, btn-retry-label-gen, pdf-download-link  
     \- confirm copy: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô ‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° Retry"    
2\) \*\*retry\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Retry    
   \- Trigger: GET /erp/master/products/{id}:label with same X-Idempotency-Key (ui:{user.id}:{product.id}:doc)    
   \- map\_in: same template param    
   \- assert: reuse idempotency key per constraint (Hard Constraint ¬ß5)    
   \- System: Server dedupes and either returns existing PDF (200) or same job accepted (202) ‚Äî client must handle both    
   \- map\_out: PDF binary or job\_id    
   \- UI Feedback: if PDF returned start download; on 202 update banner  
3\) ‚Ä¶ (end happy path)

\#\#\#\# Variants & Exceptions  
\- Retry with different idempotency key ‚Üí server treats as new job; risk duplicate processing ‚Äî client should reuse same key    
\- Retry ‚Üí 422\_INVALID\_STATE (template not supporting symbology) ‚Üí show message with alternative templates list    
\- Missing job polling endpoint ‚Üí client may provide manual Retry UI (TODO)

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- br.document\_generation.requested { id, job\_id?, actor\_id, idempotency\_key }    
  \- br.document\_created { id, doc\_id?, actor\_id }    
\- Audit Fields: idempotency\_key, job\_id, actor\_id

\#\#\#\# Test Hooks  
\- data-test-id: label-job-banner, btn-retry-label-gen, btn-open-original, api-label-call

\#\#\#\# Acceptance (Gherkin)  
\- Given ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏â‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ job\_id    
\- When ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Retry ‡∏î‡πâ‡∏ß‡∏¢ idempotency key ‡πÄ‡∏î‡∏¥‡∏°    
\- Then ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏ü‡∏•‡πå PDF ‡∏´‡∏£‡∏∑‡∏≠ job accepted ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥

\#\#\#\# Assumptions & Confidence  
\- Polling endpoint for async label jobs is missing ‚Äî TODO to add; idempotency key pattern for doc-gen per Hard Constraints (Confidence: Medium)

\---

\#\#\# Journey: ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Deeplink to Detail) (Actor: Any role)  
\*\*Entry:\*\* ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å Notification ‡∏ó‡∏µ‡πà‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á \`/erp/master/products/{id}\` (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: product.submitted notification)    
\*\*Preconditions:\*\* Notification payload contains product id and route \`/erp/master/products/{id}\` ; user session active (or redirect to login)    
\*\*Exit / Postconditions:\*\* ‡πÄ‡∏õ‡∏¥‡∏î Detail page with context (highlight relevant action) and prefetch of latest ETag

\#\#\#\# Happy Path ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î  
1\) \*\*notification click\*\* ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô notification    
   \- Trigger: NAV ‚Üí route \`/erp/master/products/{id}\` with query param \`src=notification\&event=product.submitted\&corr={cid}\`    
   \- map\_in: id from route ; optional query params for context    
   \- assert: client authenticates user (redirect to login if not)    
   \- System: client calls GET /erp/master/products/{id} to hydrate page and obtains ETag; optionally call audit GET /.../audit to show related event    
   \- map\_out: product object \+ ETag ; audit entries for event context    
   \- UI Feedback: show highlight banner "‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: product.submitted" with CTA "‡∏î‡∏π‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•/‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥" ; focus main heading    
   \- Navigation/State: landing on Detail; mark notification as read via Notification service (outside scope)    
   \- Field & Copy Checklist:  
     \- data-test-id: notif-deeplink, page-product-detail, banner-notification-context, btn-view-audit  
     \- a11y: banner has role="status" aria-live  
2\) ‚Ä¶ (end happy path)

\#\#\#\# Variants & Exceptions  
\- Notification points to nonexistent id ‚Üí GET returns 404 ‚Üí show 404 page with CTA "‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" and data-test-id btn-back-to-list    
\- Notification opens but ETag mismatch later when user attempts mutation ‚Üí handle 412 per merge flow

\#\#\#\# Telemetry & Audit  
\- Events:  
  \- product.notification.opened { id, actor\_id, correlation\_id, event }    
\- Audit: reading not necessarily stored

\#\#\#\# Test Hooks  
\- data-test-id: notif-deeplink, page-product-detail, banner-notification-context

\#\#\#\# Acceptance (Gherkin)  
\- Given ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô product.submitted ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå    
\- When ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå    
\- Then ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î /erp/master/products/{id} ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô

\#\#\#\# Assumptions & Confidence  
\- Notification service and mark-as-read flows exist out-of-scope (Confidence: Medium)

\---

\#\# Self-Validation Summary (Automated Checks performed)  
\- Status labels: ‡πÉ‡∏ä‡πâ status ‡∏ï‡∏≤‡∏° API responses (Draft, In Review, Approved, Active, Inactive, Obsolete). ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ñ‡∏∂‡∏á state ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô.    
\- Map-In Audit: ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å POST/PATCH/Action ‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏â‡∏û‡∏≤‡∏∞ field ‡∏ó‡∏µ‡πà API ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö (identifier \+ user inputs) ‚Äî ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ server-owned ‡πÄ‡∏ä‡πà‡∏ô on\_hand, totals.    
\- Row Action Guards: ‡∏£‡∏∞‡∏ö‡∏∏ visibility rules (e.g., Submit visible when status==Draft; Approve visible when status==In Review; Activate visible when status==Approved). Server still re-asserts.    
\- Idempotency Audit: ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö idempotency keys‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ action (create, submit, approve, activate, doc-gen, bulk) ‡∏ï‡∏≤‡∏° Hard Constraints (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ui:{user.id}:{product.id}:{hash(...)}).    
\- Telemetry Case: ‡∏ó‡∏∏‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ä‡πâ dot-case ‡πÄ‡∏ä‡πà‡∏ô product.create, product.submitted, product.approved, product.activated, product.bulk.actioned, br.document\_viewed.    
\- Document Viewer Fallback: ‡∏ó‡∏∏‡∏Å flow ‡∏ó‡∏µ‡πà‡∏°‡∏µ PDF preview ‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏° \`btn-open-original\` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö fallback.    
\- Test Hooks: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å actionable step ‡∏£‡∏∞‡∏ö‡∏∏ data-test-id (see above). ‡∏´‡∏≤‡∏Å Page Definition ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ test-ids ‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏° convention (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô) ‚Äî ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏™‡πà‡πÉ‡∏ô TODOs ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° frontend ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô page templates.    
\- Routes: ‡πÉ‡∏ä‡πâ base\_path \`/erp/master/products\` ‡πÅ‡∏•‡∏∞ routes ‡∏ï‡∏≤‡∏° Page Definitions (leading slash present).    
\- Per-step Field/COPY Coverage: ‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏ô Happy Path ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Field & Copy Checklist (‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å/‡πÅ‡∏™‡∏î‡∏á \+ helper/confirm/validation copy \+ data-test-id \+ a11y).    
\- Schema Echo Check: ‡∏ó‡∏∏‡∏Å field ‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏ñ‡∏∂‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô API Request/Response examples; ‡∏ñ‡πâ‡∏≤‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô schema ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô TODO ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á.    
\- Page Binding Consistency: ‡∏ó‡∏∏‡∏Å action ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö API endpoint ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏é‡πÉ‡∏ô API List.

\---

\#\# TODOs (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î / ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô / ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏™‡πÄ‡∏õ‡∏Ñ)  
1\) Add job polling / job status endpoint for async exports & label generation (e.g., GET /jobs/{job\_id}) ‚Äî ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ client ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ poll download\_url. (required for Export J6 & Label async)    
2\) Clarify "controller override" RBAC and API flag for Activate/Deactivate when open references exist (e.g., allow override=true \+ approver signature) ‚Äî currently unspecified; UI presents override option but API does not define override parameter. (must define role & API)    
3\) Confirm file upload API (file service endpoint) and contract for ProductImage/ProductDoc upload ‚Üí client currently assumes external file upload returns \`file\_url\` to include in product payload. (missing in API list)    
4\) Provide explicit list of "critical fields" that trigger revision flow when edited while status=Active (page warnings mention base\_uom, tax/GL, tracking; please confirm full list). (required for revision flow correctness)    
5\) Provide rate-limit / retry headers semantics for export & label job (Retry-After header format already noted for 429\) ‚Äî clarify for long-running jobs.    
6\) Job polling webhook or callback details for asynchronous label/export jobs (download\_url vs job\_id lifecycle). (needed for Retry Document Generation & Export)    
7\) Confirm masking rules for GL/tax fields per role in API responses (server-side masking) ‚Äî current UI assumes GL masked for non-Finance. (specify masking logic)    
8\) Add data-test-id entries to Page Definitions templates (packingList.v1, createDrawer.v2, viewDrawer.v1, importDrawer.v1, deleteConfirm.v1) for each control referenced above (list items):    
   \- btn-open-create, drawer-create-product, input-code, input-name, select-base\_uom, table-barcode, btn-save-draft, btn-create-submit, btn-submit-product, confirm-submit-product, btn-approve-product, modal-approve-confirm, btn-reject-product, modal-reject-reason, btn-activate-product, modal-activate-confirm, btn-export, export-job-banner, btn-bulk-deactivate, modal-bulk-progress, btn-retry-label-gen, btn-open-original, pdf-preview-iframe, page-product-detail, hdr-product-code, badge-status, tab-tax-gl, tab-uom, tab-vendors, tab-images, tab-audit, api-\* call hooks. (Please add these to templates)    
9\) Confirm behavior for Import \`mode=upsert\` ‚Äî how to handle existing active products (create revision? update directly?) and whether import can create Approved/Active items or only Draft. (clarify import policy)    
10\) Confirm whether product.approved event should auto-trigger downstream consumers (PR/PO/GRN) or only notify; define contract for event payload (snapshot\_id or full minimal snapshot). (events payload spec missing)    
11\) Provide polling or webhook endpoint for import/report download\_url (import returns report\_url but for async operations we need consistent job model).    
12\) Clarify role mapping for "Editor" vs "Admin" for Create access ‚Äî Page Definitions states "Create Drawer visible only to Admin" but other sections reference Editor creating drafts. Confirm RBAC table.    
13\) Add explicit data model for barcode uniqueness check across products (to allow client-side duplicate detection) ‚Äî currently server will return 400 on duplicate but client UX may prefer pre-check endpoint.    
14\) Confirm decimal precision/validation rules in UI components (e.g., factor decimal(18,6), price\_hint decimal(18,4)) ‚Äî UI must enforce same precision. (partially provided in API notes but formalize)

\---

\#\# Confidence & Notes  
\- Confidence (overall): Medium‚ÄìHigh for API mappings and page flows because API List and Page Definitions cover the majority of endpoints and fields. Gaps are primarily around async job polling, file upload contract, controller override semantics, and RBAC nuance for Create. These have been listed in TODOs.    
\- If any TODOs are resolved, journeys can be updated to include polling endpoints, explicit override parameters, and exact test-id placements in templates.

\#\# 10.0 Data Schema

\#\#\# 10.0.1 ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÄ‡∏≠‡∏ô‡∏ó‡∏¥‡∏ï‡∏µ (Entity Overview)  
\- products ‚Äî ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (master) ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡πâ‡∏î/‡∏ä‡∏ô‡∏¥‡∏î/UOM/GL/Tax/‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ \+ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö barcodes, uom\_conversions, vendors, images, docs, audit    
\- product\_uom\_convs ‚Äî ‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏à‡∏≤‡∏Å‚Üí‡∏ñ‡∏∂‡∏á, factor) (N:1 ‚Üí products)    
\- product\_vendors ‚Äî ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ vendor ‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (N:1 ‚Üí products) ‡∏û‡∏£‡πâ‡∏≠‡∏° flag preferred (unique per product+currency)    
\- product\_barcodes ‚Äî ‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (N:1 ‚Üí products) ‡∏û‡∏£‡πâ‡∏≠‡∏° flag is\_primary (unique per symbology+value)    
\- product\_images ‚Äî ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (N:1 ‚Üí products)    
\- product\_docs ‚Äî ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (N:1 ‚Üí products)    
\- categories ‚Äî ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (hierarchy: parent\_id ‚Üí categories)    
\- product\_audits ‚Äî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥/‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (N:1 ‚Üí products) ‚Äî ‡πÄ‡∏Å‡πá‡∏ö audit (actor, role, action, reason, diff)

\#\#\# 10.0.2 ‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á

\#\#\# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á products ‚Äî Product master record  
\*\*‡∏Ñ‡∏µ‡∏¢‡πå & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\*\*    
\- PK (internal): \`row\_id\`    
\- Public ID: \`id\` (\`PRD-{SEQ}\`) ‚Äî UNIQUE    
\- UK: \`uq\_products\_code (code)\`    
\- FK: \`category\_row\_id ‚Üí categories.row\_id (ON UPDATE CASCADE ON DELETE RESTRICT)\`    
\- Parent-of: product\_barcodes / product\_uom\_convs / product\_vendors / product\_images / product\_docs / product\_audits    
\- Child-of: category (optional)

\*\*‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤\*\*  
| ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå | ‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏µ‡∏¢‡πå | Null | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î | ‡∏î‡∏±‡∏ä‡∏ô‡∏µ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |  
|---|---|---|---|---|---|---|---|  
| row\_id | uuid | PK | NO | gen\_random\_uuid() | \- | pk | ‡∏Ñ‡∏µ‡∏¢‡πå‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏ú‡πà‡∏≤‡∏ô API) |  
| id | varchar(14) | UNIQUE | NO | trigger | CHECK (id \~ '^PRD-\\d{10}$') | uq\_products\_code? | ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏±‡πâ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ |  
| code | varchar(32) | \- | NO | \- | UNIQUE, immutable when status='Active' (trigger) | idx\_products\_code | ‡∏£‡∏´‡∏±‡∏™‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à (‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏°‡∏∑‡πà‡∏≠ Active) |  
| name | varchar(200) | \- | NO | \- | \- | idx\_products\_name | ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ |  
| type | text | \- | NO | 'Stock' | CHECK (type IN ('Stock','NonStock','Service')) | idx\_products\_type | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ |  
| category\_row\_id | uuid | FK | YES | NULL | \- | idx\_products\_category\_row\_id | FK ‚Üí categories.row\_id |  
| status | text | \- | NO | 'Draft' | CHECK (status IN ('Draft','In Review','Approved','Active','Inactive','Obsolete')) | idx\_products\_status\_updated\_at | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≤‡∏° workflow |  
| base\_uom | varchar(32) | \- | NO | \- | \- | idx\_products\_base\_uom | ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ê‡∏≤‡∏ô (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) |  
| purchase\_uom | varchar(32) | \- | YES | NULL | \- | \- | UOM ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠ |  
| tracking | text | \- | NO | 'None' | CHECK (tracking IN ('None','Lot','Serial')) | idx\_products\_tracking | ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° lot/serial |  
| weight | decimal(18,3) | \- | YES | NULL | \>=0 | \- | ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å |  
| length | decimal(18,2) | \- | YES | NULL | \>=0 | \- | ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß |  
| width | decimal(18,2) | \- | YES | NULL | \>=0 | \- | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á |  
| height | decimal(18,2) | \- | YES | NULL | \>=0 | \- | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á |  
| weight\_uom | varchar(8) | \- | YES | NULL | \- | \- | ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å |  
| volume\_uom | varchar(8) | \- | YES | NULL | \- | \- | ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£ |  
| tax\_code\_id | varchar(64) | \- | YES | NULL | \- | idx\_products\_tax\_code\_id | ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á Tax master (external id/string) |  
| gl\_inventory\_acct\_id | varchar(64) | \- | YES | NULL | \- | idx\_products\_gl\_inventory\_acct\_id | ‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡∏Ñ‡∏•‡∏±‡∏á (external) |  
| gl\_expense\_acct\_id | varchar(64) | \- | YES | NULL | \- | idx\_products\_gl\_expense\_acct\_id | ‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (external) |  
| cost\_method | text | \- | NO | 'Standard' | CHECK (cost\_method IN ('Standard','MovingAvg')) | \- | ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô |  
| standard\_cost | decimal(18,4) | \- | YES | NULL | \>=0 | idx\_products\_standard\_cost | ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô |  
| hazardous | boolean | \- | NO | false | \- | idx\_products\_hazardous | ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ |  
| shelf\_life\_days | integer | \- | YES | NULL | CHECK (shelf\_life\_days \>= 0\) | \- | ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) |  
| remarks | text | \- | YES | NULL | \- | \- | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |  
| created\_at | timestamptz | \- | NO | now() | \- | idx\_products\_created\_at | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á (UTC) |  
| updated\_at | timestamptz | \- | NO | now() | \- | idx\_products\_status\_updated\_at | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (UTC) |  
| version | integer | \- | NO | 1 | CHECK (version \> 0\) | \- | optimistic locking |  
| deleted\_at | timestamptz | \- | YES | NULL | \- | \- | soft delete (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô) |

\*\*‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á API ‚Üî DB (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\*\*  
\- API field \`id\` ‚Üî DB \`id\` (public short id PRD-0000000001). API may provide public id or (legacy) numeric; mapping layer must resolve to row\_id.    
\- API \`category\_id\` (public id like CAT-0000000001) ‚Üí mapped to \`category\_row\_id\` (uuid) before DB operations.    
\- GL/Tax fields passed as string ids in API ‚Üí stored in respective text columns; validation of existence done by integration layer (404 if missing).

\*\*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á)\*\*  
\- row:  
  \- row\_id: 3f1b9a1e-8c4d-4a2f-9c3a-1f2b3c4d5e6f  
  \- id: PRD-0000000001  
  \- code: PROD-0002  
  \- name: ‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö  
  \- type: Stock  
  \- category\_row\_id: 9a7b6c5d-1e2f-3a4b-5c6d-7e8f9a0b1c2d  
  \- status: Draft  
  \- base\_uom: L  
  \- tracking: Lot  
  \- standard\_cost: 12.3456  
  \- hazardous: false  
  \- created\_at: 2025-11-05T08:30:00Z  
  \- updated\_at: 2025-11-05T08:30:00Z

\---

\#\#\# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á product\_uom\_convs ‚Äî ProductUomConv (unit conversions)  
\*\*‡∏Ñ‡∏µ‡∏¢‡πå & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\*\*    
\- PK (internal): \`row\_id\`    
\- Public ID: \`id\` (\`PUC-{SEQ}\`) ‚Äî UNIQUE    
\- UK: \`uq\_product\_uom\_convs\_product\_from\_to (product\_row\_id, from\_uom, to\_uom)\`    
\- FK: \`product\_row\_id ‚Üí products.row\_id (ON UPDATE CASCADE ON DELETE CASCADE)\`    
\- Parent-of: ‚Äî / Child-of: products

\*\*‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤\*\*  
| ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå | ‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏µ‡∏¢‡πå | Null | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î | ‡∏î‡∏±‡∏ä‡∏ô‡∏µ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |  
|---|---|---|---|---|---|---|---|  
| row\_id | uuid | PK | NO | gen\_random\_uuid() | \- | pk | |  
| id | varchar(14) | UNIQUE | NO | trigger | CHECK (id \~ '^PUC-\\d{10}$') | \- | |  
| product\_row\_id | uuid | FK | NO | \- | \- | idx\_product\_uom\_convs\_product\_row\_id | FK ‚Üí products.row\_id |  
| from\_uom | varchar(32) | \- | NO | \- | \- | idx\_product\_uom\_convs\_from\_uom | ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á |  
| to\_uom | varchar(32) | \- | NO | \- | \- | idx\_product\_uom\_convs\_to\_uom | ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á |  
| factor | decimal(18,6) | \- | NO | \- | CHECK (factor \> 0\) | \- | ‡∏Ñ‡πà‡∏≤‡∏™‡πÄ‡∏Å‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á |  
| created\_at | timestamptz | \- | NO | now() | \- | \- | |  
| updated\_at | timestamptz | \- | NO | now() | \- | \- | |  
| version | integer | \- | NO | 1 | CHECK (version \> 0\) | \- | |

\*\*‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á API ‚Üî DB (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\*\*  
\- API arrays \`product\_uom\_conv\[\]\` map fields \`from\_uom\`, \`to\_uom\`, \`factor\` ‚Üí stored here; API \`product\_id\` resolved to \`product\_row\_id\` (uuid).

\*\*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á)\*\*  
\- row:  
  \- row\_id: a1b2c3d4-e5f6-4a7b-9c8d-0e1f2a3b4c5d  
  \- id: PUC-0000000001  
  \- product\_row\_id: 3f1b9a1e-8c4d-4a2f-9c3a-1f2b3c4d5e6f  
  \- from\_uom: L  
  \- to\_uom: ML  
  \- factor: 1000.000000  
  \- created\_at: 2025-11-05T08:30:00Z

\---

\#\#\# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á product\_vendors ‚Äî ProductVendor  
\*\*‡∏Ñ‡∏µ‡∏¢‡πå & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\*\*    
\- PK (internal): \`row\_id\`    
\- Public ID: \`id\` (\`PVN-{SEQ}\`) ‚Äî UNIQUE    
\- UK: \`uq\_product\_vendor\_product\_vendor\_currency\_preferred\` (unique where preferred \= true) enforced via UNIQUE INDEX (product\_row\_id, currency) WHERE preferred \= true    
\- FK: \`product\_row\_id ‚Üí products.row\_id (ON UPDATE CASCADE ON DELETE CASCADE)\`    
\- Parent-of: ‚Äî / Child-of: products

\*\*‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤\*\*  
| ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå | ‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏µ‡∏¢‡πå | Null | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î | ‡∏î‡∏±‡∏ä‡∏ô‡∏µ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |  
|---|---|---|---|---|---|---|---|  
| row\_id | uuid | PK | NO | gen\_random\_uuid() | \- | pk | |  
| id | varchar(14) | UNIQUE | NO | trigger | CHECK (id \~ '^PVN-\\d{10}$') | \- | |  
| product\_row\_id | uuid | FK | NO | \- | \- | idx\_product\_vendors\_product\_row\_id | FK ‚Üí products.row\_id |  
| vendor\_id | varchar(64) | \- | NO | \- | \- | idx\_product\_vendors\_vendor\_id | ‡∏£‡∏´‡∏±‡∏™ vendor (external id/string); validated by integration |  
| vendor\_sku | varchar(64) | \- | YES | NULL | \- | \- | ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ vendor |  
| preferred | boolean | \- | NO | false | \- | idx\_product\_vendors\_preferred | ‡∏ò‡∏á preferred |  
| moq | integer | \- | YES | NULL | CHECK (moq \>= 0\) | \- | minimum order quantity |  
| lead\_time\_days | integer | \- | YES | NULL | CHECK (lead\_time\_days \>= 0\) | \- | ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ |  
| price\_hint | decimal(18,4) | \- | YES | NULL | \>=0 | idx\_product\_vendors\_price\_hint | ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì |  
| currency | varchar(8) | \- | YES | NULL | \- | idx\_product\_vendors\_currency | ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô (ISO code) |  
| created\_at | timestamptz | \- | NO | now() | \- | \- | |  
| updated\_at | timestamptz | \- | NO | now() | \- | \- | |  
| version | integer | \- | NO | 1 | CHECK (version \> 0\) | \- | |

\*\*‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á API ‚Üî DB (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\*\*  
\- API \`vendor\_id\` passed as external id (e.g., VND-01) ‚Üí stored in \`vendor\_id\`. Integration validates existence (404 if missing). FK to vendor master is handled at service layer (no DB FK to external table).

\*\*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á)\*\*  
\- row:  
  \- row\_id: b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e  
  \- id: PVN-0000000001  
  \- product\_row\_id: 3f1b9a1e-8c4d-4a2f-9c3a-1f2b3c4d5e6f  
  \- vendor\_id: VND-01  
  \- vendor\_sku: SKU-123  
  \- preferred: true  
  \- moq: 10  
  \- lead\_time\_days: 7  
  \- price\_hint: 12.3456  
  \- currency: THB  
  \- created\_at: 2025-11-05T08:30:00Z

\---

\#\#\# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á product\_barcodes ‚Äî ProductBarcode  
\*\*‡∏Ñ‡∏µ‡∏¢‡πå & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\*\*    
\- PK (internal): \`row\_id\`    
\- Public ID: \`id\` (\`PBC-{SEQ}\`) ‚Äî UNIQUE    
\- UK: \`uq\_product\_barcodes\_symbology\_value (symbology, value)\`    
\- FK: \`product\_row\_id ‚Üí products.row\_id (ON UPDATE CASCADE ON DELETE CASCADE)\`    
\- Parent-of: ‚Äî / Child-of: products

\*\*‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤\*\*  
| ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå | ‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏µ‡∏¢‡πå | Null | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î | ‡∏î‡∏±‡∏ä‡∏ô‡∏µ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |  
|---|---|---|---|---|---|---|---|  
| row\_id | uuid | PK | NO | gen\_random\_uuid() | \- | pk | |  
| id | varchar(14) | UNIQUE | NO | trigger | CHECK (id \~ '^PBC-\\d{10}$') | \- | |  
| product\_row\_id | uuid | FK | NO | \- | \- | idx\_product\_barcodes\_product\_row\_id | FK ‚Üí products.row\_id |  
| symbology | text | \- | NO | \- | CHECK (symbology IN ('EAN13','UPC','QR','Code128')) | idx\_product\_barcodes\_symbology | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î |  
| value | varchar(64) | \- | NO | \- | \<=64 | idx\_product\_barcodes\_value | ‡∏Ñ‡πà‡∏≤/‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î |  
| is\_primary | boolean | \- | NO | false | \- | idx\_product\_barcodes\_is\_primary | ‡∏ò‡∏á primary |  
| created\_at | timestamptz | \- | NO | now() | \- | \- | |  
| updated\_at | timestamptz | \- | NO | now() | \- | \- | |  
| version | integer | \- | NO | 1 | CHECK (version \> 0\) | \- | |

\*\*‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á API ‚Üî DB (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\*\*  
\- API \`product\_barcode\[\]\` maps to this table. API \`symbology\` strings follow canonical set. API \`id\` (if provided) resolves to this table's \`id\` or \`row\_id\`.

\*\*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á)\*\*  
\- row:  
  \- row\_id: c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f  
  \- id: PBC-0000000001  
  \- product\_row\_id: 3f1b9a1e-8c4d-4a2f-9c3a-1f2b3c4d5e6f  
  \- symbology: EAN13  
  \- value: 1234567890123  
  \- is\_primary: true  
  \- created\_at: 2025-11-05T08:30:00Z

\---

\#\#\# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á product\_images ‚Äî ProductImage  
\*\*‡∏Ñ‡∏µ‡∏¢‡πå & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\*\*    
\- PK (internal): \`row\_id\`    
\- Public ID: \`id\` (\`PIM-{SEQ}\`) ‚Äî UNIQUE    
\- FK: \`product\_row\_id ‚Üí products.row\_id (ON UPDATE CASCADE ON DELETE CASCADE)\`    
\- Parent-of: ‚Äî / Child-of: products

\*\*‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤\*\*  
| ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå | ‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏µ‡∏¢‡πå | Null | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î | ‡∏î‡∏±‡∏ä‡∏ô‡∏µ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |  
|---|---|---|---|---|---|---|---|  
| row\_id | uuid | PK | NO | gen\_random\_uuid() | \- | pk | |  
| id | varchar(14) | UNIQUE | NO | trigger | CHECK (id \~ '^PIM-\\d{10}$') | \- | |  
| product\_row\_id | uuid | FK | NO | \- | \- | idx\_product\_images\_product\_row\_id | FK ‚Üí products.row\_id |  
| url | text | \- | NO | \- | \- | \- | ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏ü‡∏•‡πå (public URL) |  
| alt\_text | varchar(200) | \- | YES | NULL | \- | \- | ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏£‡∏≠‡∏á |  
| is\_primary | boolean | \- | NO | false | \- | idx\_product\_images\_is\_primary | ‡∏ò‡∏á primary |  
| created\_at | timestamptz | \- | NO | now() | \- | \- | |  
| updated\_at | timestamptz | \- | NO | now() | \- | \- | |  
| version | integer | \- | NO | 1 | CHECK (version \> 0\) | \- | |

\*\*‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á API ‚Üî DB (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\*\*  
\- API \`product\_image\[\]\` ‚Üí map to this table. \`url\` stored as text; files hosted externally.

\*\*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á)\*\*  
\- row:  
  \- row\_id: d4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a  
  \- id: PIM-0000000001  
  \- product\_row\_id: 3f1b9a1e-8c4d-4a2f-9c3a-1f2b3c4d5e6f  
  \- url: https://files.example.com/img-1.jpg  
  \- alt\_text: ‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤  
  \- is\_primary: true  
  \- created\_at: 2025-11-05T08:30:00Z

\---

\#\#\# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á product\_docs ‚Äî ProductDoc  
\*\*‡∏Ñ‡∏µ‡∏¢‡πå & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\*\*    
\- PK (internal): \`row\_id\`    
\- Public ID: \`id\` (\`PDC-{SEQ}\`) ‚Äî UNIQUE    
\- FK: \`product\_row\_id ‚Üí products.row\_id (ON UPDATE CASCADE ON DELETE CASCADE)\`    
\- Parent-of: ‚Äî / Child-of: products

\*\*‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤\*\*  
| ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå | ‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏µ‡∏¢‡πå | Null | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î | ‡∏î‡∏±‡∏ä‡∏ô‡∏µ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |  
|---|---|---|---|---|---|---|---|  
| row\_id | uuid | PK | NO | gen\_random\_uuid() | \- | pk | |  
| id | varchar(14) | UNIQUE | NO | trigger | CHECK (id \~ '^PDC-\\d{10}$') | \- | |  
| product\_row\_id | uuid | FK | NO | \- | \- | idx\_product\_docs\_product\_row\_id | FK ‚Üí products.row\_id |  
| file\_url | text | \- | NO | \- | \- | \- | ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ |  
| doc\_type | text | \- | NO | 'Other' | CHECK (doc\_type IN ('Spec','MSDS','Cert','Other')) | idx\_product\_docs\_doc\_type | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ |  
| created\_at | timestamptz | \- | NO | now() | \- | \- | |  
| updated\_at | timestamptz | \- | NO | now() | \- | \- | |  
| version | integer | \- | NO | 1 | CHECK (version \> 0\) | \- | |

\*\*‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á API ‚Üî DB (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\*\*  
\- API \`product\_doc\[\]\` ‚Üí map to this table.

\*\*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á)\*\*  
\- row:  
  \- row\_id: e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b  
  \- id: PDC-0000000001  
  \- product\_row\_id: 3f1b9a1e-8c4d-4a2f-9c3a-1f2b3c4d5e6f  
  \- file\_url: https://files.example.com/spec-1.pdf  
  \- doc\_type: Spec  
  \- created\_at: 2025-11-05T08:30:00Z

\---

\#\#\# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á categories ‚Äî Category (hierarchy)  
\*\*‡∏Ñ‡∏µ‡∏¢‡πå & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\*\*    
\- PK (internal): \`row\_id\`    
\- Public ID: \`id\` (\`CAT-{SEQ}\`) ‚Äî UNIQUE    
\- UK: \`uq\_categories\_code (code)\`    
\- FK: \`parent\_row\_id ‚Üí categories.row\_id (ON UPDATE CASCADE ON DELETE RESTRICT)\` (nullable)    
\- Parent-of: products / categories (children) / Child-of: categories (parent)

\*\*‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤\*\*  
| ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå | ‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏µ‡∏¢‡πå | Null | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î | ‡∏î‡∏±‡∏ä‡∏ô‡∏µ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |  
|---|---|---|---|---|---|---|---|  
| row\_id | uuid | PK | NO | gen\_random\_uuid() | \- | pk | |  
| id | varchar(14) | UNIQUE | NO | trigger | CHECK (id \~ '^CAT-\\d{10}$') | \- | |  
| code | varchar(32) | \- | NO | \- | UNIQUE | idx\_categories\_code | ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà |  
| name | varchar(200) | \- | NO | \- | \- | idx\_categories\_name | ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà |  
| parent\_row\_id | uuid | FK | YES | NULL | \- | idx\_categories\_parent\_row\_id | FK ‚Üí categories.row\_id |  
| created\_at | timestamptz | \- | NO | now() | \- | \- | |  
| updated\_at | timestamptz | \- | NO | now() | \- | \- | |  
| version | integer | \- | NO | 1 | CHECK (version \> 0\) | \- | |

\*\*‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á API ‚Üî DB (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\*\*  
\- API \`category\_id\` ‚Üî DB \`id\` public; service maps to \`row\_id\` for FK usage.

\*\*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á)\*\*  
\- row:  
  \- row\_id: 9a7b6c5d-1e2f-3a4b-5c6d-7e8f9a0b1c2d  
  \- id: CAT-0000000012  
  \- code: CAT-12  
  \- name: ‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ  
  \- parent\_row\_id: NULL  
  \- created\_at: 2025-01-01T00:00:00Z

\---

\#\#\# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á product\_audits ‚Äî ProductAudit (activity log)  
\*\*‡∏Ñ‡∏µ‡∏¢‡πå & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå\*\*    
\- PK (internal): \`row\_id\`    
\- Public ID: \`id\` (\`PAD-{SEQ}\`) ‚Äî UNIQUE    
\- FK: \`product\_row\_id ‚Üí products.row\_id (ON UPDATE CASCADE ON DELETE CASCADE)\`    
\- Parent-of: ‚Äî / Child-of: products

\*\*‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤\*\*  
| ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå | ‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏µ‡∏¢‡πå | Null | ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î | ‡∏î‡∏±‡∏ä‡∏ô‡∏µ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |  
|---|---|---|---|---|---|---|---|  
| row\_id | uuid | PK | NO | gen\_random\_uuid() | \- | pk | |  
| id | varchar(14) | UNIQUE | NO | trigger | CHECK (id \~ '^PAD-\\d{10}$') | \- | |  
| product\_row\_id | uuid | FK | NO | \- | \- | idx\_product\_audits\_product\_row\_id | FK ‚Üí products.row\_id |  
| timestamp | timestamptz | \- | NO | now() | \- | idx\_product\_audits\_timestamp | ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå |  
| actor | varchar(200) | \- | NO | \- | \- | \- | ‡∏ú‡∏π‡πâ‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ (identifier/email) |  
| role | text | \- | NO | \- | CHECK (role IN ('Master Data Admin','Procurement','Warehouse','Finance')) | \- | ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó |  
| action | text | \- | NO | \- | \- | \- | action name (create,submit,approve,activate,update,...) |  
| reason | text | \- | YES | NULL | \- | \- | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏ |  
| diff | jsonb | \- | YES | NULL | \- | \- | snapshot diff (optional) |  
| created\_at | timestamptz | \- | NO | now() | \- | \- | |

\*\*‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á API ‚Üî DB (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\*\*  
\- GET /{id}/audit ‚Üí queries this table; API returns actor, role, action, timestamp, reason, diff.

\*\*‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á)\*\*  
\- row:  
  \- row\_id: f6a7b8c9-d0e1-4f2a-3b4c-5d6e7f8a9b0c  
  \- id: PAD-0000000001  
  \- product\_row\_id: 3f1b9a1e-8c4d-4a2f-9c3a-1f2b3c4d5e6f  
  \- timestamp: 2025-11-07T14:22:00Z  
  \- actor: finance@org  
  \- role: Finance  
  \- action: approve  
  \- reason: Approved by finance  
  \- diff: {}

\---

\#\#\#\#= 10.0.3 ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏î‡∏±‡∏ä‡∏ô‡∏µ (Indexing Hints)  
\- ‡∏î‡∏±‡∏ä‡∏ô‡∏µ FK: ‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á child ‡∏°‡∏µ index ‡∏ö‡∏ô \`\<table\>\_product\_row\_id\` / \`category\_row\_id\` ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô (‡∏ä‡∏∑‡πà‡∏≠: idx\_\<table\>\_\<fk\>).    
\- Lookups: idx\_products\_code (exact lookup), idx\_product\_barcodes\_symbology (symbology), idx\_product\_barcodes\_value (value), idx\_product\_vendors\_vendor\_id, idx\_products\_status\_updated\_at (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞+updated\_at), idx\_products\_base\_uom.    
\- Composite/default sort: idx\_products\_status\_updated\_at ON (status, updated\_at DESC).    
\- Unique/partial: unikues: uq\_products\_code; unique (symbology,value) on product\_barcodes; unique partial idx for preferred vendor: CREATE UNIQUE INDEX uq\_product\_vendors\_product\_currency\_preferred ON product\_vendors (product\_row\_id, currency) WHERE preferred \= true;    
\- Fulltext/search: implement application-level q search across code/name/barcode via materialized view or dedicated search index (not persisted here).

\#\# 10.1 ERD  
\`\`\`mermaid  
erDiagram  
  CATEGORIES ||--o{ PRODUCTS : has  
  CATEGORIES ||--o{ CATEGORIES : parent\_of  
  PRODUCTS ||--o{ PRODUCT\_BAR\_CODES : has  
  PRODUCTS ||--o{ PRODUCT\_UOM\_CONVS : has  
  PRODUCTS ||--o{ PRODUCT\_VENDORS : has  
  PRODUCTS ||--o{ PRODUCT\_IMAGES : has  
  PRODUCTS ||--o{ PRODUCT\_DOCS : has  
  PRODUCTS ||--o{ PRODUCT\_AUDITS : logs  
\`\`\`  
(‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÇ‡∏î‡∏¢ FK ‚Üí parent.row\_id; 1:N ‡πÉ‡∏ä‡πâ ||--o{ ; self-parent ‡πÉ‡∏ä‡πâ ||--o{)

\#\# 10.2 ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå DDL & ‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏µ‡∏¢‡πå  
\- Prerequisite: CREATE EXTENSION IF NOT EXISTS pgcrypto;    
\- PK: \`row\_id UUID PRIMARY KEY DEFAULT gen\_random\_uuid()\`    
\- Public ID: ‡∏ó‡∏∏‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏°‡∏µ \`id VARCHAR(\<len\>) NOT NULL UNIQUE\` \+ \`CHECK (id \~ '^\<PREFIX\>-\\d{10}$')\` \+ sequence \+ BEFORE INSERT trigger fn\_\<table\>\_make\_public\_id() ‡πÅ‡∏•‡∏∞ seq\_\<table\>\_public\_id    
  \- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á prefix mapping: products ‚Üí PRD, product\_uom\_convs ‚Üí PUC, product\_vendors ‚Üí PVN, product\_barcodes ‚Üí PBC, product\_images ‚Üí PIM, product\_docs ‚Üí PDC, categories ‚Üí CAT, product\_audits ‚Üí PAD    
\- created\_at / updated\_at default now(); version integer default 1 CHECK (version\>0)    
\- Foreign Keys: ‡∏ó‡∏∏‡∏Å FK ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á parent.row\_id; default: ON UPDATE CASCADE ON DELETE RESTRICT; ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô child tables (\`\*\_uom\_convs\`, \`\*\_vendors\`, \`\*\_barcodes\`, \`\*\_images\`, \`\*\_docs\`, \`\*\_audits\`) ‚Üí ON DELETE CASCADE    
\- Constraints:  
  \- CHECK enums as TEXT \+ CHECK (...) ‡∏ï‡∏≤‡∏° canonical (status, type, tracking, cost\_method, symbology, doc\_type)    
  \- UNIQUE products.code (uq\_products\_code)    
  \- UNIQUE product\_barcodes (symbology, value) (uq\_product\_barcodes\_symbology\_value)    
  \- UNIQUE PARTIAL preferred vendor: CREATE UNIQUE INDEX uq\_product\_vendors\_product\_currency\_preferred ON product\_vendors(product\_row\_id, currency) WHERE preferred \= true    
\- Business rules enforced in DB where feasible:  
  \- Prevent update of products.code when status \= 'Active' via BEFORE UPDATE trigger (raises exception).    
  \- Prevent type=Service with non-null gl\_inventory\_acct\_id via CHECK or trigger: CHECK NOT (type='Service' AND gl\_inventory\_acct\_id IS NOT NULL). Also CHECK (type='Service' \=\> tracking \= 'None').    
  \- Prevent preferred vendors \>1 per product+currency via unique partial index (see above).    
\- Rules enforced at application/integration layer (documented): UOM conversion acyclic graph; open PR/PO/GRN checks before deactivate/obsolete; GL/Tax existence validated against external masters before Activate. These require cross-system queries; DB cannot enforce alone.    
\- Sequence/Trigger template (per table):  
  \- CREATE SEQUENCE IF NOT EXISTS seq\_\<table\>\_public\_id;  
  \- CREATE OR REPLACE FUNCTION fn\_\<table\>\_make\_public\_id() RETURNS trigger LANGUAGE plpgsql AS $$ BEGIN IF NEW.id IS NULL OR NEW.id \= '' THEN NEW.id := '\<PREFIX\>-' || lpad(nextval('seq\_\<table\>\_public\_id')::text, 10, '0'); END IF; RETURN NEW; END; $$;    
  \- CREATE TRIGGER trg\_\<table\>\_public\_id BEFORE INSERT ON \<table\> FOR EACH ROW EXECUTE FUNCTION fn\_\<table\>\_make\_public\_id();  
\- Concurrency & optimistic locking: use version \+ updated\_at \+ ETag layer; application must increment version on update and check If-Match.

\#\# 10.3 ‡∏û‡∏à‡∏ô‡∏≤‡∏ô‡∏∏‡∏Å‡∏£‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Field Dictionary ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°)  
(‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏ö‡∏£‡∏±‡∏î: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á products ‡πÅ‡∏•‡∏∞ product\_vendors ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç; ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤)

\- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á: products  
  \- row\_id: uuid; \-; NOT NULL; gen\_random\_uuid(); internal PK; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "3f1b9a1e-8c4d-4a2f-9c3a-1f2b3c4d5e6f"; PII: no  
  \- id: varchar(14); length 14; NOT NULL; trigger; CHECK '^PRD-\\d{10}$'; public id; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "PRD-0000000001"; PII: no  
  \- code: varchar(32); length 32; NOT NULL; \-; business code; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "PROD-0002"; PII: no; Note: immutable when status='Active'  
  \- name: varchar(200); length 200; NOT NULL; \-; display name; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö"; PII: no  
  \- type: text; \-; NOT NULL; 'Stock'; enum; e.g., "Stock"; PII: no  
  \- category\_row\_id: uuid; \-; NULLABLE; NULL; FK ‚Üí categories.row\_id; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 9a7b...; PII: no  
  \- base\_uom: varchar(32); length 32; NOT NULL; \-; ‡πÄ‡∏ä‡πà‡∏ô "PCS","L"; PII: no  
  \- tracking: text; \-; NOT NULL; 'None'; enum; e.g., "Lot"; PII: no  
  \- gl\_inventory\_acct\_id: varchar(64); length 64; YES; NULL; account code string; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "1100"; PII: mask for non-Finance in API  
  \- standard\_cost: decimal(18,4); precision 18 scale 4; YES; NULL; monetary; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 12.3456; PII: no  
  \- hazardous: boolean; \-; NOT NULL; false; \-; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: false; PII: no  
  \- shelf\_life\_days: integer; \-; YES; NULL; \>=0; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 365; PII: no  
  \- created\_at / updated\_at: timestamptz; NOT NULL; now(); ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "2025-11-05T08:30:00Z"; PII: no  
  \- version: integer; NOT NULL; 1; \>0; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 1; PII: no

\- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á: product\_vendors  
  \- row\_id: uuid; PK; gen\_random\_uuid(); ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: b2c3...  
  \- id: varchar(14); CHECK '^PVN-\\d{10}$'; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: PVN-0000000001  
  \- product\_row\_id: uuid; FK ‚Üí products.row\_id; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 3f1b...  
  \- vendor\_id: varchar(64); length 64; NOT NULL; external vendor id; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: VND-01; PII: vendor identifiers not PII  
  \- vendor\_sku: varchar(64); length 64; NULLABLE; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: SKU-123  
  \- preferred: boolean; NOT NULL; false; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: true  
  \- price\_hint: decimal(18,4); precision 18 scale 4; NULLABLE; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 12.3456  
  \- currency: varchar(8); length 8; NULLABLE; ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: THB

(‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏≠‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô 10.0.2)

PII / Masking:    
\- PII ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô: national\_id, tax\_id, email, phone ‚Äî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô schema ‡∏ô‡∏µ‡πâ.    
\- Sensitive: gl\_inventory\_acct\_id / gl\_expense\_acct\_id / tax\_code\_id ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å masked ‡πÉ‡∏ô API responses ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Finance (masking applied at API layer based on RBAC).

\#\# 10.4 Enums & Patterns  
\- status: TEXT \+ CHECK IN ('Draft','In Review','Approved','Active','Inactive','Obsolete')    
\- type: TEXT \+ CHECK IN ('Stock','NonStock','Service')    
\- tracking: TEXT \+ CHECK IN ('None','Lot','Serial')    
\- cost\_method: TEXT \+ CHECK IN ('Standard','MovingAvg')    
\- symbology: TEXT \+ CHECK IN ('EAN13','UPC','QR','Code128')    
\- doc\_type: TEXT \+ CHECK IN ('Spec','MSDS','Cert','Other')    
\- Public ID regex per table:  
  \- products: ^PRD-\\d{10}$    
  \- product\_uom\_convs: ^PUC-\\d{10}$    
  \- product\_vendors: ^PVN-\\d{10}$    
  \- product\_barcodes: ^PBC-\\d{10}$    
  \- product\_images: ^PIM-\\d{10}$    
  \- product\_docs: ^PDC-\\d{10}$    
  \- categories: ^CAT-\\d{10}$    
  \- product\_audits: ^PAD-\\d{10}$    
\- Field patterns:  
  \- code: ^.{1,32}$ (max length 32\)    
  \- barcode.value: max 64 chars; additional pattern validations (EAN13 numeric length 13\) performed at application level per symbology.

\#\# 10.5 Conflict Log & Candidate Fields  
\- Conflict: API examples show numeric/simple ids ("1002","2001") without prefixes. Decision: follow Canonical short-id policy and use prefixed IDs (PRD-, PBC-, etc.). Documented mapping: service accepts legacy numeric id in API but resolves to \`row\_id\` (see mapping below). Rationale: canonical short-id required.    
\- Conflict: API returns \`preferred\_vendor\` field in product list item (single id). We DO NOT persist duplicate preferred\_vendor on products table; instead compute at read-time from product\_vendors where preferred=true per currency. Rationale: avoid duplicated business facts.    
\- Candidate fields from API (not in Canonical): API list response includes \`preferred\_vendor\` top-level; handled as computed field (candidate for materialized view). Logged here.    
\- Assumptions made due to missing/ambiguous inputs:  
  \- digits\_len default \= 10 for all public IDs (consistent across tables).    
  \- vendor master / GL master / Tax master are external systems; DB stores external id strings (varchar) and integration validates existence. Rationale: do not create cross-system FK in DB.    
  \- UOM conversion acyclicity enforced by application/service (not DB). Rationale: cycle detection across graph is complex in DB; trigger would be expensive.    
  \- Audit table added (product\_audits) though not listed in Entities; required by API / Status Model audit requirement.    
  \- product.code immutability after Active enforced via DB trigger to prevent accidental changes.    
\- API‚ÜîDB representation mapping differences:  
  \- API public id may be given as legacy numeric (e.g., "1002") ‚Äî service accepts it and treats it as legacy id mapping to \`row\_id\`; canonical DB uses prefixed public id (PRD-...). Mapping must be enforced in service layer.    
  \- API uses snake/lowercase names (product\_barcode). DB uses singular tables; mapping layer translates arrays to child table operations.    
  \- FK accepted at API: either public id (PREFIX-...) or row\_id (UUID). Service resolves to row\_id for FK operations. Documented as compatibility.

\#\# 10.6 Data Lineage & Integration Notes  
\- External masters & validations:  
  \- Vendor master: product\_vendors.vendor\_id validated by Vendor service (source of truth). Stored as external id in product\_vendors.vendor\_id. No DB FK.    
  \- GL master: gl\_inventory\_acct\_id / gl\_expense\_acct\_id validated by Finance system on submit/approve/activate. Stored as text. Masked in API for non-Finance.    
  \- Tax master: tax\_code\_id validated by Tax service. Stored as text.    
\- Single source decisions:  
  \- Product master data authoritative in this service for product attributes (code, name, type, UOM, tracking, hazardous, shelf\_life). Preferred vendor list stored here (single source of truth for product‚Üívendor links).    
  \- Inventory on-hand, PR/PO/GRN references are maintained by downstream systems (WMS/Procurement/GRN). Before deactivate/obsolete, service queries those systems (no duplication of on-hand in products table).    
\- Views/Materialized Views:  
  \- Recommend read-view to expose computed \`preferred\_vendor\` per product (materialized for performance).    
  \- Search view combining code/name/barcodes for q search to support API list filter \`q\`.    
\- Events:  
  \- Emit product.created, product.submitted, product.approved, product.activated, product.deactivated, product.obsoleted, product.updated with payload { id (public), row\_id, actor, timestamp, snapshot\_id }. Consumers: PR/PO/GRN, Inventory, Search index.    
\- Audit:  
  \- All state transitions and critical-field edits must create an entry in product\_audits (actor, role, action, reason, diff). This is authoritative audit log for product lifecycle.

\-- End of Data Schema document.

\# 11\. Business Rules

\#\#\# 11.1 Rules Inventory (merged)  
| Rule ID | Type (validation/domain) | Context (entity/endpoint) | State/Trigger | Condition | Expected | Error Code | Ref(A5/A6/A3) | Notes |  
|---|---|---|---|---|---|---|---|---|  
| R1 | validation | POST \`/erp/master/products\` | Create ‚Üí Draft | code duplicate exists | reject | 409\_CONFLICT | A6 ¬ß10.0.2; A5 ¬ß8.2 | UNIQUE \`uq\_products\_code\` enforced |  
| R2 | domain | PATCH \`/erp/master/products/{id}\` | Update (Active) | code change when status='Active' | reject | 409\_CONFLICT | A6 ¬ß10.0.2; A3 ¬ß5.2 | immutable code trigger on DB |  
| R3 | validation | POST \`/erp/master/products\` | Create ‚Üí Draft | supplied id not match \`^PRD-\\d{10}$\` | reject | 400\_VALIDATION\_FAILED | A6 ¬ß10.4; A5 ¬ß9.1 | public id regex \`^PRD-\\d{10}$\` |  
| R4 | validation | POST \`/erp/master/products/{id}:submit\` | Draft‚ÜíIn Review | missing base\_uom or no primary barcode | reject | 422\_INVALID\_STATE | A3 ¬ß5.2; A5 ¬ß8.5 | submit requires base\_uom \+ primary barcode |  
| R5 | validation | product\_barcodes insert | any write | duplicate (symbology,value) exists | reject | 409\_CONFLICT | A6 ¬ß10.0.2; A5 ¬ß9.2 | UK \`uq\_product\_barcodes\_symbology\_value\` |  
| R6 | validation | product\_uom\_convs insert/update | any write | factor \<= 0 or wrong precision | reject | 400\_VALIDATION\_FAILED | A6 ¬ß10.0.2; A5 ¬ß9.6 | factor decimal(18,6) and \>0 |  
| R7 | validation | product\_uom\_convs insert/update | any write | conversion graph cyclic (application) | reject | 400\_VALIDATION\_FAILED | A6 ¬ß10.0.2; A3 ¬ß5.2.1 | acyclic enforced at service layer |  
| R8 | domain | POST \`/erp/master/products/{id}:approve\` | In Review‚ÜíApproved | gl or tax id not found in masters | reject | 404\_NOT\_FOUND | A5 ¬ß9.6; A6 ¬ß10.6 | external FK validation required |  
| R9 | domain | POST \`/erp/master/products/{id}:activate\` | Approved‚ÜíActive | open PR/PO/GRN exist | reject | 409\_CONFLICT | A3 ¬ß5.2; A5 ¬ß8.8 | business guard: query downstream systems |  
| R10 | domain | POST \`/erp/master/products/{id}:obsolete\` | Active/Inactive‚ÜíObsolete | on\_hand \> 0 OR open docs exist | reject | 409\_CONFLICT | A3 ¬ß5.2; A5 ¬ß8.10 | irreversible; final guard |  
| R11 | validation | product\_vendors insert/update | vendor rows change | preferred duplicate per product+currency | reject | 409\_CONFLICT | A6 ¬ß10.0.2; A5 ¬ß9.6 | UNIQUE PARTIAL index enforced |  
| R12 | validation | PATCH \`/erp/master/products/{id}\` | Update | If-Match missing or ETag mismatch | reject | 412\_PRECONDITION\_FAILED | A5 ¬ß8.4; A3 ¬ß5.2.2 | optimistic concurrency check |  
| R13 | validation | POST \`/erp/master/products\` | Create | X-Idempotency-Key duplicate request | accept | ‚Äî | A5 ¬ß8.2; A5 ¬ß9.4 | idempotent create via X-Idempotency-Key |  
| R14 | validation | GET \`/erp/master/products\` | List | invalid filter shape (updated\_from not ISO-8601) | reject | 400\_VALIDATION\_FAILED | A5 ¬ß8.1; A5 ¬ß9.2 | query params validated server-side |  
| R15 | domain | any state-change endpoint | state-change | action attempted by unauthorized role | reject | 403\_FORBIDDEN | A3 ¬ß5.2; A5 ¬ß9.1 | RBAC enforced per role/DOA |  
| R16 | domain | PATCH \`/erp/master/products/{id}\` | Active critical-field edit | changing critical field ‚Üí requires revision/submit | reject | 409\_CONFLICT | A3 ¬ß5.2; A6 ¬ß10.2 | critical fields trigger re-approval flow |  
| R17 | validation | POST \`/erp/master/products/import\` | Import commit | missing required columns / parse fail | reject | 400\_VALIDATION\_FAILED | A5 ¬ß8.12; A5 ¬ß9.2 | preview/commit validation applies |  
| R18 | validation | numeric fields (standard\_cost, price\_hint) | any write | precision/scale exceeded | reject | 400\_VALIDATION\_FAILED | A6 ¬ß10.6; A5 ¬ß9.6 | decimals: money/price rules apply |  
| R19 | domain | GET \`/erp/master/products/{id}\` | Detail | product not found OR deleted\_at set (soft) | reject | 404\_NOT\_FOUND | A6 ¬ß10.0.2; A5 ¬ß8.3 | default hides soft-deleted rows |  
| R20 | domain | POST \`/erp/master/products/{id}:deactivate\` | Active‚ÜíInactive | open PR/PO/GRN exist and override=false | reject | 409\_CONFLICT | A3 ¬ß5.2; A5 ¬ß8.9 | controller override flag exceptional |

\#\#\# 11.2 State‚ÜíAction Guard Matrix (compact)  
State | Allowed | Blocked | Preconditions | Error Code  
\---|---|---|---|---  
Draft | create\<br\>update\<br\>submit | approve\<br\>activate | code/name/base\_uom present\<br\>primary barcode present | 400\_VALIDATION\_FAILED / 422\_INVALID\_STATE  
In Review | approve\<br\>reject | submit\<br\>activate | approver role per DOA\<br\>If-Match recommended | 403\_FORBIDDEN / 412\_PRECONDITION\_FAILED  
Approved | activate\<br\>edit (non-critical) | approve\<br\>submit | GL/Tax valid\<br\>no open refs for activate | 404\_NOT\_FOUND / 409\_CONFLICT  
Active | deactivate\<br\>edit (non-critical)\<br\>revision submit | submit‚ÜíIn Review (direct) blocked | no open PR/PO/GRN for deactivate\<br\>critical-field edits require revision | 409\_CONFLICT / 400\_VALIDATION\_FAILED  
Inactive | reactivate (activate) | deactivate (again) | no open refs for obsolete | 409\_CONFLICT  
Obsolete | none (terminal) | any state-change | irreversible; on\_hand==0 AND no open docs | 409\_CONFLICT  
Any editable state | update (PATCH) | update without If-Match | If-Match required for PATCH/state-change | 412\_PRECONDITION\_FAILED

\#\#\# 11.3 Soft-Delete & Retention (concise)  
\- Default list/detail visibility: exclude rows where \`deleted\_at\` IS NOT NULL; status='Obsolete' shown only when explicitly filtered.    
\- Restore behavior: restore allowed if not purged; client must supply \`If-Match\` and may use \`X-Idempotency-Key\`; restore sets status back to prior non-terminal state.    
\- \[Default\] ‡∏´‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö retention ‚Üí exclude by default; restorable if not purged (no numeric retention invented).

\#\#\# 11.4 Compensation & Recovery (P0 only)  
Scenario | Preconditions | Action | Resulting State/Data | Idempotency/ETag | Observability  
\---|---|---|---|---|---  
Approve fails due external GL/Ta—Ö | Approver invoked\<br\>GL/TAX service unavailable | rollback approve\<br\>return error | status remains In Review | X-Idempotency-Key recommended | audit entry with failure reason  
ETag mismatch on PATCH/action | Client If-Match stale | return 412\_PRECONDITION\_FAILED | no state change | client must retry with fresh ETag | no audit write for failed attempt  
Duplicate POST create retry | Same X-Idempotency-Key resent | dedupe and return original resource | single Draft created / same id | X-Idempotency-Key used to dedupe | audit: single create entry  
Bulk action partial failures | bulk request with multiple ids | apply per-id commit; return per-id results | some success / some failed | X-Idempotency-Key for whole bulk | bulk results in response; audits per id  
Event/webhook delivery failure | outbound event delivery fails | retry with backoff; DLQ on repeated failure | product state unchanged | idempotent event payloads recommended | event publish logs and DLQ alerts

\#\#\# 11.5 Findings & Follow-ups  
\- API examples use numeric ids (e.g., "1002") but A6 mandates prefixed ids (\`PRD-...\`) ‚Äî Owner: API/Integration; Ref: A6 ¬ß10.0.2 / A5 ¬ß8.2    
\- Validation code name mismatch: spec uses \`400\_VALIDATION\_FAILED\` but normalization referenced \`VALIDATION\_ERROR\` ‚Äî Owner: API team; Ref: A5 ¬ß9.2    
\- \`INVALID\_QUERY\` code referenced in rules normalization is not present in A5 error list ‚Äî Owner: API team; Ref: A5 ¬ß9.2    
\- Obsolete final-authority role not specified (who can \`obsolete\`) ‚Äî Owner: Product Governance; Ref: A3 ¬ß5.2 Warnings    
\- Controller override semantics (role/flag/param) undefined ‚Äî Owner: Security/Policy; Ref: A3 ¬ß5.2 Warnings    
\- Webhook/event payload schemas not defined for product.\* events ‚Äî Owner: Integration; Ref: A5 ¬ß9.6 / A3 ¬ß5.2 Warnings    
\- UOM acyclic enforcement delegated to service (DB cannot enforce) ‚Äî Owner: Platform/Dev; Ref: A6 ¬ß10.0.2 / A3 ¬ß5.2.3    
\- Restore endpoint and purge retention period not specified ‚Üí default applied (restorable if not purged) ‚Äî Owner: Data Retention; Ref: A6 ¬ß10.0.2 / A5 ¬ß8.x

